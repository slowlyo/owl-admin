import{g as be,ar as Fe,t as ae,as as Ce,at as te,aq as U,al as Se,au as se,av as Te,W as Pe,w as Ae,x as de,aw as Ie,ax as ce,L as w,Y as q,G as _,H as x,an as ue,ay as Oe,z as T,az as ke,aA as De,aB as ye,aC as _e,a4 as k,aD as V,aE as pe,aF as he,aG as xe,aH as fe,aI as z,aJ as Me,aK as Be,aL as re,aM as ve,aN as ne,l as I,aO as J,aP as Re,P as we,M as me,p as Ee,a5 as ie,J as Qe,am as ge,aQ as Le,v as Ne,U as Ue,D as qe,E as Ve,aR as We,aS as He,aT as $e,aU as Ge}from"./index-D1HmyPNr.js";import{o as je}from"./omitBy-BF_qUfuo.js";var ze=Fe,Je=ze(function(D,h,t){D[t?0:1].push(h)},function(){return[[],[]]}),Ke=Je;const Ye=be(Ke);var Xe=["selectedChange","columnSort","columnFilter","columnSearch","columnToggled","orderChange","rowClick","rowDbClick","rowMouseEnter","rowMouseLeave","selected"],Ze=function(D){ae(h,D);function h(t){var e=D.call(this,t)||this;e.filterOnEvent=Ce(function(c){return je(c,function(f,d){return!Xe.includes(d)})}),e.controlRef=e.controlRef.bind(e),e.handleFilterReset=e.handleFilterReset.bind(e),e.handleFilterSubmit=e.handleFilterSubmit.bind(e),e.handleFilterInit=e.handleFilterInit.bind(e),e.handleAction=e.handleAction.bind(e),e.dispatchEvent=e.dispatchEvent.bind(e),e.handleBulkAction=e.handleBulkAction.bind(e),e.handleChangePage=e.handleChangePage.bind(e),e.handleBulkGo=e.handleBulkGo.bind(e),e.handleDialogConfirm=e.handleDialogConfirm.bind(e),e.handleDialogClose=e.handleDialogClose.bind(e),e.handleItemChange=e.handleItemChange.bind(e),e.handleSave=e.handleSave.bind(e),e.handleSaveOrder=e.handleSaveOrder.bind(e),e.handleSelect=e.handleSelect.bind(e),e.handleChildPopOverOpen=e.handleChildPopOverOpen.bind(e),e.handleChildPopOverClose=e.handleChildPopOverClose.bind(e),e.search=e.search.bind(e),e.silentSearch=e.silentSearch.bind(e),e.handleQuery=e.handleQuery.bind(e),e.renderHeaderToolbar=e.renderHeaderToolbar.bind(e),e.renderFooterToolbar=e.renderFooterToolbar.bind(e),e.clearSelection=e.clearSelection.bind(e),e.filterItemIndex=e.filterItemIndex.bind(e);var r=t.location,n=t.store,a=t.pageField,i=t.perPageField;t.totalField;var o=t.syncLocation;t.loadDataOnce;var l=e.getParseQueryOptions(t);e.mounted=!0,o&&r&&(r.query||r.search)?n.updateQuery(te(r,l),void 0,a,i):o&&!r&&window.location.search&&n.updateQuery(te(window.location,l),void 0,a,i),e.props.store.setFilterTogglable(!!e.props.filterTogglable,e.props.filterDefaultVisible),e.props.api&&e.props.store.updateData({items:[]});var s;return e.props.pickerMode&&(s=U(e.props))&&e.syncSelectedFromPicker(s),e}return h.prototype.componentDidMount=function(){var t=this.props,e=t.store,r=t.autoGenerateFilter,n=t.perPageField;t.columns,this.props.perPage&&!e.query[n||"perPage"]&&e.changePage(e.page,this.props.perPage),(!this.props.filter&&!r||e.filterTogglable&&!e.filterVisible)&&this.handleFilterInit({}),this.parentContainer=this.getClosestParentContainer()},h.prototype.componentDidUpdate=function(t){var e,r=this.props,n=t.store;Se(["toolbar","headerToolbar","footerToolbar","bulkActions"],t,r)&&(this.renderHeaderToolbar=this.renderHeaderToolbar.bind(this),this.renderFooterToolbar=this.renderFooterToolbar.bind(this));var a;this.props.pickerMode&&!se(a=U(this.props),U(t))&&!se(a,n.selectedItems.concat())&&this.syncSelectedFromPicker(a),!!this.props.filterTogglable!=!!t.filterTogglable&&n.setFilterTogglable(!!r.filterTogglable,r.filterDefaultVisible);var i=!1;if(t.syncLocation&&t.location&&t.location.search!==r.location.search&&(n.updateQuery(te(r.location,this.getParseQueryOptions(r)),void 0,r.pageField,r.perPageField),i=!!(r.api&&Te(n.query,this.lastQuery,!1))),!i){if(t.api&&r.api&&Pe(t.api,r.api,n.fetchCtxOf(t.data,{pageField:t.pageField,perPageField:t.perPageField}),n.fetchCtxOf(r.data,{pageField:r.pageField,perPageField:r.perPageField})))i=!0;else if(!r.api&&Ae(r.source)&&r.data!==t.data){var o=de(r.source,r.data,"| raw");(!this.lastData||this.lastData!==o)&&(n.initFromScope(r.data,r.source,{columns:(e=n.columns)!==null&&e!==void 0?e:r.columns,totalField:r.totalField}),this.props.pickerMode&&(a=U(this.props))&&this.syncSelectedFromPicker(a),this.lastData=o)}}i&&this.search()},h.prototype.componentWillUnmount=function(){var t,e;this.mounted=!1,clearTimeout(this.timer),(e=(t=this.filterOnEvent.cache).clear)===null||e===void 0||e.call(t)},h.prototype.getParseQueryOptions=function(t){var e,r=t.parsePrimitiveQuery,n={parsePrimitive:!!(Ie(r)?r!=null&&r.enable:r),primitiveTypes:(e=r==null?void 0:r.types)!==null&&e!==void 0?e:["boolean"]};return n},h.prototype.getClosestParentContainer=function(){var t=ce.findDOMNode(this),e=t==null?void 0:t.closest("[role=dialog]");return e},h.prototype.controlRef=function(t){for(;t&&t.getWrappedInstance;)t=t.getWrappedInstance();this.control=t},h.prototype.handleAction=function(t,e,r,n,a){var i=this;n===void 0&&(n=!1);var o=this.props,l=o.onAction,s=o.store,c=o.messages,f=o.pickerMode,d=o.env;o.pageField;var u=o.stopAutoRefreshWhenModalIsOpen;if(!s.loading)if(e.actionType==="dialog"){s.setCurrentAction(e,this.props.resolveDefinitions);var F=r.index,m=s.items.length;return u&&clearTimeout(this.timer),new Promise(function(y){s.openDialog(r,{hasNext:F<m-1,nextIndex:F+1,hasPrev:F>0,prevIndex:F-1,index:F},function(b,S){var C;(C=e.callback)===null||C===void 0||C.call(e,b,S),y({confirmed:b,value:S})},a||i.context)})}else if(e.actionType==="ajax"){s.setCurrentAction(e,this.props.resolveDefinitions);var p=r,g=e.redirect&&w(e.redirect,p);return g&&e.blank&&d.jumpTo(g,e,p),q(e.api,p)?s.saveRemote(e.api,p,{successMessage:e.messages&&e.messages.success||c&&c.saveSuccess,errorMessage:e.messages&&e.messages.failed||c&&c.saveFailed}).then(function(y){return _(i,void 0,void 0,function(){var b,S;return x(this,function(C){switch(C.label){case 0:return b=k(r,y),e.feedback&&ie(e.feedback,b)?[4,this.openFeedback(e.feedback,b)]:[3,2];case 1:C.sent(),u&&clearTimeout(this.timer),C.label=2;case 2:return S=e.redirect&&w(e.redirect,b),S&&!e.blank&&d.jumpTo(S,e,b),e.reload?this.reloadTarget(V(e.reload,b),b):S||this.search(void 0,void 0,!0,!0),e.close&&this.closeTarget(e.close),[2]}})})}).catch(function(y){if(n||e.countDown)throw y}):void 0}else if(e.actionType==="reload"&&!e.target)this.reload();else{if(f&&(e.actionType==="confirm"||e.actionType==="submit"))return s.setCurrentAction(e,this.props.resolveDefinitions),Promise.resolve({items:s.selectedItems.concat()});if(e.onClick){s.setCurrentAction(e,this.props.resolveDefinitions);var v=e.onClick;typeof v=="string"&&(v=ue(v,"event","props","data")),v&&v(t,this.props,r)}else l(t,e,r,n,a||this.context)}},h.prototype.handleBulkAction=function(t,e,r,n){var a=this,i,o=this.props,l=o.store,s=o.primaryField,c=o.onAction,f=o.messages,d=o.pageField,u=o.stopAutoRefreshWhenModalIsOpen,F=o.env;if(!(!t.length&&n.requireSelected!==!1)){var m=t.map(function(y){return y.hasOwnProperty(s)?y[s]:null}).filter(function(y){return y}).join(","),p=Oe([l.mergedData,{event:r},T(T(T({},t[0]),l.eventContext),{currentPageData:(((i=l.mergedData)===null||i===void 0?void 0:i.items)||[]).concat(),rows:t,items:t,ids:m})]),g=function(){if(n.actionType==="dialog")return a.handleAction(r,T(T({},n),{__from:"bulkAction"}),p);n.actionType==="ajax"?q(n.api,p)&&l.saveRemote(n.api,p,{successMessage:n.messages&&n.messages.success||f&&f.saveSuccess,errorMessage:n.messages&&n.messages.failed||f&&f.saveFailed}).then(function(y){return _(a,void 0,void 0,function(){var b,S,C;return x(this,function(P){switch(P.label){case 0:return b=k(p,y),n.feedback&&ie(n.feedback,b)?[4,this.openFeedback(n.feedback,b)]:[3,2];case 1:P.sent(),u&&clearTimeout(this.timer),P.label=2;case 2:return n.reload?this.reloadTarget(V(n.reload,b),b):this.search((C={},C[d||"page"]=1,C),void 0,!0,!0),n.close&&this.closeTarget(n.close),S=n.redirect&&w(n.redirect,b),S&&F.jumpTo(S,n,b),[2]}})})}).catch(function(){return null}):c&&c(r,n,p,!1,a.context)},v="";!n.ignoreConfirm&&n.confirmText&&F.confirm&&(v=w(n.confirmText,p))?F.confirm(v,w(n.confirmTitle,p)||void 0).then(function(y){return y&&g()}):g()}},h.prototype.handleItemAction=function(t,e){this.doAction(t,e)},h.prototype.handleFilterInit=function(t){var e,r=this.props,n=r.defaultParams,a=r.columns,i=r.matchFunc,o=r.store,l=r.orderBy,s=r.orderDir,c=r.totalField;r.dispatchEvent;var f=T({},n);l&&(f.orderBy=l,f.orderDir=s||"asc"),this.handleFilterSubmit(T(T(T({},f),t),o.query),!1,!0,this.props.initFetch!==!1,!0),o.setPristineQuery();var d=this.props,u=d.pickerMode,F=d.options;if(u){o.initFromScope({items:F||[]},"${items}",{columns:(e=o.columns)!==null&&e!==void 0?e:a,matchFunc:i,totalField:c});var m=void 0;(m=U(this.props))&&this.syncSelectedFromPicker(m)}},h.prototype.handleFilterReset=function(t,e){var r=this.props,n=r.store,a=r.syncLocation,i=r.env,o=r.pageField,l=r.perPageField,s={};Object.keys(t).forEach(function(c){return s[c]=""}),n.updateQuery(T(T({},s),n.pristineQuery),a&&i&&i.updateLocation?function(c){return i.updateLocation(c)}:void 0,o,l,!0),this.lastQuery=n.query,!(e!=null&&e.actionType&&["reset-and-submit","clear-and-submit","submit"].includes(e.actionType))&&this.search()},h.prototype.handleFilterSubmit=function(t,e,r,n,a){var i,o,l;e===void 0&&(e=!0),r===void 0&&(r=!1),n===void 0&&(n=!0),a===void 0&&(a=!1);var s=this.props,c=s.store,f=s.syncLocation,d=s.env,u=s.pageField,F=s.perPageField,m=s.loadDataOnceFetchOnFilter,p=s.parsePrimitiveQuery,g=this.getParseQueryOptions(this.props);t=T(T({},t),ke((l=(o=t==null?void 0:t.__super)===null||o===void 0?void 0:o.diff)!==null&&l!==void 0?l:{},function(v){return v===void 0})),t=f?De(ye(t,void 0,!0)):t,p&&(t=_e(t,g)),c.updateQuery(T(T({},t),(i={},i[u||"page"]=e?1:c.page,i)),f&&d&&d.updateLocation?function(v){return d.updateLocation(v,r)}:void 0,u,F),this.lastQuery=c.query,n&&this.search(void 0,void 0,void 0,m!==!1,a)},h.prototype.handleBulkGo=function(t,e,r){var n=this,a=this.props.store.selectedAction,i=this.props.env,o="";return a.confirmText&&(o=w(a.confirmText,this.props.store.mergedData))?i.confirm(o).then(function(l){return l&&n.handleBulkAction(t,e,r,a)}):this.handleBulkAction(t,e,r,a)},h.prototype.handleDialogConfirm=function(t,e,r,n){var a,i,o,l,s=this.props,c=s.store,f=s.pageField,d=s.stopAutoRefreshWhenModalIsOpen,u=s.interval,F=s.silentPolling,m=s.env;c.closeDialog(!0,t);var p=c.action;if(d&&u&&(this.timer=setTimeout(F?this.silentSearch:this.search,Math.max(u,1e3))),e.actionType==="next"&&typeof r.nextIndex=="number"&&c.data.items[r.nextIndex])return this.handleAction(void 0,T({},p),k(k(c.data,{index:r.nextIndex}),c.data.items[r.nextIndex]));if(e.actionType==="prev"&&typeof r.prevIndex=="number"&&c.data.items[r.prevIndex])return this.handleAction(void 0,T({},p),k(k(c.data,{index:r.prevIndex}),c.data.items[r.prevIndex]));if(t.length){var g=t[0];r=k(r,g);var v=n[0];if(v&&v.props.type==="form")if(g&&g.__saved){var y=(i=e.reload)!==null&&i!==void 0?i:p.reload;y||this.search(p.__from?(a={},a[f||"page"]=1,a):void 0,void 0,!0,!0)}else g&&(g.hasOwnProperty("items")&&g.items||g.hasOwnProperty("ids"))&&this.control.bulkUpdate&&this.control.bulkUpdate(g,g.items)}var b=(o=e.reload)!==null&&o!==void 0?o:p.reload;b&&this.reloadTarget(V(b,r),r);var S=(l=e.redirect)!==null&&l!==void 0?l:p.redirect;S=S&&w(S,r),S&&m.jumpTo(S,p,r)},h.prototype.handleDialogClose=function(t){t===void 0&&(t=!1);var e=this.props,r=e.store,n=e.stopAutoRefreshWhenModalIsOpen,a=e.silentPolling,i=e.interval;r.closeDialog(t),n&&i&&(this.timer=setTimeout(a?this.silentSearch:this.search,Math.max(i,1e3)))},h.prototype.openFeedback=function(t,e){var r=this;return new Promise(function(n){var a=r.props.store;a.setCurrentAction({type:"button",actionType:"dialog",dialog:t},r.props.resolveDefinitions),a.openDialog(e,void 0,function(i){n(i)},r.context)})},h.prototype.search=function(t,e,r,n,a){var i,o,l,s,c,f;return n===void 0&&(n=!1),a===void 0&&(a=!1),_(this,void 0,void 0,function(){var d,u,F,m,p,g,v,y,b,S,C,P,O,M,E,W,H,N,Q,L,oe,$,G,j,A,K,Y,X,Z,B,B,le,ee;return x(this,function(R){switch(R.label){case 0:return d=this.props,u=d.store,F=d.api,m=d.messages,p=d.pageField,g=d.perPageField,v=d.totalField,y=d.interval,b=d.stopAutoRefreshWhen,S=d.stopAutoRefreshWhenModalIsOpen,C=d.silentPolling,P=d.syncLocation,O=d.syncResponse2Query,M=d.pickerMode,E=d.env,W=d.loadDataOnce,H=d.loadDataOnceFetchOnFilter,N=d.source,Q=d.columns,L=d.dispatchEvent,oe=d.options,r&&!M&&u.resetSelection(),$="",t&&typeof t.loadDataMode=="string"&&($="load-more",delete t.loadDataMode),clearTimeout(this.timer),t&&u.updateQuery(t,!$&&P&&E&&E.updateLocation?E.updateLocation:void 0,p,g),this.lastQuery=u.query,G=k(u.data,u.query),j=!((i=this.props)===null||i===void 0)&&i.matchFunc&&typeof this.props.matchFunc=="string"?ue(this.props.matchFunc,"items","itemsRaw","options"):void 0,q(F,G)?[4,u.fetchInitData(F,G,{successMessage:m&&m.fetchSuccess,errorMessage:m&&m.fetchFailed,autoAppend:!0,forceReload:n,loadDataOnce:W,source:N,silent:e,pageField:p,perPageField:g,totalField:v,loadDataMode:$,syncResponse2Query:O,columns:(o=u.columns)!==null&&o!==void 0?o:Q,matchFunc:j,filterOnAllColumns:H===!1,minLoadingTime:t==null?void 0:t.minLoadingTime,dataAppendTo:t==null?void 0:t.dataAppendTo})]:[3,8];case 1:return A=R.sent(),He(u)?(K=u.page,Y=u.lastPage,X=u.msg,Z=u.error,a?[4,L==null?void 0:L("fetchInited",k(this.props.data,{responseData:A!=null&&A.ok?(l=u.data)!==null&&l!==void 0?l:{}:A,responseStatus:(A==null?void 0:A.status)===void 0?Z?1:0:A==null?void 0:A.status,responseMsg:X}))]:[3,3]):[2,A];case 2:return B=R.sent(),B!=null&&B.prevented?[2,u.data]:[3,5];case 3:return[4,L==null?void 0:L("research",k(this.props.data,{responseData:A!=null&&A.ok?(s=u.data)!==null&&s!==void 0?s:{}:A,responseStatus:(A==null?void 0:A.status)===void 0?Z?1:0:A==null?void 0:A.status,responseMsg:X}))];case 4:if(B=R.sent(),B!=null&&B.prevented)return[2,u.data];R.label=5;case 5:return!W&&!u.data.items.length&&!y&&K>1&&Y<K?[4,this.search(T(T({},u.query),(ee={},ee[p||"page"]=Y,ee)),!1,void 0)]:[3,7];case 6:R.sent(),R.label=7;case 7:return A!=null&&A.ok&&y&&this.mounted&&(!b||!(S&&u.hasModalOpened||re(b,k(u.data,u.query))))&&(this.timer=setTimeout(C?this.silentSearch.bind(this,void 0,void 0,!0):this.search.bind(this,void 0,void 0,void 0,!0),Math.max(y,1e3))),[3,9];case 8:N?u.initFromScope(G,N,{columns:(c=u.columns)!==null&&c!==void 0?c:Q,matchFunc:j,totalField:v}):M&&u.initFromScope({items:oe||[]},"${items}",{columns:(f=u.columns)!==null&&f!==void 0?f:Q,matchFunc:j,totalField:v}),R.label=9;case 9:return this.props.pickerMode&&this.props.onSelect&&(le=U(this.props))&&this.syncSelectedFromPicker(le),[2,u.data]}})})},h.prototype.silentSearch=function(t,e,r){return r===void 0&&(r=!1),this.search(t,!0,e,r)},h.prototype.handleChangePage=function(t,e,r){var n;return _(this,void 0,void 0,function(){var a,i,o,l,s,c,f,d,u,F,m,p,g,v,y;return x(this,function(b){switch(b.label){case 0:return a=this.props,i=a.store,o=a.syncLocation,l=a.env,s=a.pageField,c=a.perPageField,f=a.pageDirectionField,d=a.autoJumpToTopOnPagerChange,u=a.translate,F=a.api,m=a.loadDataOnce,F&&!m&&(!((n=this.control)===null||n===void 0)&&n.hasModifiedItems())?[4,$e(u("CRUD.confirmLeaveUnSavedPage"))]:[3,2];case 1:if(p=b.sent(),!p)return[2];b.label=2;case 2:return g=(y={},y[s||"page"]=t,y),r&&(g[f||"pageDir"]=r),e&&(g[c||"perPage"]=e),i.updateQuery(g,o&&(l!=null&&l.updateLocation)?l.updateLocation:void 0,s,c),this.search(void 0,void 0,void 0),d&&this.control&&(this.control.scrollToTop?this.control.scrollToTop():(ce.findDOMNode(this.control).scrollIntoView(),v=window.scrollY,v&&window.scroll(0,v))),[2]}})})},h.prototype.syncSelectedFromPicker=function(t){var e=this.props,r=e.store,n=e.primaryField,a=e.strictMode,i=function(l,s){var c=l[n||"id"],f=s[n||"id"],d=a?c===f:c==f;return!!(l===s||c&&d)},o=t.map(function(l){var s;return pe(l)||(l=(s={},s[n||"id"]=l,s)),he(r.items,function(c){return i(c,l)})||l});this.props.store.setSelectedItems(o)},h.prototype.handleItemChange=function(t,e,r){var n=this.props.store,a="".concat(r).split(".").map(function(o){return parseInt(o,10)}),i=xe(n.items,a,1,t);n.replaceItems(i)},h.prototype.handleSave=function(t,e,r,n,a,i){var o=this,l=this.props,s=l.store,c=l.quickSaveApi,f=l.quickSaveItemApi,d=l.primaryField,u=l.env,F=l.messages,m=l.reload,p=l.dispatchEvent;if(Array.isArray(t)){if(!q(c)){u&&u.alert("CRUD quickSaveApi is required");return}var g=k(s.data,{rows:t,rowsDiff:e,indexes:r,rowsOrigin:a});return t.length&&t[0].hasOwnProperty(d||"id")&&(g.ids=t.map(function(b){return b[d||"id"]}).join(",")),n&&(g.unModifiedItems=n),s.saveRemote(c,g,{successMessage:F&&F.saveFailed,errorMessage:F&&F.saveSuccess}).then(function(b){return _(o,void 0,void 0,function(){var S,C,P;return x(this,function(O){switch(O.label){case 0:return b?[4,p==null?void 0:p("quickSaveSucc",z(g,{result:b}))]:[2];case 1:return S=O.sent(),S!=null&&S.prevented?[2]:(C=(P=i==null?void 0:i.reload)!==null&&P!==void 0?P:m,[2,C?this.reloadTarget(V(C,g),g):this.search(void 0,void 0,!0,!0)])}})})}).catch(function(b){return _(o,void 0,void 0,function(){return x(this,function(S){switch(S.label){case 0:return[4,p==null?void 0:p("quickSaveFail",k(this.props.data,{error:b}))];case 1:return S.sent(),[2]}})})})}else{if(!q(f)){u&&u.alert("CRUD quickSaveItemApi is required!");return}var v=k(s.data,{item:t,modified:e,origin:a}),y=k(v,t);return s.saveRemote(f,y).then(function(b){return _(o,void 0,void 0,function(){var S,C,P;return x(this,function(O){switch(O.label){case 0:return b?[4,p==null?void 0:p("quickSaveItemSucc",z(v,{result:b}))]:[2];case 1:return S=O.sent(),S!=null&&S.prevented?[2]:(C=(P=i==null?void 0:i.reload)!==null&&P!==void 0?P:m,[2,C?this.reloadTarget(V(C,v),v):this.search(void 0,void 0,!0,!0)])}})})}).catch(function(b){return _(o,void 0,void 0,function(){return x(this,function(S){switch(S.label){case 0:return i!=null&&i.resetOnFailed&&this.control.reset(),[4,p==null?void 0:p("quickSaveItemFail",k(this.props.data,{error:b}))];case 1:return S.sent(),[2]}})})})}},h.prototype.handleSaveOrder=function(t,e){var r=this,n=this.props,a=n.store,i=n.saveOrderApi,o=n.orderField,l=n.primaryField,s=n.env,c=n.reload,f=n.dispatchEvent;if(!i){s&&s.alert("CRUD saveOrderApi is required!");return}var d=k(a.data),u,F,m=[],p=l&&e[0]&&e[0].hasOwnProperty(l);if(p||(d.idMap={}),d.insertAfter={},e.forEach(function(C){if(~t.indexOf(C))if(u){var P=p?u[l]:e.indexOf(u);d.insertAfter[P]=d.insertAfter[P]||[],p||(d.idMap[P]=u),d.insertAfter[P].push(p?C[l]:C)}else m.push(C);else u=C,F=F||C}),F&&m.length){var g=p?F[l]:e.indexOf(F);p||(d.idMap[g]=F),d.insertBefore={},d.insertBefore[g]=m.map(function(C){return p?C[l]:C})}else if(m.length){var v=m[0],y=p?v[l]:e.indexOf(v);p||(d.idMap[y]=v),d.insertAfter[y]=m.slice(1).map(function(C){return p?C[l]:C})}if(o){var b=(a.page-1)*a.perPage||0;e=fe(e,function(C,P,O){var M;return z(C,(M={},M[o]=(O===1?b:0)+P+1,M))})}if(d.rows=e.concat(),p){var S=function(C){return C.map(function(P){return"".concat(P[l]).concat(Array.isArray(P.children)&&P.children.length?"[".concat(S(P.children),"]"):"")}).join(",")};d.ids=S(e),o&&(d.order=fe(e,function(C){return Me(C,[l,o,"children"])}))}return q(i,d)&&a.saveRemote(i,d).then(function(C){return _(r,void 0,void 0,function(){var P;return x(this,function(O){switch(O.label){case 0:return C?[4,f==null?void 0:f("saveOrderSucc",z(d,{result:C}))]:[2];case 1:return P=O.sent(),P!=null&&P.prevented?[2]:(c&&this.reloadTarget(V(c,d),d),this.search(void 0,void 0,!0,!0),[2])}})})}).catch(function(C){return _(r,void 0,void 0,function(){return x(this,function(P){switch(P.label){case 0:return[4,f==null?void 0:f("saveOrderFail",k(this.props.data,{error:C}))];case 1:return P.sent(),[2]}})})})},h.prototype.handleSelect=function(t,e){var r=this.props,n=r.store,a=r.keepItemSelectionOnPageChange,i=r.primaryField,o=r.multiple,l=r.pickerMode,s=r.strictMode,c=r.onSelect,f=t;if(a&&n.selectedItems.length){var d;n.items.length>t.length+e.length?d=function(m,p){return(m.__pristine||m)===(p.__pristine||p)}:d=function(m,p){var g=m[i||"id"],v=p[i||"id"],y=s?g===v:g==v;return m===p||g&&y};var u=t.concat();f=n.selectedItems.map(function(m){var p=u.findIndex(function(g){return d(g,m)});return~p?u.splice(p,1)[0]:he(e,function(g){return d(g,m)})?null:m}).filter(function(m){return m}).concat(u)}var F=n.items.filter(function(m){return!f.find(function(p){return(p.__pristine||p)===m})}).map(function(m){return e.find(function(p){return p.__pristine===m})||m});l&&o===!1&&f.length>1&&F.push.apply(F,f.splice(0,f.length-1)),n.setSelectedItems(f),n.setUnSelectedItems(F),c&&c(f,F)},h.prototype.handleChildPopOverOpen=function(t){this.props.interval&&t&&~["dialog","drawer"].indexOf(t.mode)&&(this.props.stopAutoRefreshWhenModalIsOpen&&clearTimeout(this.timer),this.props.store.setInnerModalOpened(!0))},h.prototype.handleChildPopOverClose=function(t){var e=this.props,r=e.stopAutoRefreshWhenModalIsOpen,n=e.silentPolling,a=e.interval;t&&~["dialog","drawer"].indexOf(t.mode)&&(this.props.store.setInnerModalOpened(!1),r&&a&&(this.timer=setTimeout(n?this.silentSearch:this.search,Math.max(a,1e3))))},h.prototype.handleQuery=function(t,e,r,n,a){var i,o=this.props,l=o.store,s=o.syncLocation,c=o.env,f=o.pageField,d=o.perPageField,u=o.loadDataOnceFetchOnFilter;return l.updateQuery(n?T((i={},i[f||"page"]=1,i),t):t,s&&c&&c.updateLocation?c.updateLocation:void 0,f,d,r),this.search(void 0,void 0,a??r,e??u===!0)},h.prototype.reload=function(t,e,r,n,a,i){return e?this.receive(e,void 0,a,i==null?void 0:i.resetPage,!0):this.search(void 0,void 0,!0,!0)},h.prototype.receive=function(t,e,r,n,a){return this.handleQuery(t,!0,r,n,a)},h.prototype.reloadTarget=function(t,e){},h.prototype.closeTarget=function(t){},h.prototype.doAction=function(t,e,r,n){var a;return r===void 0&&(r=!1),_(this,void 0,void 0,function(){var i,o,l;return x(this,function(s){switch(s.label){case 0:return i=this.props.store,t.actionType&&["submitQuickEdit","toggleExpanded","setExpanded","initDrag","cancelDrag","selectAll","clearAll"].includes(t.actionType)?[2,(a=this.control)===null||a===void 0?void 0:a.doAction(t,e,r,n)]:[3,1];case 1:return t.actionType!=="select"?[3,3]:[4,Ge(i.items,e,n==null?void 0:n.index,n==null?void 0:n.condition)];case 2:return o=s.sent(),l=i.items.filter(function(c){return!o.includes(c)}),[2,this.handleSelect(o,l)];case 3:return[2,this.handleAction(void 0,t,e,r)]}})})},h.prototype.dispatchEvent=function(t,e,r,n){if(t==="selectedChange"&&this.control===r){var a=this.props.store;e.selectedItems=a.selectedItems.concat(),e.unSelectedItems=a.unSelectedItems.concat()}return this.props.dispatchEvent(t,e,r,n)},h.prototype.unSelectItem=function(t,e){var r=this.props.store,n=r.selectedItems.concat(),a=r.unSelectedItems.concat(),i=n.indexOf(t);~i&&a.push.apply(a,n.splice(i,1)),r.setSelectedItems(n),r.setUnSelectedItems(a)},h.prototype.clearSelection=function(){var t=this.props,e=t.store,r=t.itemCheckableOn,n=Be(Ye(e.selectedItems,function(l){return!r||re(r,l)}),2),a=n[0],i=n[1],o=e.unSelectedItems.concat(a);e.setSelectedItems(i),e.setUnSelectedItems(o)},h.prototype.hasBulkActionsToolbar=function(){var t=this.props,e=t.headerToolbar,r=t.footerToolbar,n=t.enableBulkActions;if(n===!1)return!1;var a=function(i){return~["bulkActions","bulk-actions"].indexOf(i.type||i)};return Array.isArray(e)&&ve(e,a)||Array.isArray(r)&&ve(r,a)},h.prototype.hasBulkActions=function(){var t=this.props,e=t.bulkActions;t.itemActions;var r=t.store;if(!e||!e.length)return!1;var n=[],a=r.mergedData;return e&&e.length&&(n=e.map(function(i){return T(T({},i),ne(i,a))}).filter(function(i){return!i.hidden&&i.visible!==!1})),n.length},h.prototype.renderBulkActions=function(t){var e=this,r,n=this.props,a=n.bulkActions,i=n.itemActions,o=n.store,l=n.render,s=n.classnames,c=n.primaryField,f=n.enableBulkActions;if(!a||!a.length||f===!1)return null;var d=o.selectedItems,u=o.unSelectedItems,F=[],m=[],p=k(o.mergedData,T(T({currentPageData:(((r=o.mergedData)===null||r===void 0?void 0:r.items)||[]).concat()},o.eventContext),{rows:d.concat(),items:d.concat(),ids:d.map(function(v){return v.hasOwnProperty(c)?v[c]:null}).filter(function(v){return v}).join(",")}));a&&a.length&&(!i||!i.length||d.length>1)&&(F=a.map(function(v){return T(T({},v),ne(v,p))}).filter(function(v){return!v.hidden&&v.visible!==!1}));var g=k(o.data,d.length?d[0]:{});return i&&d.length<=1&&(m=i.map(function(v){return T(T({},v),ne(v,g))}).filter(function(v){return!v.hidden&&v.visible!==!1})),F.length||m.length?I.createElement("div",{className:s("Crud-actions")},F.map(function(v,y){return l("bulk-action/".concat(y),T(T({},J(v,["visibleOn","hiddenOn","disabledOn"])),{type:v.type||"button"}),{key:"bulk-".concat(y),data:p,disabled:v.disabled||(v.requireSelected!==!1?!d.length:!1),onAction:e.handleBulkAction.bind(e,d.concat(),u.concat()),ignoreConfirm:!0})}),m.map(function(v,y){return l("bulk-action/".concat(y),T(T({},J(v,["visibleOn","hiddenOn","disabledOn"])),{type:"button"}),{key:"item-".concat(y),data:g,disabled:v.disabled||d.length!==1,onAction:e.handleItemAction.bind(e,v,g)})})):null},h.prototype.renderPagination=function(t){var e=this.props,r=e.store,n=e.render,a=e.classnames,i=e.alwaysShowPagination,o=e.perPageAvailable,l=e.testIdBuilder,s=r.page,c=r.lastPage;if(r.mode!=="simple"&&r.lastPage<2&&!i)return null;var f={};if(Array.isArray(o)&&(f.perPageAvailable=o),typeof t!="string"){Object.assign(f,t);var d=t.showPageInput;f.showPageInput=d===!0||c>9&&d==null,f.total=de(t.total,r.data)}else f.showPageInput=c>9;return I.createElement("div",{className:a("Crud-pager")},n("pagination",{type:"pagination",testIdBuilder:l==null?void 0:l.getChild("pagination")},T(T({},f),{activePage:s,lastPage:c,hasNext:r.hasNext,mode:r.mode,perPage:r.perPage,popOverContainer:this.parentContainer,onPageChange:this.handleChangePage})))},h.prototype.renderStatistics=function(){var t=this.props,e=t.store,r=t.classnames,n=t.translate,a=t.alwaysShowPagination;return e.lastPage<=1&&!a?null:I.createElement("div",{className:r("Crud-statistics")},n("CRUD.stat",{page:e.page,lastPage:e.lastPage,total:e.total}))},h.prototype.renderSwitchPerPage=function(t){var e=this,r=this.props,n=r.mobileUI,a=r.store,i=r.perPageAvailable,o=r.classnames,l=r.classPrefix,s=r.translate,c=r.testIdBuilder,f=t.items;if(!f.length)return null;var d=n?(i||[5,10,20,50,100]).map(function(u){return{label:u+" 条/页",value:u+""}}):(i||[5,10,20,50,100]).map(function(u){return{label:u,value:u+""}});return I.createElement("div",{className:o("Crud-pageSwitch")},n?null:I.createElement("span",null,s("CRUD.perPage")),I.createElement(Re,{classPrefix:l,searchable:!1,placeholder:s("Select.placeholder"),options:d,value:a.perPage+"",onChange:function(u){return e.handleChangePage(1,u.value)},clearable:!1,popOverContainer:this.parentContainer,testIdBuilder:c==null?void 0:c.getChild("perPage")}))},h.prototype.renderLoadMore=function(){var t=this,e=this.props,r=e.store;e.classPrefix;var n=e.classnames;e.translate,e.testIdBuilder;var a=e.loadMoreProps,i=a===void 0?{}:a,o=r.page,l=r.lastPage,s=i.showIcon,c=s===void 0?!0:s,f=i.showText,d=f===void 0?!0:f,u=i.iconType,F=u===void 0?"loading-outline":u,m=i.contentText,p=m===void 0?{contentdown:"点击加载更多",contentrefresh:"加载中...",contentnomore:"没有更多数据了"}:m,g=i.minLoadingTime,v=i.dataAppendTo,y=i.color,b=r.loading,S=o>=l;return I.createElement("div",{className:n("Crud-loadMore"),style:y?{"--Spinner-color":y,color:y}:void 0,onClick:function(){b||S||t.search({page:o+1,loadDataMode:"load-more",minLoadingTime:g,dataAppendTo:v})}},c&&I.createElement(we,{show:b,icon:F,size:"sm"}),d&&I.createElement("span",null,b?p.contentrefresh:S?p.contentnomore:p.contentdown))},h.prototype.renderFilterToggler=function(){var t,e,r,n=this.props,a=n.store,i=n.classnames,o=n.translate,l=n.filterTogglable;if(!a.filterTogglable)return null;var s=pe(l)?T({},l):{};return a.filterVisible&&(s.icon=(t=s.activeIcon)!==null&&t!==void 0?t:s.icon,s.label=(e=s.activeLabel)!==null&&e!==void 0?e:s.label),I.createElement("button",{onClick:function(){return a.setFilterVisible(!a.filterVisible)},className:i("Button Button--size-default Button--default",{"is-active":a.filterVisible})},s.icon?I.createElement(me,{icon:s.icon,className:"icon m-r-xs"}):(s==null?void 0:s.icon)!==!1?I.createElement(me,{icon:"filter",className:"icon m-r-xs"}):null,(r=s==null?void 0:s.label)!==null&&r!==void 0?r:o("CRUD.filter"))},h.prototype.renderExportCSV=function(t){var e=this.props,r=e.store,n=e.classPrefix,a=e.translate,i=e.loadDataOnce,o=t.api,l=t.filename;return I.createElement(Ee,{classPrefix:n,onClick:function(){return r.exportAsCSV({loadDataOnce:i,api:o,filename:l,data:r.filterData})}},t.label||a("CRUD.exportCSV"))},h.prototype.renderToolbar=function(t,e,r,n){var a=this;if(e===void 0&&(e=0),r===void 0&&(r={}),!t)return null;var i=this.props,o=i.render,l=i.store,s=i.mobileUI,c=i.translate,f=i.testIdBuilder,d=t.type||t;if(d==="bulkActions"||d==="bulk-actions")return this.renderBulkActions(r);if(d==="pagination")return this.renderPagination(t);if(d==="statistics")return this.renderStatistics();if(d==="switch-per-page")return this.renderSwitchPerPage(r);if(d==="load-more")return this.renderLoadMore();if(d==="filter-toggler")return this.renderFilterToggler();if(d==="export-csv")return this.renderExportCSV(t);if(d==="reload"){var u={label:"",icon:"fa fa-sync",tooltip:c("reload"),tooltipPlacement:"top",type:"button"};return typeof t=="object"&&(u=T(T({},u),J(t,["type","align"]))),o("toolbar/".concat(e),u,{onAction:function(){a.reload()}})}else if(Array.isArray(t)){var F=t.filter(function(y){return ie(y,l.toolbarData)}).map(function(y,b){return{dom:a.renderToolbar(y,b,r,n),toolbar:y}}).filter(function(y){return y.dom}),m=F.length,p=this.props.classnames;return m?I.createElement("div",T({className:p("Crud-toolbar"),key:e},f==null?void 0:f.getChild("toolbar").getTestId()),F.map(function(y,b){var S=y.toolbar,C=y.dom,P=S.type||S,O=S.align||(P==="pagination"?"right":"left");return I.createElement("div",{key:S.id||b,className:p("Crud-toolbar-item",O?"Crud-toolbar-item--".concat(O):"",{"is-mobile":s})},C)})):null}var g=n?n(t,e):void 0;if(g!==void 0)return g;var v=r.$$editable;return o("toolbar/".concat(e),t,{data:l.toolbarData,page:l.page,lastPage:l.lastPage,perPage:l.perPage,total:l.total,onQuery:this.handleQuery,onAction:this.handleAction,onChangePage:this.handleChangePage,onBulkAction:this.handleBulkAction,$$editable:v})},h.prototype.renderHeaderToolbar=function(t,e){var r=this.props,n=r.toolbar,a=r.toolbarInline,i=r.headerToolbar;return n&&(Array.isArray(i)?i=a?i.concat(n):[i,n]:i?i=[i,n]:i=n),this.renderToolbar(i||[],0,t,e)},h.prototype.renderFooterToolbar=function(t,e){var r=this.props,n=r.toolbar,a=r.toolbarInline,i=r.footerToolbar;return n&&(Array.isArray(i)?i=a?i.concat(n):[i,n]:i?i=[i,n]:i=n),this.renderToolbar(i,0,t,e)},h.prototype.renderTag=function(t,e){var r=this.props,n=r.classnames,a=r.labelField,i=r.labelTpl,o=r.primaryField,l=r.valueField;r.translate;var s=r.env,c=r.itemCheckableOn,f=c?re(c,t):!0;return I.createElement("div",{key:e,className:n("Crud-value",f?"":"is-disabled")},I.createElement("span",{className:n("Crud-valueIcon"),onClick:this.unSelectItem.bind(this,t,e)},"×"),I.createElement("span",{className:n("Crud-valueLabel")},i?I.createElement(Qe,{html:w(i,t),filterHtml:s.filterHtml}):ge(t,a||"label")||ge(t,l||o||"id")))},h.prototype.renderSelection=function(){var t=this,e=this.props,r=e.store;e.classPrefix;var n=e.classnames;e.labelField,e.labelTpl,e.primaryField,e.valueField;var a=e.translate;e.env;var i=e.popOverContainer,o=e.multiple,l=e.maxTagCount,s=e.overflowTagPopover,c=e.keepItemSelectionOnPageChange;if(!r.selectedItems.length||!c||o===!1)return null;var f=r.selectedItems,d=o!==!1&&typeof l=="number"&&l>0,u=T({offset:[0,-10],tooltipClassName:n("Crud-selection-overflow",s==null?void 0:s.tooltipClassName),title:a("已选项")},J(s,["children","content","tooltipClassName"]));return I.createElement("div",{className:n("Crud-selection")},I.createElement("div",{"data-folder-ignore":!0,className:n("Crud-selectionLabel")},a("CRUD.selected",{total:r.selectedItems.length})),I.createElement(Le,{enabled:!!d,tooltipClassName:n("Crud-selection-overflow-wrapper"),items:f,popOverContainer:i,tooltipOptions:u,maxVisibleCount:l,renderItem:function(F,m,p){return t.renderTag(F,m)}}),I.createElement("a",{onClick:this.clearSelection,className:n("Crud-selectionClear")},a("clear")))},h.prototype.renderFilter=function(){var t,e=this.props,r=e.store,n=e.render,a=e.classnames,i=e.filter,o=e.translate,l=e.testIdBuilder,s=e.filterCanAccessSuperData,c=s===void 0?!0:s;return!i||r.filterTogglable&&!r.filterVisible?null:n("filter",T(T({title:o("CRUD.filter"),mode:"inline",submitText:o("search")},i),{type:"form",api:null,testIdBuilder:l==null?void 0:l.getChild("filter")}),{key:"filter",panelClassName:a("Crud-filter",i.panelClassName||"Panel--default"),data:r.filterData,onReset:this.handleFilterReset,onSubmit:this.handleFilterSubmit,onInit:this.handleFilterInit,formStore:void 0,canAccessSuperData:(t=i==null?void 0:i.canAccessSuperData)!==null&&t!==void 0?t:c})},h.prototype.filterItemIndex=function(t){var e,r=this.props.store,n="".concat(t).split(".").map(function(i){return parseInt(i,10)});if(!Array.isArray(r.data.items))return t;var a=(e=r.data.items)===null||e===void 0?void 0:e[n[0]];return a&&(n[0]=r.items.findIndex(function(i){return(i.__pristine||i)===(a.__pristine||a)})),n.join(".")},h.prototype.filterBodySchema=function(t){return t},h.prototype.renderBody=function(){var t,e=this.props;e.className,e.style;var r=e.bodyClassName,n=e.filter,a=e.render,i=e.store,o=e.mode;e.syncLocation,e.children;var l=e.bulkActions,s=e.pickerMode,c=e.multiple,f=e.strictMode,d=e.valueField,u=e.primaryField;e.value;var F=e.hideQuickSaveBtn,m=e.itemActions,p=e.classnames,g=e.keepItemSelectionOnPageChange,v=e.maxKeepItemSelectionLength,y=e.maxItemSelectionLength;e.onAction;var b=e.popOverContainer;e.translate,e.onQuery;var S=e.autoGenerateFilter;e.onSelect;var C=e.autoFillHeight,P=e.onEvent;e.onSave,e.onSaveOrder,e.onPopOverOpened,e.onPopOverClosed,e.onSearchableFromReset,e.onSearchableFromSubmit,e.onSearchableFromInit,e.headerToolbarRender,e.footerToolbarRender;var O=e.testIdBuilder,M=e.id,E=e.filterCanAccessSuperData,W=E===void 0?!0:E,H=e.selectable,N=H===void 0?!1:H,Q=Ne(e,["className","style","bodyClassName","filter","render","store","mode","syncLocation","children","bulkActions","pickerMode","multiple","strictMode","valueField","primaryField","value","hideQuickSaveBtn","itemActions","classnames","keepItemSelectionOnPageChange","maxKeepItemSelectionLength","maxItemSelectionLength","onAction","popOverContainer","translate","onQuery","autoGenerateFilter","onSelect","autoFillHeight","onEvent","onSave","onSaveOrder","onPopOverOpened","onPopOverClosed","onSearchableFromReset","onSearchableFromSubmit","onSearchableFromInit","headerToolbarRender","footerToolbarRender","testIdBuilder","id","filterCanAccessSuperData","selectable"]);return a("body",T(T({},this.filterBodySchema(Q)),{id:M,onEvent:this.filterOnEvent(P),columns:(t=i.columns)!==null&&t!==void 0?t:Q.columns,type:o||"table"}),{key:"body",className:p("Crud-body",r),ref:this.controlRef,autoGenerateFilter:!n&&S,filterCanAccessSuperData:W,autoFillHeight:C,selectable:!!(this.hasBulkActionsToolbar()&&this.hasBulkActions()||s||N),itemActions:m,multiple:c===void 0?!!(l&&l.length>0):c,selected:i.selectedItemsAsArray,strictMode:f,keepItemSelectionOnPageChange:g,maxKeepItemSelectionLength:v,maxItemSelectionLength:y,valueField:d||u,primaryField:u,hideQuickSaveBtn:F,items:i.data.items,fullItems:i.itemsAsArray,query:i.query,orderBy:i.query.orderBy,orderDir:i.query.orderDir,popOverContainer:b,onAction:this.handleAction,dispatchEvent:this.dispatchEvent,onItemChange:this.handleItemChange,onSave:this.handleSave,onSaveOrder:this.handleSaveOrder,onQuery:this.handleQuery,onSelect:this.handleSelect,onPopOverOpened:this.handleChildPopOverOpen,onPopOverClosed:this.handleChildPopOverClose,onSearchableFromReset:this.handleFilterReset,onSearchableFromSubmit:this.handleFilterSubmit,onSearchableFromInit:this.handleFilterInit,headerToolbarRender:this.renderHeaderToolbar,footerToolbarRender:this.renderFooterToolbar,data:i.mergedData,loading:i.loading,offset:i.offset,host:this,filterItemIndex:this.filterItemIndex,onDbClick:this.props.rowDbClick,testIdBuilder:O==null?void 0:O.getChild("body")})},h.prototype.render=function(){var t=this.props,e=t.className,r=t.style,n=t.render,a=t.store,i=t.classnames;t.translate;var o=t.testIdBuilder,l=t.id,s=t.mobileUI;return I.createElement("div",T({className:i("Crud",e,{"is-loading":a.loading,"is-mobile":s}),style:r,"data-id":l,"data-role":"container"},o==null?void 0:o.getChild("wrapper").getTestId()),this.renderFilter(),this.renderSelection(),this.renderBody(),n("dialog",T(T({},a.dialogSchema),{type:"dialog"}),{key:"dialog",data:a.dialogData,onConfirm:this.handleDialogConfirm,onClose:this.handleDialogClose,show:a.dialogOpen}))},h.propsList=["bulkActions","itemActions","mode","orderField","syncLocation","toolbar","toolbarInline","messages","value","options","multiple","valueField","defaultParams","bodyClassName","perPageAvailable","pageField","perPageField","totalField","pageDirectionField","hideQuickSaveBtn","autoJumpToTopOnPagerChange","interval","silentPolling","stopAutoRefreshWhen","stopAutoRefreshWhenModalIsOpen","api","affixHeader","columnsTogglable","placeholder","tableClassName","headerClassName","footerClassName","headerToolbar","footerToolbar","filterTogglable","filterDefaultVisible","autoGenerateFilter","syncResponse2Query","keepItemSelectionOnPageChange","labelTpl","labelField","loadDataOnce","loadDataOnceFetchOnFilter","source","header","columns","size","onChange","onInit","onSaved","onSave","onQuery","formStore","autoFillHeight","maxTagCount","overflowTagPopover","parsePrimitiveQuery","matchFunc","loadMoreProps"],h.defaultProps={toolbarInline:!0,headerToolbar:["bulkActions"],footerToolbar:["statistics","pagination"],primaryField:"id",syncLocation:!0,pageField:"page",perPageField:"perPage",totalField:"total",pageDirectionField:"pageDir",hideQuickSaveBtn:!1,autoJumpToTopOnPagerChange:!0,silentPolling:!1,filterTogglable:!1,filterDefaultVisible:!0,loadDataOnce:!1,autoFillHeight:!1,parsePrimitiveQuery:!0,loadMoreProps:{showIcon:!0,showText:!0,iconType:"loading-outline",contentText:{contentdown:"点击加载更多",contentrefresh:"加载中...",contentnomore:"没有更多数据了"}}},h}(I.Component),et=function(D){ae(h,D);function h(t,e){var r=D.call(this,t)||this,n=e;return n.registerComponent(r),r}return h.prototype.componentWillUnmount=function(){D.prototype.componentWillUnmount.call(this);var t=this.context;t.unRegisterComponent(this)},h.prototype.reload=function(t,e,r,n,a,i){var o,l=this.context;return i!=null&&i.index||i!=null&&i.condition?(o=this.control)===null||o===void 0?void 0:o.reload("",e,r,void 0,void 0,i):t?l.reload(e?"".concat(t,"?").concat(ye(e)):t,r):D.prototype.reload.call(this,t,e,r,n,a,i)},h.prototype.receive=function(t,e,r,n,a){return _(this,void 0,void 0,function(){var i;return x(this,function(o){return i=this.context,e?[2,i.send(e,t)]:[2,D.prototype.receive.call(this,t,void 0,r,n,a)]})})},h.prototype.reloadTarget=function(t,e){var r=this.context;r.reload(t,e)},h.prototype.closeTarget=function(t){var e=this.context;e.close(t)},h.prototype.setData=function(t,e,r,n){var a,i,o;return _(this,void 0,void 0,function(){var l,s,c;return x(this,function(f){return l=this.props.store,r!==void 0||n!==void 0?[2,(i=(a=this.control)===null||a===void 0?void 0:a.setData)===null||i===void 0?void 0:i.call(a,t,e,r,n)]:(s=(t==null?void 0:t.total)||(t==null?void 0:t.count),c=(o=t.rows)!==null&&o!==void 0?o:t.items,s!==void 0&&l.updateTotal(parseInt(s,10)),[2,l.updateData(T(T({},t),c?{items:c}:{}),void 0,e)])})})},h.prototype.getData=function(){var t=this.props,e=t.store,r=t.data;return e.getData(r)},h.contextType=Ue,h}(Ze),nt=function(D){ae(h,D);function h(){return D!==null&&D.apply(this,arguments)||this}return h=qe([Ve({type:"crud",storeType:We.name,isolateScope:!0})],h),h}(et);export{nt as CRUDRenderer,et as CRUDRendererBase,Ze as default};
