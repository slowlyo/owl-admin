const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/esm-COTZMCB4.js","assets/index-Z33w_AY6.js","assets/index-C-Yoix6T.css"])))=>i.map(i=>d[i]);
import{$o as e,Ao as t,Fo as n,Hn as r,Ko as i,La as a,Mo as o,No as s,Oa as c,Po as l,jo as u,kr as d,ti as f,wr as p,ya as m,za as h}from"./index-Z33w_AY6.js";var g=e(i()),_=function(e){s(n,e);function n(t){var n=e.call(this,t)||this;return n.rootElement=g.createRef(),n.state={loading:!1},n}return n.prototype.componentDidMount=function(){this.rootElement?.current&&this.renderWord()},n.prototype.componentDidUpdate=function(e){var t=this,n;if(!this.state.loading){var r=this.props;f(e.src,r.src,e.data,r.data)&&this.fetchWord().then(function(){t.renderWord()}),r.name&&e.data[r.name]!==r.data[r.name]&&this.renderWord(),(JSON.stringify(e.wordOptions)!==JSON.stringify(r.wordOptions)||e.display!==r.display)&&this.renderWord(),r.wordOptions?.enableVar&&(r.trackExpression&&m(r.trackExpression,r.data)!==m(e.trackExpression,e.data)?this.renderWord():(n=this.office)==null||n.updateVariable())}},n.prototype.doAction=function(e,t,n,r){var i,a,o=e?.actionType;o===`saveAs`&&((i=this.office)==null||i.download(r?.name||this.fileName)),o===`print`&&((a=this.office)==null||a.print())},n.prototype.evalVar=function(e,t){var n=this.props.data;return a("${"+e+`}`,c(t,n),`| raw`)},n.prototype.renderWord=function(){return u(this,void 0,void 0,function(){var e,t,n;return l(this,function(r){switch(r.label){case 0:return e=this.props,t=e.src,n=e.name,t?this.document?[3,2]:[4,this.fetchWord()]:[3,4];case 1:r.sent(),r.label=2;case 2:return[4,this.renderRemoteWord()];case 3:return r.sent(),[3,5];case 4:n&&this.renderFormFile(),r.label=5;case 5:return[2]}})})},n.prototype.fetchWord=function(){return u(this,void 0,void 0,function(){var e,t,n,r,i,o,s,c;return l(this,function(l){switch(l.label){case 0:if(e=this.props,t=e.env,n=e.src,r=e.data,i=e.translate,s=n?a(n,r,`| raw`):void 0,typeof s==`string`?(o=s,this.fileName=o.split(`/`).pop()):typeof s==`object`&&typeof s.value==`string`&&(o=s.value,this.fileName=s.name||o.split(`/`).pop()),!o)return console.warn(`file src is empty`),[2];this.finalSrc=o,this.setState({loading:!0}),l.label=1;case 1:return l.trys.push([1,3,4,5]),[4,t.fetcher(o,r,{responseType:`arraybuffer`})];case 2:return c=l.sent(),this.document=c.data,[3,5];case 3:return l.sent(),this.rootElement?.current&&(this.rootElement.current.innerHTML=i(`loadingFailed`)+` url:`+o),[3,5];case 4:return this.setState({loading:!1}),[7];case 5:return[2]}})})},n.prototype.initOffice=function(e,n){return u(this,void 0,void 0,function(){var r,i,a,o,s,c;return l(this,function(l){switch(l.label){case 0:return r=this.props,i=r.wordOptions,a=r.excelOptions,r.env,r.src,o=r.data,r.translate,s=e.createOfficeViewer,[4,s(n||this.document,{},this.finalSrc)];case 1:return c=l.sent(),c instanceof e.Word?(c.updateOptions(t(t({},i),{data:o,evalVar:this.evalVar.bind(this)})),[3,4]):[3,2];case 2:return c instanceof e.Excel?(c.updateOptions(t(t({},a),{data:o,evalVar:this.evalVar.bind(this)})),[4,c.loadExcel()]):[3,4];case 3:l.sent(),l.label=4;case 4:return[2,c]}})})},n.prototype.renderRemoteWord=function(){return u(this,void 0,void 0,function(){var e,t,n=this;return l(this,function(r){return e=this.props,e.wordOptions,e.excelOptions,e.env,e.src,e.data,t=e.display,e.translate,this.document&&h(()=>import(`./esm-COTZMCB4.js`),__vite__mapDeps([0,1,2])).then(function(e){return u(n,void 0,void 0,function(){var n;return l(this,function(r){switch(r.label){case 0:return[4,this.initOffice(e)];case 1:return n=r.sent(),t===!1?t===!1&&this.rootElement?.current&&(this.rootElement.current.innerHTML=``):n.render(this.rootElement?.current),this.office=n,this.setState({loading:!1}),[2]}})})}),[2]})})},n.prototype.renderFormFile=function(){var e=this;this.setState({loading:!0});var t=this.props;t.wordOptions;var n=t.name,r=t.data,i=t.display,a=r[n];if(a instanceof File){var o=new FileReader;o.onload=function(t){var n=o.result;h(()=>import(`./esm-COTZMCB4.js`),__vite__mapDeps([0,1,2])).then(function(t){return u(e,void 0,void 0,function(){var e;return l(this,function(r){switch(r.label){case 0:return[4,this.initOffice(t,n)];case 1:return e=r.sent(),i===!1?i===!1&&this.rootElement?.current&&(this.rootElement.current.innerHTML=``):e.render(this.rootElement?.current),this.office=e,this.setState({loading:!1}),[2]}})})})},o.readAsArrayBuffer(a)}else this.setState({loading:!1})},n.prototype.render=function(){var e=this.props,t=e.classnames;e.translate;var n=e.className,i=e.loading,a=i===void 0?!1:i,o=e.src,s=e.name,c=e.display,l=e.loadingConfig;return g.createElement(`div`,null,c!==!1&&!o&&!s&&g.createElement(`svg`,{width:`100%`,height:`100`,xmlns:`http://www.w3.org/2000/svg`},g.createElement(`rect`,{x:`0`,y:`0`,width:`100%`,height:`100`,style:{fill:`#F7F7F9`}}),g.createElement(`text`,{x:`50%`,y:`50%`,fontSize:`18`,textAnchor:`middle`,alignmentBaseline:`middle`,fontFamily:`monospace, sans-serif`,fill:`#555555`},`office viewer`)),g.createElement(`div`,{ref:this.rootElement,className:t(`office-viewer`,n)}),g.createElement(r,{overlay:!0,key:`info`,show:a&&this.state.loading,loadingConfig:l}))},n}(g.Component),v=function(e){s(t,e);function t(t,n){var r=e.call(this,t)||this;return n.registerComponent(r),r}return t.prototype.componentWillUnmount=function(){var t;(t=e.prototype.componentWillUnmount)==null||t.call(this),this.context.unRegisterComponent(this)},t.contextType=d,t=o([p({type:`office-viewer`}),n(`design:paramtypes`,[Object,Object])],t),t}(_);export{v as OfficeViewerRenderer,_ as default};