import{$o as e,$t as t,Ao as n,Ci as r,Fo as i,Go as a,Hn as o,Ia as s,Io as c,J as l,Ko as u,Mo as d,Nn as f,No as p,Nr as m,Nt as h,Pn as g,Po as _,Ro as v,Rt as y,Ya as b,dr as x,hi as S,hr as C,jo as w,ki as T,mr as E,no as D,on as O,rn as k}from"./index-Z33w_AY6.js";var A=e(u()),j=e(S()),M=e(k()),N=e(O()),P=e(h()),F=e(D()),I=a(),L=function(e){p(a,e);function a(t){var n=e.call(this,t)||this;return n.input=A.createRef(),n.state={isOpened:!1,inputValue:``,isFocused:!1,selectedOptions:t.selectedOptions,cacheOptions:[]},n}return a.prototype.componentDidUpdate=function(e){var t=this.props;e.value!==t.value&&this.setState({inputValue:``})},a.prototype.doAction=function(e,t,n){var r=this.props,i=r.resetValue,a=r.onChange,o=r.formStore,c=r.store,l=r.name,u=e?.actionType;if(u===`clear`)a?.(``);else if(u===`reset`){var d=s(o?.pristine??c?.pristine,l)??i;a?.(d??``)}},a.prototype.dispatchEvent=function(e,t){return t===void 0&&(t={}),w(this,void 0,void 0,function(){var r,i,a,o;return _(this,function(s){switch(s.label){case 0:return r=this.props,i=r.dispatchEvent,a=r.options,[4,i(e,m(this.props,n({options:a,items:a},t)))];case 1:return o=s.sent(),[2,!!o?.prevented]}})})},a.prototype.normalizeInputValue=function(e){var t=this.props,n=t.enableBatchAdd,r=t.separator,i=t.valueField,a=t.labelField,o=t.delimiter,s=[];if(n&&r&&typeof r==`string`)s=e.split(r);else{var l=(0,F.default)((0,P.default)(e.split(o||`,`)));s.push.apply(s,v([],c(l),!1))}return s.filter(Boolean).map(function(e){var t;return t={},t[`${i||`value`}`]=e,t[`${a||`label`}`]=e,t})},a.prototype.normalizeOptions=function(e){var t=this.props,n=t.joinValues,r=t.extractValue,i=t.delimiter,a=t.valueField;return n?e.map(function(e){return e[a||`value`]}).join(i||`,`):r?e.map(function(e){return e[a||`value`]}):e},a.prototype.normalizeMergedValue=function(e,t){t===void 0&&(t=!0);var n=this.props,r=n.selectedOptions,i=n.valueField,a=(0,N.default)(r.concat(),this.normalizeInputValue(e),function(e,t){return e[i||`value`]===t[i||`value`]});return t?this.normalizeOptions(a):a},a.prototype.validateInputValue=function(e){var t=this.props,n=t.max,r=t.maxTagLength;t.enableBatchAdd,t.separator;var i=t.onInputValidateFailed,a=t.valueField,o=this.normalizeMergedValue(e,!1);if(n!=null&&(0,M.default)(n)&&o.length>n)return i?.(o.map(function(e){return e[a||`value`]}),`max`),!1;var s=this.normalizeInputValue(e);return r!=null&&(0,M.default)(r)&&s.some(function(e){return e[a||`value`].length>r})?(i?.(s.map(function(e){return e[a||`value`]}),`maxLength`),!1):!0},a.prototype.getValue=function(e,t,n){e===void 0&&(e=`normal`),t===void 0&&(t={});var r=this.props,i=r.joinValues,a=r.extractValue,o=r.delimiter,s=r.valueField;n||=this.props.selectedOptions;var c=n.concat();return e===`push`?c.push(t):e===`pop`&&c.pop(),i?c.map(function(e){return e[s||`value`]}).join(o||`,`):a?c.map(function(e){return e[s||`value`]}):c},a.prototype.addItem=function(e){return w(this,void 0,void 0,function(){var t,n,r,i,a,o,s;return _(this,function(c){switch(c.label){case 0:return this.isReachMax()||(t=this.props,n=t.selectedOptions,r=t.onChange,i=t.valueField,a=n.concat(),(0,j.default)(a,function(t){return t[i||`value`]==e[i||`value`]}))?[2]:(o=this.getValue(`push`,e),[4,this.dispatchEvent(`change`,{value:o,selectedItems:n.concat(e)})]);case 1:return s=c.sent(),s||r(o),[2]}})})},a.prototype.addItem2=function(e){var t=this.props,n=t.mobileUI,r=t.valueField,i=r===void 0?`value`:r;if(n){var a=this.state.selectedOptions.concat(),o=a.findIndex(function(t){return t[i]===e[i]});~o?a.splice(o,1):this.isReachMaxFromState()||a.push(e),this.setState({selectedOptions:a})}},a.prototype.isExist=function(e){var t=this.props,n=t.options,r=t.valueField,i=r===void 0?`value`:r,a=this.state.cacheOptions;return n.some(function(t){return t[i]===e})||a.some(function(t){return t[i]===e})},a.prototype.addSelection=function(){var e=this.state.inputValue,t=this.props.maxTagLength,n=this.state.selectedOptions.slice(),r=this.state.cacheOptions.slice();if(t!==void 0&&(e=e.trim(),e=e.slice(0,t)),!this.isExist(e)&&e&&!this.isReachMaxFromState()){var i=this.normalizeInputValue(e);n.push(i[0]),r.push(i[0]),this.setState({inputValue:``,selectedOptions:n,cacheOptions:r})}},a.prototype.onConfirm=function(){return w(this,void 0,void 0,function(){var e,t,n,r;return _(this,function(i){switch(i.label){case 0:return e=this.state.selectedOptions,t=this.props.onChange,n=this.getValue(`normal`,{},e),[4,this.dispatchEvent(`change`,{value:n,selectedItems:e})];case 1:return r=i.sent(),r||t(n),this.close(),[2]}})})},a.prototype.handleFocus=function(e){var t,n;return w(this,void 0,void 0,function(){var r,i;return _(this,function(a){switch(a.label){case 0:return this.setState({isFocused:!0,isOpened:!0,selectedOptions:this.props.selectedOptions}),r=this.getValue(`normal`),[4,this.dispatchEvent(`focus`,{value:r,selectedItems:this.props.selectedOptions})];case 1:return i=a.sent(),i||(n=(t=this.props).onFocus)==null||n.call(t,e),[2]}})})},a.prototype.handleBlur=function(e){var t,n;return w(this,void 0,void 0,function(){var r,i,a,o,s,c,l,u;return _(this,function(d){switch(d.label){case 0:return r=this.props,i=r.selectedOptions,a=r.onChange,o=r.mobileUI,s=r.options,o&&s.length?[2]:(c=this.state.inputValue.trim(),this.validateInputValue(c)?(l=this.normalizeMergedValue(c),[4,this.dispatchEvent(`blur`,{value:l,selectedItems:i})]):(this.setState({isFocused:!1,isOpened:!1}),[2]));case 1:return u=d.sent(),u||(n=(t=this.props).onBlur)==null||n.call(t,e),this.setState({isFocused:!1,isOpened:!1,inputValue:``},c?function(){i.length!==l.length&&a?.(l)}:void 0),[2]}})})},a.prototype.close=function(){this.setState({isOpened:!1})},a.prototype.handleInputChange=function(e){this.setState({inputValue:e})},a.prototype.handleChange=function(e){return w(this,void 0,void 0,function(){var t,n,r,i,a,o,s,c;return _(this,function(l){switch(l.label){case 0:return t=this.props,n=t.joinValues,r=t.extractValue,i=t.delimiter,a=t.valueField,o=t.onChange,s=Array.isArray(e)?e.concat():[],(n||r)&&(s=e.map(function(e){return e[a||`value`]})),n&&(s=s.join(i||`,`)),[4,this.dispatchEvent(`change`,{value:s,selectedItems:e})];case 1:return c=l.sent(),c||o(s),[2]}})})},a.prototype.renderItem=function(e){return`${e[this.props.labelField||`label`]}`},a.prototype.handleKeyDown=function(e){return w(this,void 0,void 0,function(){var t,n,r,i,a,o,s,c,s,c;return _(this,function(l){switch(l.label){case 0:return t=this.props,n=t.selectedOptions,r=t.onChange,i=t.delimiter,t.labelField,t.valueField,a=this.state.inputValue.trim(),o=n.concat(this.normalizeMergedValue(a,!1)),n.length&&!a&&e.key==`Backspace`?(s=this.getValue(`pop`),[4,this.dispatchEvent(`change`,{value:s,selectedItems:o})]):[3,2];case 1:return c=l.sent(),c||r(s),[3,5];case 2:return a&&(e.key===`Enter`||e.key===i)?(e.preventDefault(),e.stopPropagation(),s=this.normalizeMergedValue(a),[4,this.dispatchEvent(`change`,{value:s,selectedItems:o})]):[3,4];case 3:return c=l.sent(),this.validateInputValue(a)?(!c&&n.length!==s.length&&r(s),this.setState({inputValue:``}),[3,5]):(this.setState({isFocused:!1,isOpened:!1}),[2]);case 4:!a&&e.key===`Enter`&&this.handleBlur(e),l.label=5;case 5:return[2]}})})},a.prototype.handleOptionChange=function(e){if(this.props.mobileUI){this.addItem2(e);return}this.isReachMax()||!e||this.addItem(e)},a.prototype.getTarget=function(){return this.input.current},a.prototype.getParent=function(){return this.input.current&&(0,I.findDOMNode)(this.input.current).parentElement},a.prototype.reload=function(e,t){var n=this.props.reloadOptions;n&&n(e,t)},a.prototype.isReachMax=function(){var e=this.props,t=e.max,n=e.selectedOptions;return t!=null&&(0,M.default)(t)&&n.length>=t},a.prototype.isReachMaxFromState=function(){var e=this.state.selectedOptions,t=this.props.max;return t!=null&&(0,M.default)(t)&&e.length>=t},a.prototype.render=function(){var e=this,r=this.props,i=r.className;r.style;var a=r.classnames,s=r.disabled,c=r.placeholder,l=r.name,u=r.clearable,d=r.selectedOptions,p=r.loading,m=r.popOverContainer,h=r.dropdown,_=r.options,v=r.optionsTip,x=r.maxTagCount,S=r.overflowTagPopover,w=r.translate,D=r.loadingConfig,O=r.valueField,k=r.env,j=r.mobileUI,M=r.labelField,N=r.testIdBuilder,P=this.state.inputValue,F=Array.isArray(_)?T(_,function(e,t,n,r){return e[O||`value`]!==void 0&&(j||!~d.indexOf(e))&&(b([e].concat(r),P,{keys:[M||`label`,O||`value`],threshold:b.rankings.CONTAINS}).length||Array.isArray(e.children)&&!!e.children.length)},0,!0):[],I=this.isReachMax();return A.createElement(f,{selectedItem:d,isOpen:j?this.state.isOpened:this.state.isFocused,inputValue:this.state.inputValue,onChange:this.handleOptionChange,itemToString:this.renderItem},function(r){var f=r.isOpen,b=r.highlightedIndex,T=r.getItemProps,M=r.getInputProps;return A.createElement(`div`,{className:a(i,`TagControl`)},A.createElement(t,n({},M({name:l,ref:e.input,placeholder:w(c??`Tag.placeholder`),value:e.state.inputValue,onKeyDown:e.handleKeyDown,onFocus:j?void 0:e.handleFocus,onBlur:e.handleBlur,disabled:s}),{onResultClick:j?e.handleFocus:void 0,inputPlaceholder:``,onChange:e.handleInputChange,className:a(`TagControl-input`),result:d,onResultChange:e.handleChange,itemRender:e.renderItem,clearable:u,maxTagCount:x,overflowTagPopover:S,popOverContainer:m||k.getModalContainer,allowInput:!j||j&&!_?.length,mobileUI:j,testIdBuilder:N?.getChild(`resule-box`)}),p?A.createElement(o,{loadingConfig:D,size:`sm`}):void 0),h===!1?A.createElement(`div`,{className:a(`TagControl-sug`)},v?A.createElement(`div`,{className:a(`TagControl-sugTip`)},w(v)):null,_.map(function(t,n){return A.createElement(`div`,{className:a(`TagControl-sugItem`,{"is-disabled":t.disabled||s||I}),key:n,onClick:e.addItem.bind(e,t)},t.label)})):j?A.createElement(g,{className:a(`Tag-popup`),container:j?k?.getModalContainer:m||k.getModalContainer,isShow:f&&!!F.length,showConfirm:!0,onConfirm:e.onConfirm,onHide:e.close},A.createElement(`div`,null,A.createElement(y,{selectedOptions:d,mobileUI:j,options:F.concat(e.state.cacheOptions),itemRender:e.renderItem,highlightIndex:b,getItemProps:function(t){var r=t.item,i=t.index;return n({},T({index:i,item:r,className:a(`ListMenu-item`,{"is-active":~(e.state.selectedOptions.map(function(e){return e[O]})||[]).indexOf(r[O])})}))}}),j&&!e.isReachMaxFromState()?A.createElement(`div`,{className:a(`ListMenu-add-wrap`)},A.createElement(t,{placeholder:w(`placeholder.enter`)+`...`,allowInput:!0,value:e.state.inputValue,mobileUI:j,clearable:!0,maxTagCount:x,onChange:function(t){e.setState({inputValue:t})},onBlur:e.addSelection})):null)):A.createElement(C,{container:m||e.getParent,target:e.getTarget,placement:`auto`,show:f&&!!F.length},A.createElement(E,{overlay:!0,className:a(`TagControl-popover`),onHide:e.close},A.createElement(y,{options:F,itemRender:e.renderItem,highlightIndex:b,testIdBuilder:N?.getChild(`options`),getItemProps:function(e){var t=e.item,r=e.index;return n({},T({index:r,item:t,disabled:I||t.disabled,className:a(`ListMenu-item`,{"is-disabled":I})}))}}))))})},a.defaultProps={resetValue:``,labelField:`label`,valueField:`value`,multiple:!0,placeholder:`Tag.placeholder`,optionsTip:`Tag.tip`,separator:`-`},d([r,i(`design:type`,Function),i(`design:paramtypes`,[String,Object]),i(`design:returntype`,Promise)],a.prototype,`dispatchEvent`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[String,Object,Array]),i(`design:returntype`,void 0)],a.prototype,`getValue`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[]),i(`design:returntype`,void 0)],a.prototype,`addSelection`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[]),i(`design:returntype`,Promise)],a.prototype,`onConfirm`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[Object]),i(`design:returntype`,Promise)],a.prototype,`handleFocus`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[Object]),i(`design:returntype`,Promise)],a.prototype,`handleBlur`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[]),i(`design:returntype`,void 0)],a.prototype,`close`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[String]),i(`design:returntype`,void 0)],a.prototype,`handleInputChange`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[Array]),i(`design:returntype`,Promise)],a.prototype,`handleChange`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[Object]),i(`design:returntype`,Object)],a.prototype,`renderItem`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[Object]),i(`design:returntype`,Promise)],a.prototype,`handleKeyDown`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[Object]),i(`design:returntype`,void 0)],a.prototype,`handleOptionChange`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[]),i(`design:returntype`,void 0)],a.prototype,`getTarget`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[]),i(`design:returntype`,void 0)],a.prototype,`getParent`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[]),i(`design:returntype`,void 0)],a.prototype,`isReachMax`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[]),i(`design:returntype`,void 0)],a.prototype,`isReachMaxFromState`,null),d([l(),i(`design:type`,Function),i(`design:paramtypes`,[]),i(`design:returntype`,void 0)],a.prototype,`render`,null),a}(A.PureComponent),R=function(e){p(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t=d([x({type:`input-tag`})],t),t}(L);export{R as TagControlRenderer,L as default};