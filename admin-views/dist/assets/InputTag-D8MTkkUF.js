import{t as L,l as h,am as W,G as I,H as C,bt as J,bu as X,a$ as Y,aK as Z,bv as ee,bw as S,ax as te,bx as ne,bl as ae,by as U,z as _,P as ie,bz as re,bA as k,aa as se,ab as oe,D as c,Q as v,T as o,ap as le,br as ue,ah as pe,aM as de,bm as D}from"./index-CG72qQQo.js";var ce=function(V){L(s,V);function s(t){var e=V.call(this,t)||this;return e.input=h.createRef(),e.state={isOpened:!1,inputValue:"",isFocused:!1,selectedOptions:t.selectedOptions,cacheOptions:[]},e}return s.prototype.componentDidUpdate=function(t){var e=this.props;t.value!==e.value&&this.setState({inputValue:""})},s.prototype.doAction=function(t,e,a){var n,r,i=this.props,u=i.resetValue,l=i.onChange,p=i.formStore,d=i.store,g=i.name,F=t==null?void 0:t.actionType;if(F==="clear")l==null||l("");else if(F==="reset"){var y=(r=W((n=p==null?void 0:p.pristine)!==null&&n!==void 0?n:d==null?void 0:d.pristine,g))!==null&&r!==void 0?r:u;l==null||l(y??"")}},s.prototype.dispatchEvent=function(t,e){return e===void 0&&(e={}),I(this,void 0,void 0,function(){var a,n,r,i;return C(this,function(u){switch(u.label){case 0:return a=this.props,n=a.dispatchEvent,r=a.options,[4,n(t,pe(this.props,_({options:r,items:r},e)))];case 1:return i=u.sent(),[2,!!(i!=null&&i.prevented)]}})})},s.prototype.normalizeInputValue=function(t){var e=this.props,a=e.enableBatchAdd,n=e.separator,r=e.valueField,i=e.labelField,u=e.delimiter,l=[];if(a&&n&&typeof n=="string")l=t.split(n);else{var p=J(X(t.split(u||",")));l.push.apply(l,Y([],Z(p),!1))}return l.filter(Boolean).map(function(d){var g;return g={},g["".concat(r||"value")]=d,g["".concat(i||"label")]=d,g})},s.prototype.normalizeOptions=function(t){var e=this.props,a=e.joinValues,n=e.extractValue,r=e.delimiter,i=e.valueField;return a?t.map(function(u){return u[i||"value"]}).join(r||","):n?t.map(function(u){return u[i||"value"]}):t},s.prototype.normalizeMergedValue=function(t,e){e===void 0&&(e=!0);var a=this.props,n=a.selectedOptions,r=a.valueField,i=ee(n.concat(),this.normalizeInputValue(t),function(u,l){return u[r||"value"]===l[r||"value"]});return e?this.normalizeOptions(i):i},s.prototype.validateInputValue=function(t){var e=this.props,a=e.max,n=e.maxTagLength;e.enableBatchAdd,e.separator;var r=e.onInputValidateFailed,i=e.valueField,u=this.normalizeMergedValue(t,!1);if(a!=null&&S(a)&&u.length>a)return r==null||r(u.map(function(p){return p[i||"value"]}),"max"),!1;var l=this.normalizeInputValue(t);return n!=null&&S(n)&&l.some(function(p){return p[i||"value"].length>n})?(r==null||r(l.map(function(p){return p[i||"value"]}),"maxLength"),!1):!0},s.prototype.getValue=function(t,e,a){t===void 0&&(t="normal"),e===void 0&&(e={});var n=this.props,r=n.joinValues,i=n.extractValue,u=n.delimiter,l=n.valueField;a=a||this.props.selectedOptions;var p=a.concat();return t==="push"?p.push(e):t==="pop"&&p.pop(),r?p.map(function(d){return d[l||"value"]}).join(u||","):i?p.map(function(d){return d[l||"value"]}):p},s.prototype.addItem=function(t){return I(this,void 0,void 0,function(){var e,a,n,r,i,u,l;return C(this,function(p){switch(p.label){case 0:return this.isReachMax()?[2]:(e=this.props,a=e.selectedOptions,n=e.onChange,r=e.valueField,i=a.concat(),de(i,function(d){return d[r||"value"]==t[r||"value"]})?[2]:(u=this.getValue("push",t),[4,this.dispatchEvent("change",{value:u,selectedItems:a.concat(t)})]));case 1:return l=p.sent(),l||n(u),[2]}})})},s.prototype.addItem2=function(t){var e=this.props,a=e.mobileUI,n=e.valueField,r=n===void 0?"value":n;if(a){var i=this.state.selectedOptions.concat(),u=i.findIndex(function(l){return l[r]===t[r]});~u?i.splice(u,1):this.isReachMaxFromState()||i.push(t),this.setState({selectedOptions:i})}},s.prototype.isExist=function(t){var e=this.props,a=e.options,n=e.valueField,r=n===void 0?"value":n,i=this.state.cacheOptions;return a.some(function(u){return u[r]===t})||i.some(function(u){return u[r]===t})},s.prototype.addSelection=function(){var t=this.state.inputValue,e=this.props.maxTagLength,a=this.state.selectedOptions.slice(),n=this.state.cacheOptions.slice();if(e!==void 0&&(t=t.trim(),t=t.slice(0,e)),!this.isExist(t)&&t&&!this.isReachMaxFromState()){var r=this.normalizeInputValue(t);a.push(r[0]),n.push(r[0]),this.setState({inputValue:"",selectedOptions:a,cacheOptions:n})}},s.prototype.onConfirm=function(){return I(this,void 0,void 0,function(){var t,e,a,n;return C(this,function(r){switch(r.label){case 0:return t=this.state.selectedOptions,e=this.props.onChange,a=this.getValue("normal",{},t),[4,this.dispatchEvent("change",{value:a,selectedItems:t})];case 1:return n=r.sent(),n||e(a),this.close(),[2]}})})},s.prototype.handleFocus=function(t){var e,a;return I(this,void 0,void 0,function(){var n,r;return C(this,function(i){switch(i.label){case 0:return this.setState({isFocused:!0,isOpened:!0,selectedOptions:this.props.selectedOptions}),n=this.getValue("normal"),[4,this.dispatchEvent("focus",{value:n,selectedItems:this.props.selectedOptions})];case 1:return r=i.sent(),r||((a=(e=this.props).onFocus)===null||a===void 0||a.call(e,t)),[2]}})})},s.prototype.handleBlur=function(t){var e,a;return I(this,void 0,void 0,function(){var n,r,i,u,l,p,d,g;return C(this,function(F){switch(F.label){case 0:return n=this.props,r=n.selectedOptions,i=n.onChange,u=n.mobileUI,l=n.options,u&&l.length?[2]:(p=this.state.inputValue.trim(),this.validateInputValue(p)?(d=this.normalizeMergedValue(p),[4,this.dispatchEvent("blur",{value:d,selectedItems:r})]):(this.setState({isFocused:!1,isOpened:!1}),[2]));case 1:return g=F.sent(),g||((a=(e=this.props).onBlur)===null||a===void 0||a.call(e,t)),this.setState({isFocused:!1,isOpened:!1,inputValue:""},p?function(){r.length!==d.length&&(i==null||i(d))}:void 0),[2]}})})},s.prototype.close=function(){this.setState({isOpened:!1})},s.prototype.handleInputChange=function(t){this.setState({inputValue:t})},s.prototype.handleChange=function(t){return I(this,void 0,void 0,function(){var e,a,n,r,i,u,l,p;return C(this,function(d){switch(d.label){case 0:return e=this.props,a=e.joinValues,n=e.extractValue,r=e.delimiter,i=e.valueField,u=e.onChange,l=Array.isArray(t)?t.concat():[],(a||n)&&(l=t.map(function(g){return g[i||"value"]})),a&&(l=l.join(r||",")),[4,this.dispatchEvent("change",{value:l,selectedItems:t})];case 1:return p=d.sent(),p||u(l),[2]}})})},s.prototype.renderItem=function(t){var e=this.props.labelField;return"".concat(t[e||"label"])},s.prototype.handleKeyDown=function(t){return I(this,void 0,void 0,function(){var e,a,n,r,i,u,l,p,l,p;return C(this,function(d){switch(d.label){case 0:return e=this.props,a=e.selectedOptions,n=e.onChange,r=e.delimiter,e.labelField,e.valueField,i=this.state.inputValue.trim(),u=a.concat(this.normalizeMergedValue(i,!1)),a.length&&!i&&t.key=="Backspace"?(l=this.getValue("pop"),[4,this.dispatchEvent("change",{value:l,selectedItems:u})]):[3,2];case 1:return p=d.sent(),p||n(l),[3,5];case 2:return i&&(t.key==="Enter"||t.key===r)?(t.preventDefault(),t.stopPropagation(),l=this.normalizeMergedValue(i),[4,this.dispatchEvent("change",{value:l,selectedItems:u})]):[3,4];case 3:return p=d.sent(),this.validateInputValue(i)?(!p&&a.length!==l.length&&n(l),this.setState({inputValue:""}),[3,5]):(this.setState({isFocused:!1,isOpened:!1}),[2]);case 4:!i&&t.key==="Enter"&&this.handleBlur(t),d.label=5;case 5:return[2]}})})},s.prototype.handleOptionChange=function(t){var e=this.props.mobileUI;if(e){this.addItem2(t);return}this.isReachMax()||!t||this.addItem(t)},s.prototype.getTarget=function(){return this.input.current},s.prototype.getParent=function(){return this.input.current&&te.findDOMNode(this.input.current).parentElement},s.prototype.reload=function(t,e){var a=this.props.reloadOptions;a&&a(t,e)},s.prototype.isReachMax=function(){var t=this.props,e=t.max,a=t.selectedOptions;return e!=null&&S(e)&&a.length>=e},s.prototype.isReachMaxFromState=function(){var t=this.state.selectedOptions,e=this.props.max;return e!=null&&S(e)&&t.length>=e},s.prototype.render=function(){var t=this,e=this.props,a=e.className;e.style;var n=e.classnames,r=e.disabled,i=e.placeholder,u=e.name,l=e.clearable,p=e.selectedOptions,d=e.loading,g=e.popOverContainer,F=e.dropdown,y=e.options,N=e.optionsTip,z=e.maxTagCount,$=e.overflowTagPopover,R=e.translate,K=e.loadingConfig,w=e.valueField,T=e.env,m=e.mobileUI,H=e.labelField,x=e.testIdBuilder,q=this.state.inputValue,E=Array.isArray(y)?ne(y,function(b,j,B,P){return b[w||"value"]!==void 0&&(m||!~p.indexOf(b))&&(D([b].concat(P),q,{keys:[H||"label",w||"value"],threshold:D.rankings.CONTAINS}).length||Array.isArray(b.children)&&!!b.children.length)},0,!0):[],M=this.isReachMax();return h.createElement(ae,{selectedItem:p,isOpen:m?this.state.isOpened:this.state.isFocused,inputValue:this.state.inputValue,onChange:this.handleOptionChange,itemToString:this.renderItem},function(b){var j=b.isOpen,B=b.highlightedIndex,P=b.getItemProps,G=b.getInputProps;return h.createElement("div",{className:n(a,"TagControl")},h.createElement(U,_({},G({name:u,ref:t.input,placeholder:R(i??"Tag.placeholder"),value:t.state.inputValue,onKeyDown:t.handleKeyDown,onFocus:m?void 0:t.handleFocus,onBlur:t.handleBlur,disabled:r}),{onResultClick:m?t.handleFocus:void 0,inputPlaceholder:"",onChange:t.handleInputChange,className:n("TagControl-input"),result:p,onResultChange:t.handleChange,itemRender:t.renderItem,clearable:l,maxTagCount:z,overflowTagPopover:$,popOverContainer:g||T.getModalContainer,allowInput:!m||m&&!(y!=null&&y.length),mobileUI:m,testIdBuilder:x==null?void 0:x.getChild("resule-box")}),d?h.createElement(ie,{loadingConfig:K,size:"sm"}):void 0),F!==!1?m?h.createElement(re,{className:n("Tag-popup"),container:m?T==null?void 0:T.getModalContainer:g||T.getModalContainer,isShow:j&&!!E.length,showConfirm:!0,onConfirm:t.onConfirm,onHide:t.close},h.createElement("div",null,h.createElement(k,{selectedOptions:p,mobileUI:m,options:E.concat(t.state.cacheOptions),itemRender:t.renderItem,highlightIndex:B,getItemProps:function(f){var O=f.item,A=f.index;return _({},P({index:A,item:O,className:n("ListMenu-item",{"is-active":~(t.state.selectedOptions.map(function(Q){return Q[w]})||[]).indexOf(O[w])})}))}}),m&&!t.isReachMaxFromState()?h.createElement("div",{className:n("ListMenu-add-wrap")},h.createElement(U,{placeholder:R("placeholder.enter")+"...",allowInput:!0,value:t.state.inputValue,mobileUI:m,clearable:!0,maxTagCount:z,onChange:function(f){t.setState({inputValue:f})},onBlur:t.addSelection})):null)):h.createElement(se,{container:g||t.getParent,target:t.getTarget,placement:"auto",show:j&&!!E.length},h.createElement(oe,{overlay:!0,className:n("TagControl-popover"),onHide:t.close},h.createElement(k,{options:E,itemRender:t.renderItem,highlightIndex:B,testIdBuilder:x==null?void 0:x.getChild("options"),getItemProps:function(f){var O=f.item,A=f.index;return _({},P({index:A,item:O,disabled:M||O.disabled,className:n("ListMenu-item",{"is-disabled":M})}))}}))):h.createElement("div",{className:n("TagControl-sug")},N?h.createElement("div",{className:n("TagControl-sugTip")},R(N)):null,y.map(function(f,O){return h.createElement("div",{className:n("TagControl-sugItem",{"is-disabled":f.disabled||r||M}),key:O,onClick:t.addItem.bind(t,f)},f.label)})))})},s.defaultProps={resetValue:"",labelField:"label",valueField:"value",multiple:!0,placeholder:"Tag.placeholder",optionsTip:"Tag.tip",separator:"-"},c([v,o("design:type",Function),o("design:paramtypes",[String,Object]),o("design:returntype",Promise)],s.prototype,"dispatchEvent",null),c([v,o("design:type",Function),o("design:paramtypes",[String,Object,Array]),o("design:returntype",void 0)],s.prototype,"getValue",null),c([v,o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",void 0)],s.prototype,"addSelection",null),c([v,o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],s.prototype,"onConfirm",null),c([v,o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],s.prototype,"handleFocus",null),c([v,o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],s.prototype,"handleBlur",null),c([v,o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",void 0)],s.prototype,"close",null),c([v,o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",void 0)],s.prototype,"handleInputChange",null),c([v,o("design:type",Function),o("design:paramtypes",[Array]),o("design:returntype",Promise)],s.prototype,"handleChange",null),c([v,o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Object)],s.prototype,"renderItem",null),c([v,o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],s.prototype,"handleKeyDown",null),c([v,o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",void 0)],s.prototype,"handleOptionChange",null),c([v,o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",void 0)],s.prototype,"getTarget",null),c([v,o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",void 0)],s.prototype,"getParent",null),c([v,o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",void 0)],s.prototype,"isReachMax",null),c([v,o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",void 0)],s.prototype,"isReachMaxFromState",null),c([le(),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",void 0)],s.prototype,"render",null),s}(h.PureComponent),ve=function(V){L(s,V);function s(){return V!==null&&V.apply(this,arguments)||this}return s=c([ue({type:"input-tag"})],s),s}(ce);export{ve as TagControlRenderer,ce as default};
