import{$o as e,Ci as t,Fo as n,Hn as r,Jn as i,Kn as a,Ko as o,Kr as s,Mo as c,No as l,Po as u,Pr as d,Sn as f,Wn as p,jo as m,kr as h,ni as g,qr as _,ti as v,wr as y,ya as b,zn as x}from"./index-DAdqRbKX.js";var S=e(o()),C=function(e){l(o,e);function o(t){var n=this;n=e.call(this,t)||this;var r=t.store;return r.syncProps(t,void 0,[`pages`]),r.updateActivePage(Object.assign({},t.env??{},{showFullBreadcrumbPath:t.showFullBreadcrumbPath??!1,showBreadcrumbHomePath:t.showBreadcrumbHomePath??!0})),t.env.watchRouteChange&&(n.unWatchRouteChange=t.env.watchRouteChange(function(){return r.updateActivePage(Object.assign({},t.env??{},{showFullBreadcrumbPath:t.showFullBreadcrumbPath??!1,showBreadcrumbHomePath:t.showBreadcrumbHomePath??!0}))})),n}return o.prototype.componentDidMount=function(){return m(this,void 0,void 0,function(){var e,t,n,r;return u(this,function(i){switch(i.label){case 0:return e=this.props,t=e.data,n=e.dispatchEvent,[4,n(`init`,t,this)];case 1:return r=i.sent(),r?.prevented||this.reload(),[2]}})})},o.prototype.componentDidUpdate=function(e){return m(this,void 0,void 0,function(){var t,n;return u(this,function(r){return t=this.props,n=t.store,n.syncProps(t,e,[`pages`]),v(e.api,t.api,e.data,t.data)?this.reload():t.location&&t.location!==e.location&&n.updateActivePage(Object.assign({},t.env??{},{showFullBreadcrumbPath:t.showFullBreadcrumbPath??!1,showBreadcrumbHomePath:t.showBreadcrumbHomePath??!0})),[2]})})},o.prototype.componentWillUnmount=function(){var e;(e=this.unWatchRouteChange)==null||e.call(this)},o.prototype.reload=function(e,t,n,r,i){return m(this,void 0,void 0,function(){var e,n,r,a,o,c,l,d,f,p;return u(this,function(u){switch(u.label){case 0:return t?[2,this.receive(t,void 0,i)]:(e=this.props,n=e.api,r=e.store,a=e.env,o=e.showFullBreadcrumbPath,c=o===void 0?!1:o,l=e.showBreadcrumbHomePath,d=l===void 0?!0:l,f=e.locale,g(n,r.data)?[4,r.fetchInitData(n,r.data,{})]:[3,2]);case 1:p=u.sent(),a.replaceText&&(p.data=_(p.data,a.replaceText,a.replaceTextIgnoreKeys)),p?.data.pages&&(p.data=s(p.data,f),r.setPages(p.data.pages),r.updateActivePage(Object.assign({},a??{},{showFullBreadcrumbPath:c,showBreadcrumbHomePath:d}))),u.label=2;case 2:return[2,r.data]}})})},o.prototype.receive=function(e,t,n){return m(this,void 0,void 0,function(){var t;return u(this,function(r){return t=this.props.store,t.updateData(e,void 0,n),[2,this.reload()]})})},o.prototype.resolveDefinitions=function(e){var t=this.props,n=t.resolveDefinitions;return t.store.schema?.definitions?.[e]||n(e)},o.prototype.handleNavClick=function(e){e.preventDefault();var t=this.props.store,n=this.props.env,r=e.currentTarget.getAttribute(`href`);t.updateOffScreen(!1),n.jumpTo(r,void 0,this.props.data)},o.prototype.renderHeader=function(){var e=this.props,t=e.classnames,n=e.brandName,r=e.header,i=e.render,a=e.store,o=e.logo,s=e.env;return!r&&!o&&!n?null:S.createElement(S.default.Fragment,null,S.createElement(`div`,{className:t(`Layout-brandBar`)},S.createElement(`div`,{onClick:a.toggleOffScreen,className:t(`Layout-offScreenBtn`)},S.createElement(`i`,{className:`bui-icon iconfont icon-collapse`})),S.createElement(`div`,{className:t(`Layout-brand`)},o&&~o.indexOf(`<svg`)?S.createElement(p,{className:t(`AppLogo-html`),html:o,filterHtml:s.filterHtml}):o?S.createElement(`img`,{className:t(`AppLogo`),src:o}):S.createElement(`span`,{className:`visible-folded `},n?.substring(0,1)),S.createElement(`span`,{className:`hidden-folded m-l-sm`},n))),S.createElement(`div`,{className:t(`Layout-headerBar`)},S.createElement(`a`,{onClick:a.toggleFolded,type:`button`,className:t(`AppFoldBtn`)},S.createElement(`i`,{className:`fa fa-${a.folded?`indent`:`dedent`} fa-fw`})),r?i(`header`,r):null))},o.prototype.renderAside=function(){var e=this,t=this.props,n=t.store,r=t.env,i=t.asideBefore,o=t.asideAfter,s=t.render,c=t.data;return S.createElement(S.default.Fragment,null,i?s(`aside-before`,i):null,S.createElement(x,{navigations:n.navigations,renderLink:function(t,r){var i=t.link;t.active;var o=t.toggleExpand,s=t.classnames,l=t.depth,u=t.subHeader,d=[];if(i.visible===!1)return null;!u&&i.children&&i.children.some(function(e){return e?.visible})&&d.push(S.createElement(`span`,{key:`expand-toggle`,className:s(`AsideNav-itemArrow`),onClick:function(e){return o(i,e)}}));var f=typeof i.badge==`string`?b(i.badge,c):i.badge;return f!=null&&d.push(S.createElement(`b`,{key:`badge`,className:s(`AsideNav-itemBadge`,i.badgeClassName||`bg-info`)},f)),!u&&i.icon?d.push(S.createElement(a,{key:`icon`,cx:s,icon:i.icon,className:`AsideNav-itemIcon`})):n.folded&&l===1&&!u&&d.push(S.createElement(`i`,{key:`icon`,className:s(`AsideNav-itemIcon`,i.children?`fa fa-folder`:`fa fa-info`)})),d.push(S.createElement(`span`,{className:s(`AsideNav-itemLabel`),key:`label`},typeof i.label==`string`?b(i.label,c):i.label)),i.path?/^https?\:/.test(i.path)?S.createElement(`a`,{target:`_blank`,key:`link`,href:i.path,rel:`noopener`},d):S.createElement(`a`,{key:`link`,onClick:e.handleNavClick,href:i.path||i.children&&i.children[0].path},d):S.createElement(`a`,{key:`link`,onClick:i.children?function(){return o(i)}:void 0},d)},isActive:function(e){return!!r.isCurrentUrl(e?.path,e)}}),o?s(`aside-before`,o):null)},o.prototype.renderFooter=function(){var e=this.props,t=e.render,n=e.footer;return n?t(`footer`,n):null},o.prototype.render=function(){var e=this,t=this.props,n=t.classnames,a=t.store,o=t.render,s=t.showBreadcrumb,c=s===void 0?!0:s,l=t.loadingConfig;return S.createElement(f,{header:this.renderHeader(),aside:this.renderAside(),footer:this.renderFooter(),folded:a.folded,offScreen:a.offScreen,contentClassName:n(`AppContent`)},a.activePage&&a.schema?S.createElement(S.default.Fragment,null,c&&a.bcn.length?S.createElement(`ul`,{className:n(`AppBcn`)},a.bcn.map(function(t,r){return S.createElement(`li`,{key:r,className:n(`AppBcn-item`)},t.path?S.createElement(`a`,{href:t.path,onClick:e.handleNavClick},t.label):r===a.bcn.length-1?t.label:S.createElement(`a`,null,t.label))})):null,S.createElement(`div`,{className:n(`AppBody`)},o(`page`,a.schema,{key:`${a.activePage?.id}-${a.schemaKey}`,data:a.pageData,resolveDefinitions:this.resolveDefinitions}))):a.pages&&!a.activePage?S.createElement(i,null,S.createElement(`div`,{className:`text-center`},`页面不存在`)):null,S.createElement(r,{loadingConfig:l,overlay:!0,show:a.loading||!a.pages,size:`lg`}))},o.propsList=[`brandName`,`logo`,`header`,`asideBefore`,`asideAfter`,`pages`,`footer`],o.defaultProps={},c([t,n(`design:type`,Function),n(`design:paramtypes`,[String]),n(`design:returntype`,void 0)],o.prototype,`resolveDefinitions`,null),c([t,n(`design:type`,Function),n(`design:paramtypes`,[Object]),n(`design:returntype`,void 0)],o.prototype,`handleNavClick`,null),o}(S.Component),w=function(e){l(t,e);function t(t,n){var r=e.call(this,t)||this;return n.registerComponent(r),r}return t.prototype.componentWillUnmount=function(){this.context.unRegisterComponent(this),e.prototype.componentWillUnmount.call(this)},t.prototype.setData=function(e,t){return this.props.store.updateData(e,void 0,t)},t.prototype.getData=function(){return this.props.store.data},t.contextType=h,t=c([y({type:`app`,storeType:d.name}),n(`design:paramtypes`,[Object,Object])],t),t}(C);export{C as App,w as default};