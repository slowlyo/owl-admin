import{t as U,bd as oe,be as re,G as P,H as _,a$ as x,aK as F,ax as I,aS as R,z as c,l as u,P as $,v as ne,ad as A,M,L as W,ae as se,bf as H,D as V,Q as ae,T as z,U as le,E as ie,bg as de,av as ce,aD as pe,a5 as he,a4 as j}from"./index-BnZOs00e.js";var ue=function(S){U(a,S);function a(t){var e=S.call(this,t)||this;e.isDead=!1,e.$$id=oe(),t.store.setEntered(!!t.show),e.handleSelfClose=e.handleSelfClose.bind(e),e.handleSelfScreen=e.handleSelfScreen.bind(e),e.handleAction=e.handleAction.bind(e),e.handleActionSensor=e.handleActionSensor.bind(e),e.handleDialogConfirm=e.handleDialogConfirm.bind(e),e.handleDialogClose=e.handleDialogClose.bind(e),e.handleDrawerConfirm=e.handleDrawerConfirm.bind(e),e.handleDrawerClose=e.handleDrawerClose.bind(e),e.handleEntered=e.handleEntered.bind(e),e.handleExited=e.handleExited.bind(e),e.handleFormInit=e.handleFormInit.bind(e),e.handleFormSaved=e.handleFormSaved.bind(e),e.handleFormChange=e.handleFormChange.bind(e),e.handleChildFinished=e.handleChildFinished.bind(e);var o=t.store;return e.reaction=re(function(){return"".concat(o.loading).concat(o.error)},function(){return e.forceUpdate()}),e}return a.prototype.componentWillUnmount=function(){this.reaction&&this.reaction(),this.isDead=!0},a.prototype.buildActions=function(){var t=this.props,e=t.actions,o=t.confirm,r=t.translate,n=t.testIdBuilder;if(typeof e<"u")return e;var s=[];return s.push({type:"button",testIdBuilder:n==null?void 0:n.getChild("cancel"),actionType:"cancel",label:r("cancel")}),o&&s.push({type:"button",testIdBuilder:n==null?void 0:n.getChild("confirm"),actionType:"confirm",label:r("confirm"),primary:!0}),s},a.prototype.handleSelfScreen=function(t){t.preventDefault(),t.stopPropagation();var e=this.props.store;e.setFullScreen(!e.isFullscreen)},a.prototype.handleSelfClose=function(t,e){return P(this,void 0,void 0,function(){var o,r,n,s,i;return _(this,function(d){switch(d.label){case 0:return o=this.props,r=o.onClose,n=o.store,s=o.dispatchEvent,[4,s("cancel",this.props.data)];case 1:return i=d.sent(),i!=null&&i.prevented?[2]:i!=null&&i.pendingPromise.length?[4,i.allDone()]:[3,3];case 2:d.sent(),d.label=3;case 3:return n.updateMessage(),n.setFullScreen(!1),r(e),[2]}})})},a.prototype.handleActionSensor=function(t){var e=this,o=this.props.store,r=o.busying;o.markBusying(!0),o.updateMessage(),t.then(function(){o.markBusying(r)}).catch(function(n){e.isDead||(o.updateMessage(n.message,!0),o.markBusying(r))})},a.prototype.handleAction=function(t,e,o){var r=this.props,n=r.store,s=r.onAction;e.type==="reset"?n.reset():e.actionType==="cancel"?this.handleSelfClose():s&&s(t,e,o)},a.prototype.handleDialogConfirm=function(t,e){for(var o=[],r=2;r<arguments.length;r++)o[r-2]=arguments[r];var n=this.props.store;e.mergeData&&t.length===1&&t[0]&&n.updateData(t[0]);var s=n.action.dialog;s&&s.onConfirm&&s.onConfirm.apply(s,x([t,e],F(o),!1))===!1||n.closeDialog(!0,t)},a.prototype.handleDialogClose=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=this.props.store,r=o.action,n=r.dialog;n.onClose&&n.onClose.apply(n,x([],F(t),!1))===!1||o.closeDialog(t[1])},a.prototype.handleDrawerConfirm=function(t,e){for(var o=[],r=2;r<arguments.length;r++)o[r-2]=arguments[r];var n=this.props.store;e.mergeData&&t.length===1&&t[0]&&n.updateData(t[0]);var s=n.action.drawer;s&&s.onConfirm&&s.onConfirm.apply(s,x([t,e],F(o),!1))===!1||n.closeDrawer(!0,t)},a.prototype.handleDrawerClose=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=this.props.store,r=o.action,n=r.drawer;n.onClose&&n.onClose.apply(n,x([],F(t),!1))===!1||o.closeDrawer.apply(o,x([],F(t),!1))},a.prototype.handleEntered=function(){var t=this.props,e=t.lazySchema,o=t.store;o.setEntered(!0),o.markBusying(!1),typeof e=="function"&&o.setSchema(e(this.props));var r=document.activeElement;if(r){var n=I.findDOMNode(this);n&&!n.contains(r)&&r.blur()}},a.prototype.handleExited=function(){var t=this.props,e=t.lazySchema,o=t.store,r=t.statusStore;r&&R(r)&&r.resetAll(),R(o)&&(o.reset(),o.clearMessage(),o.markBusying(!1),o.setEntered(!1),typeof e=="function"&&o.setSchema(""))},a.prototype.handleFormInit=function(t){var e=this.props.store;e.setFormData(t)},a.prototype.handleFormChange=function(t,e){var o=this.props.store;if(typeof e=="string"){o.changeValue(e,t);return}o.setFormData(t)},a.prototype.handleFormSaved=function(t,e){var o=this.props.store;o.setFormData(c(c({},t),e))},a.prototype.handleChildFinished=function(t,e){},a.prototype.openFeedback=function(t,e){var o=this;return new Promise(function(r){var n=o.props.store;n.setCurrentAction({type:"button",actionType:"dialog",dialog:t},o.props.resolveDefinitions),n.openDialog(e,void 0,function(s){r(s)},o.context)})},a.prototype.getPopOverContainer=function(){return I.findDOMNode(this).querySelector(".".concat(this.props.classPrefix,"Modal-content"))},a.prototype.renderBody=function(t,e){var o=this,r=this.props,n=r.render,s=r.store;if(Array.isArray(t))return t.map(function(l,h){return o.renderBody(l,h)});var i={key:e,disabled:t&&t.disabled||s.loading,onAction:this.handleAction,onFinished:this.handleChildFinished,popOverContainer:this.getPopOverContainer,onChange:this.handleFormChange,onInit:this.handleFormInit,onSaved:this.handleFormSaved,onActionSensor:this.handleActionSensor,btnDisabled:s.loading,syncLocation:!1};if(!t.type)return n("body".concat(e?"/".concat(e):""),t,i);var d=t;return d.type==="form"&&(d=c({mode:"horizontal",wrapWithPanel:!1,submitText:null},d)),n("body".concat(e?"/".concat(e):""),d,i)},a.prototype.renderFooter=function(){var t=this,e=this.buildActions(),o=this.props.hideActions;if(!e||!e.length||o)return null;var r=this.props,n=r.store,s=r.render,i=r.env,d=r.classnames,l=r.showErrorMsg,h=r.showLoading,m=r.show,y=r.dialogFooterClassName;return u.createElement("div",{className:d("Modal-footer",y)},h!==!1&&n.loading||l!==!1&&n.error?u.createElement("div",{className:d("Dialog-info"),key:"info"},h!==!1?u.createElement($,{size:"sm",key:"info",show:n.loading}):null,!i.forceSilenceInsideError&&n.error&&l!==!1?u.createElement("span",{className:d("Dialog-error")},n.msg):null):null,e.map(function(p,D){return s("action/".concat(D),p,{data:n.formData,onAction:t.handleAction,onActionSensor:void 0,btnDisabled:n.loading,key:D,disabled:p.disabled||n.loading||!m})}))},a.prototype.render=function(){var t=this.props.store,e=c(c({},this.props),t.schema),o=e.className,r=e.style,n=e.size,s=e.height,i=e.width,d=e.closeOnEsc,l=e.closeOnOutside,h=e.title,m=e.render,y=e.header,p=e.body,D=e.bodyClassName,O=e.headerClassName,b=e.show,w=e.lazyRender,k=e.lazySchema,B=e.wrapperComponent,v=e.showCloseButton,C=e.env,f=e.classnames,N=e.classPrefix,g=e.translate,q=e.loadingConfig,G=e.overlay,K=e.dialogType,Q=e.cancelText,J=e.confirmText,X=e.confirmBtnLevel,Y=e.cancelBtnLevel;e.popOverContainer,e.inDesign;var E=e.themeCss,L=e.allowFullscreen,Z=e.draggable,T=e.id,ee=ne(e,["className","style","size","height","width","closeOnEsc","closeOnOutside","title","render","header","body","bodyClassName","headerClassName","show","lazyRender","lazySchema","wrapperComponent","showCloseButton","env","classnames","classPrefix","translate","loadingConfig","overlay","dialogType","cancelText","confirmText","confirmBtnLevel","cancelBtnLevel","popOverContainer","inDesign","themeCss","allowFullscreen","draggable","id"]),te=B||H;return u.createElement(te,c({},ee,{classPrefix:N,className:f(o),style:r,draggable:t.isFullscreen?!1:Z,size:n,height:s,width:i,isFullscreen:t.isFullscreen,modalClassName:f(A(c(c({},this.props),{name:"dialogClassName",id:T,themeCss:E})),t.isFullscreen?"Modal-fullScreen":""),modalMaskClassName:A(c(c({},this.props),{name:"dialogMaskClassName",id:T,themeCss:E})),backdrop:"static",onHide:this.handleSelfClose,keyboard:d&&!t.loading,closeOnEsc:d,closeOnOutside:!t.dialogOpen&&l,show:b,onEntered:this.handleEntered,onExited:this.handleExited,container:C==null?void 0:C.getModalContainer,enforceFocus:!1,disabled:t.loading,overlay:G,dialogType:K,cancelText:Q,confirmText:J,confirmBtnLevel:X,cancelBtnLevel:Y}),h&&typeof h=="string"?u.createElement("div",{className:f("Modal-header",O,A(c(c({},this.props),{name:"dialogHeaderClassName",id:T,themeCss:E})))},v!==!1&&!t.loading?u.createElement("a",{"data-tooltip":g("Dialog.close"),"data-position":"left",onClick:this.handleSelfClose,className:f("Modal-close")},u.createElement(M,{icon:"close",className:"icon",iconContent:"Dialog-close"})):null,L?u.createElement("a",{"data-tooltip":t.isFullscreen?g("Dialog.reset"):g("Dialog.screen"),"data-position":"left",onClick:this.handleSelfScreen,className:f("Modal-close Modal-screen")},u.createElement(M,{icon:t.isFullscreen?"un-fullscreen":"full-screen",className:"icon"})):null,u.createElement("div",{className:f("Modal-title",A(c(c({},this.props),{name:"dialogTitleClassName",id:T,themeCss:E})))},W(g(h),t.formData))):h?u.createElement("div",{className:f("Modal-header",O,A(c(c({},this.props),{name:"dialogHeaderClassName",id:T,themeCss:E})))},v!==!1&&!t.loading?u.createElement("a",{"data-tooltip":g("Dialog.close"),onClick:this.handleSelfClose,className:f("Modal-close")},u.createElement(M,{icon:"close",className:"icon",iconContent:"Dialog-close"})):null,L?u.createElement("a",{"data-tooltip":t.isFullscreen?g("Dialog.reset"):g("Dialog.screen"),"data-position":"left",onClick:this.handleSelfScreen,className:f("Modal-close Modal-screen")},u.createElement(M,{icon:t.isFullscreen?"un-fullscreen":"full-screen",className:"icon"})):null,m("title",h,{data:t.formData,onAction:this.handleAction,onActionSensor:void 0,btnDisabled:t.loading})):v!==!1&&!t.loading?u.createElement("a",{"data-tooltip":g("Dialog.close"),onClick:this.handleSelfClose,className:f("Modal-close")},u.createElement(M,{icon:"close",className:"icon",iconContent:"Dialog-close"})):null,y?m("header",y,{data:t.formData,onAction:this.handleAction,onActionSensor:void 0,btnDisabled:t.loading}):null,!t.entered&&w||k&&!p?u.createElement("div",{className:f("Modal-body",D,A(c(c({},this.props),{name:"dialogBodyClassName",id:T,themeCss:E}))),role:"dialog-body"},u.createElement($,{overlay:!0,show:!0,size:"lg",loadingConfig:q})):p?u.createElement("div",{className:f("Modal-body",D,A(c(c({},this.props),{name:"dialogBodyClassName",id:T,themeCss:E}))),role:"dialog-body"},this.renderBody(p,"body"),u.createElement(se,c({},this.props,{config:{themeCss:E,classNames:[{key:"dialogClassName"},{key:"dialogMaskClassName"},{key:"dialogHeaderClassName"},{key:"dialogTitleClassName"},{key:"dialogBodyClassName"},{key:"dialogFooterClassName"}],id:T},env:C}))):null,p?this.renderFooter():null,p?m("drawer",c(c({},t.drawerSchema),{type:"drawer"}),{key:"drawer",data:t.drawerData,onConfirm:this.handleDrawerConfirm,onClose:this.handleDrawerClose,show:t.drawerOpen,onAction:this.handleAction}):null,p?m("dialog",c(c({},t.dialogSchema),{type:"dialog"}),{key:"dialog",data:t.dialogData,onConfirm:this.handleDialogConfirm,onClose:this.handleDialogClose,show:t.dialogOpen,onAction:this.handleAction}):null)},a.propsList=["title","size","closeOnEsc","closeOnOutside","children","bodyClassName","headerClassName","confirm","onClose","onConfirm","show","body","showCloseButton","showErrorMsg","actions","popOverContainer","overlay","draggable","allowFullscreen"],a.defaultProps={title:"Dialog.title",bodyClassName:"",confirm:!0,show:!1,lazyRender:!1,showCloseButton:!0,wrapperComponent:H,closeOnEsc:!1,closeOnOutside:!1,showErrorMsg:!0},V([ae,z("design:type",Function),z("design:paramtypes",[]),z("design:returntype",void 0)],a.prototype,"getPopOverContainer",null),a}(u.Component),me=function(S){U(a,S);function a(t,e){var o=S.call(this,t)||this,r=e;return r.registerComponent(o),o}return a.prototype.componentWillUnmount=function(){var t=this.context;t.unRegisterComponent(this),S.prototype.componentWillUnmount.call(this),clearTimeout(this.clearErrorTimer)},a.prototype.tryChildrenToHandle=function(t,e,o){var r=this,n=this.context,s=[],i=this.props,d=i.onConfirm,l=i.store;if(t.target&&s.push.apply(s,x([],F(t.target.split(",").map(function(p){return n.getComponentByName(p)}).filter(function(p){return p&&p.doAction})),!1)),(t==null?void 0:t.isolateScope)!==!0&&!s.length)for(var h=n.getComponents().filter(function(p){return!~["drawer","dialog"].indexOf(p.props.type)}),m=h.concat();m.length;){var y=m.pop();if(~["crud","form","wizard"].indexOf(y.props.type)){s.push(y);break}else{if(~["drawer","dialog"].indexOf(y.props.type))continue;~["page","service"].indexOf(y.props.type)&&m.unshift.apply(m,y.context.getComponents())}}return s.length?(l.markBusying(!0),l.updateMessage(),Promise.all(s.map(function(p){return p.doAction(c(c({},t),{from:r.$$id}),e,!0)})).then(function(p){(t.type==="submit"||t.actionType==="submit"||t.actionType==="confirm")&&t.close!==!1&&!s.some(function(D){return D.props.closeDialogOnSubmit===!1})?d&&d(p,o||t,e,s):t.close&&(t.close===!0?r.handleSelfClose():r.closeTarget(t.close)),l.markBusying(!1)}).catch(function(p){r.isDead||(l.updateMessage(p.message,!0),l.markBusying(!1),clearTimeout(r.clearErrorTimer),r.clearErrorTimer=setTimeout(function(){r.isDead||l.updateMessage("")},3e3))}),!0):!1},a.prototype.doAction=function(t,e,o){this.handleAction(void 0,t,e)},a.prototype.handleAction=function(t,e,o,r,n,s){return r===void 0&&(r=!1),P(this,void 0,void 0,function(){var i,d,l,h,m,y,p,D,O,b,w,k,B=this;return _(this,function(v){switch(v.label){case 0:return i=this.props,d=i.onAction,l=i.store,h=i.onConfirm,m=i.env,y=i.dispatchEvent,p=i.onClose,D=i.show,e.from===this.$$id||!D?[2,d?d(t,e,o,r,n||this.context):!1]:s!=null&&s.pendingPromise.length?[4,s.allDone()]:[3,2];case 1:v.sent(),v.label=2;case 2:return O=this.context,e.type!=="reset"?[3,3]:(l.setCurrentAction(e,this.props.resolveDefinitions),l.reset(),[3,19]);case 3:return e.actionType==="close"||e.actionType==="cancel"?[4,y("cancel",j(this.props.data,o))]:[3,7];case 4:return b=v.sent(),b!=null&&b.prevented?[2]:b!=null&&b.pendingPromise.length?[4,b.allDone()]:[3,6];case 5:v.sent(),v.label=6;case 6:return l.setCurrentAction(e,this.props.resolveDefinitions),l.updateMessage(),p(),e.close&&(e.close===!0?this.handleSelfClose():this.closeTarget(e.close)),[3,19];case 7:return e.actionType!=="confirm"?[3,11]:[4,y("confirm",j(this.props.data,o))];case 8:return w=v.sent(),w!=null&&w.prevented?[2]:w!=null&&w.pendingPromise.length?[4,w.allDone()]:[3,10];case 9:v.sent(),v.label=10;case 10:return l.setCurrentAction(e,this.props.resolveDefinitions),k=this.tryChildrenToHandle(c(c({},e),{actionType:"submit"}),o,e),k||(l.updateMessage(),e.close!==!1&&p(!0)),[3,19];case 11:return e.actionType==="next"||e.actionType==="prev"?(l.setCurrentAction(e,this.props.resolveDefinitions),e.type==="submit"?this.tryChildrenToHandle(c(c({},e),{actionType:"submit",close:!0}),o,e)||this.handleSelfClose(void 0,!0):h([o],e,o,[]),[3,19]):[3,12];case 12:return e.actionType!=="dialog"?[3,13]:(l.setCurrentAction(e,this.props.resolveDefinitions),[2,new Promise(function(C){l.openDialog(o,void 0,function(f,N){var g;(g=e.callback)===null||g===void 0||g.call(e,f,N),C({confirmed:f,value:N})},n||B.context)})]);case 13:return e.actionType!=="drawer"?[3,14]:(l.setCurrentAction(e,this.props.resolveDefinitions),[2,new Promise(function(C){l.openDrawer(o,void 0,function(f,N){var g;(g=e.callback)===null||g===void 0||g.call(e,f,N),C({confirmed:f,value:N})})})]);case 14:return e.actionType!=="reload"?[3,15]:(l.setCurrentAction(e,this.props.resolveDefinitions),e.target&&O.reload(e.target,o),(e.close||e.type==="submit")&&(this.handleSelfClose(void 0,e.type==="submit"),e.close&&typeof e.close=="string"&&this.closeTarget(e.close)),[3,19]);case 15:return!e.from&&this.tryChildrenToHandle(e,o)?[3,19]:[3,16];case 16:return e.actionType!=="ajax"?[3,17]:(l.setCurrentAction(e,this.props.resolveDefinitions),[2,l.saveRemote(e.api,o,{successMessage:e.messages&&e.messages.success,errorMessage:e.messages&&e.messages.failed}).then(function(){return P(B,void 0,void 0,function(){var C;return _(this,function(f){switch(f.label){case 0:return e.feedback&&he(e.feedback,l.data)?[4,this.openFeedback(e.feedback,l.data)]:[3,2];case 1:f.sent(),f.label=2;case 2:return C=e.redirect&&W(e.redirect,l.data),C&&m.jumpTo(C,e,l.data),e.reload&&this.reloadTarget(pe(e.reload,l.data),l.data),e.close&&(e.close===!0?this.handleSelfClose():this.closeTarget(e.close)),[2]}})})}).catch(function(C){if(r||e.countDown)throw C})]);case 17:return d?[4,d(t,c(c({},e),{close:!1}),o,r,n||this.context)]:[3,19];case 18:v.sent(),e.close&&(e.close===!0?this.handleSelfClose():this.closeTarget(e.close)),v.label=19;case 19:return[2]}})})},a.prototype.handleChildFinished=function(t,e){if(!(e&&e.from===this.$$id||e.close===!1)){var o=this.context,r=o.getComponents().filter(function(i){return!~["drawer","dialog","action","button","submit","reset"].indexOf(i.props.type)}),n=this.props.onConfirm,s=this.props.onClose;r.length===1&&(r[0].props.type==="form"||r[0].props.type==="wizard")&&(e.close===!0||r[0].props.closeDialogOnSubmit!==!1)?n&&n([t],e,{},r):e.close===!0&&s()}},a.prototype.handleDialogConfirm=function(t,e){for(var o,r,n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];S.prototype.handleDialogConfirm.apply(this,x([t,e],F(n),!1));var i=this.props.store,d=i.getDialogScoped()||this.context,l=i.action,h=(o=e.reload)!==null&&o!==void 0?o:l.reload;h?d.reload(h,i.data):d.component!==this&&(!((r=d.component)===null||r===void 0)&&r.reload)?d.component.reload():this.context.getComponents().filter(function(m){return m.props.type==="crud"}).forEach(function(m){return m.reload&&m.reload()})},a.prototype.handleDrawerConfirm=function(t,e){var o=this,r;S.prototype.handleDrawerConfirm.call(this,t,e);var n=this.props.store,s=n.getDialogScoped()||this.context,i=n.action,d=(r=e.reload)!==null&&r!==void 0?r:i.reload;setTimeout(function(){var l;d?s.reload(d,n.data):s.component!==o&&(!((l=s.component)===null||l===void 0)&&l.reload)?s.component.reload():o.context.getComponents().filter(function(h){return h.props.type==="crud"}).forEach(function(h){return h.reload&&h.reload()})},300)},a.prototype.reloadTarget=function(t,e){var o=this.context;o.reload(t,e)},a.prototype.closeTarget=function(t){var e=this.context;e.close(t)},a.prototype.setData=function(t,e){return this.props.store.updateData(t,void 0,e)},a.prototype.getData=function(){var t=this.props.store;return t.data},a.contextType=le,a=V([ie({type:"dialog",storeType:de.name,storeExtendsData:!1,isolateScope:!0,shouldSyncSuperStore:function(t,e,o){return!!((t.dialogOpen||e.show)&&(e.show!==o.show||ce(o.data,e.data)))}}),z("design:paramtypes",[Object,Object])],a),a}(ue);export{me as DialogRenderer,ue as default};
