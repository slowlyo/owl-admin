import{$o as e,$t as t,Ao as n,Ci as r,Do as i,Fo as a,Go as o,Hn as s,Ia as c,J as l,Ko as u,Mi as d,Mo as f,No as p,Nr as m,Oa as h,Pn as g,Po as _,Ri as v,Rr as y,Ui as b,Ya as x,dr as S,hr as C,ji as w,jo as T,ln as E,mr as D,ni as O,vr as k,xr as A}from"./index-zRImlZB6.js";var j=e(u()),M=e(i()),N=o(),P=function(e){p(i,e);function i(t){var n=e.call(this,t)||this;return n.container=j.createRef(),n.input=j.createRef(),n.cache={},n.targetRef=function(e){return n.target=e?(0,N.findDOMNode)(e):null},n.sourceLoaded=!1,n.state={inputValue:``,tempValue:``,isOpened:!1},n.open=n.open.bind(n),n.close=n.close.bind(n),n.handleChange=n.handleChange.bind(n),n.handleTempChange=n.handleTempChange.bind(n),n.handleConfirm=n.handleConfirm.bind(n),n.clearValue=n.clearValue.bind(n),n.handleFocus=n.handleFocus.bind(n),n.handleBlur=n.handleBlur.bind(n),n.handleKeyPress=n.handleKeyPress.bind(n),n.handleInputChange=(0,M.default)(n.handleInputChange.bind(n),150,{trailing:!0,leading:!1}),n.handleInputKeyDown=n.handleInputKeyDown.bind(n),n.loadRemote=(0,M.default)(n.loadRemote.bind(n),250,{trailing:!0,leading:!1}),n}return i.prototype.componentDidMount=function(){this.loadRemote(``)},i.prototype.componentWillUnmount=function(){this.sourceLoaded=!1},i.prototype.open=function(e){this.props.disabled||this.setState({isOpened:!0},e)},i.prototype.close=function(){var e=this;this.setState({isOpened:!1,inputValue:this.props.multiple?this.state.inputValue:``},function(){return e.loadRemote(e.state.inputValue)})},i.prototype.resolveOptions=function(){var e=this.props,t=e.options,n=e.searchable,r=e.autoComplete;return!O(r)&&n&&this.state.inputValue?this.filterOptions(t,this.state.inputValue):t},i.prototype.resolveOption=function(e,t){var n=this;return w(e,function(e){var r=n.props.valueField||`value`;return(b(e,r)?e[r]:``)===t})},i.prototype.handleFocus=function(e){var t=this.props,n=t.dispatchEvent,r=t.value,i=this.resolveOptions(),a=this.resolveOption(i,r);n(`focus`,m(this.props,{value:r,item:a,items:i}))},i.prototype.handleBlur=function(e){var t=this.props,n=t.dispatchEvent,r=t.value,i=this.resolveOptions(),a=this.resolveOption(i,r);n(`blur`,m(this.props,{value:r,item:a,items:i}))},i.prototype.handleKeyPress=function(e){e.key===` `&&e.shiftKey&&(this.handleOutClick(e),e.preventDefault())},i.prototype.validate=function(){var e=this.props,t=e.value,n=e.minLength,r=e.maxLength,i=e.delimiter,a=Array.isArray(t)?t:(t?String(t):``).split(i||`,`);if(n&&a.length<n)return`已选择数量低于设定的最小个数${n}，请选择更多的选项。`;if(r&&a.length>r)return`已选择数量超出设定的最大个数${r}，请取消选择超出的选项。`},i.prototype.removeItem=function(e,t){var n=this.props,r=n.selectedOptions,i=n.joinValues,a=n.extractValue,o=n.delimiter,s=n.valueField,c=n.onChange,l=n.disabled;if(t&&t.stopPropagation(),!l){var u=r.concat();u.splice(e,1);var d=u;i?d=u.map(function(e){return e[s||`value`]}).join(o||`,`):a&&(d=u.map(function(e){return e[s||`value`]})),c(d)}},i.prototype.handleChange=function(e){var t=this;this.props.multiple||this.close(),this.setState({inputValue:``},function(){return t.resultChangeEvent(e)})},i.prototype.handleTempChange=function(e){this.setState({tempValue:e})},i.prototype.handleConfirm=function(){var e=this;this.close(),this.setState({inputValue:``},function(){return e.resultChangeEvent(e.state.tempValue)})},i.prototype.handleInputChange=function(e){var t=this,n=this.props,r=n.autoComplete,i=n.data;this.setState({inputValue:e},O(r,i)?function(){return t.loadRemote(t.state.inputValue)}:void 0)},i.prototype.handleInputKeyDown=function(e){var t=this.state.inputValue,n=this.props,r=n.multiple,i=n.selectedOptions;e.key===`Backspace`&&!t&&i.length&&r&&this.removeItem(i.length-1)},i.prototype.resetValue=function(){var e=this.props,t=e.onChange,n=e.resetValue,r=e.formStore,i=e.store,a=e.name;t(c(r?.pristine??i?.pristine,a)??n)},i.prototype.clearValue=function(){var e=this.props,t=e.onChange,n=e.resetValue;t(n===void 0?``:n)},i.prototype.filterOptions=function(e,t){var r=this,i=this.props,a=i.labelField,o=i.valueField;return e.map(function(e){if(e=n({},e),e.visible=!!x([e],t,{keys:[a||`label`,o||`value`],threshold:x.rankings.CONTAINS}).length,!e.visible&&e.children){e.children=r.filterOptions(e.children,t);var i=e.children.filter(function(e){return e.visible}).length;e.visible=!!i}return e.visible&&(e.collapsed=!1),e})},i.prototype.loadRemote=function(e){return T(this,void 0,void 0,function(){var t,r,i,a,o,s,c,l,u,d,l,u;return _(this,function(f){switch(f.label){case 0:if(t=this.props,r=t.autoComplete,i=t.env,a=t.data,o=t.setOptions,s=t.setLoading,c=t.source,!O(r,a)||!e&&O(c)&&!this.sourceLoaded)return this.sourceLoaded=!0,[2];if(!i||!i.fetcher)throw Error(`fetcher is required`);if(this.cache[e]||~e.indexOf(`'`))return l=this.cache[e]||[],u=this.mergeOptions(l),o(u),[2,Promise.resolve({options:u})];s(!0),f.label=1;case 1:return f.trys.push([1,,3,4]),[4,i.fetcher(r,n(n({},a),{term:e,value:e}))];case 2:return d=f.sent(),l=d.data&&d.data.options||d.data||[],this.cache[e]=l,u=this.mergeOptions(l),o(u),[2,{options:u}];case 3:return s(!1),[7];case 4:return[2]}})})},i.prototype.mergeOptions=function(e){var t=this.props.selectedOptions,r=y(e).concat();return Array.isArray(t)&&t.length&&t.forEach(function(e){w(r,function(t){return t.value==e.value})||r.push(n({},e))}),r},i.prototype.reload=function(e,t){var n=this.props.reloadOptions;n&&n(e,t)},i.prototype.handleOutClick=function(e){e.defaultPrevented||this.setState({isOpened:!0})},i.prototype.handleResultChange=function(e){var t=this.props,n=t.joinValues,r=t.extractValue,i=t.delimiter,a=t.valueField,o=t.multiple,s=Array.isArray(e)?e.concat():[];if(!o&&!s.length){this.resultChangeEvent(``);return}(n||r)&&(s=e.map(function(e){return e[a||`value`]})),n&&(s=s.join(i||`,`)),this.resultChangeEvent(s)},i.prototype.doAction=function(e,t,n){e.actionType===`clear`?this.clearValue():e.actionType===`reset`?this.resetValue():e.actionType===`add`?this.addItemFromAction(e.args?.item,e.args?.parentValue):e.actionType===`edit`?this.editItemFromAction(e.args?.item,e.args?.originValue):e.actionType===`delete`?this.deleteItemFromAction(e.args?.value):e.actionType===`reload`&&this.reload()},i.prototype.addItemFromAction=function(e,t){var n=this.props,r=n.onAdd,i=n.options,a=n.valueField,o=d(i,function(e){var n=a||`value`;return(b(e,n)?e[n]:``)===t})||[];r&&r(o.concat(0),e,!0)},i.prototype.editItemFromAction=function(e,t){var r=this.props,i=r.onEdit,a=r.options,o=this.resolveOption(a,t);i&&o&&i(n(n({},e),{originValue:t}),o,!0)},i.prototype.deleteItemFromAction=function(e){var t=this.props,n=t.onDelete,r=t.options,i=this.resolveOption(r,e);n&&i&&n(i)},i.prototype.resultChangeEvent=function(e){return T(this,void 0,void 0,function(){var t,n,r,i,a,o;return _(this,function(s){switch(s.label){case 0:return t=this.props,n=t.onChange,r=t.dispatchEvent,i=this.resolveOptions(),a=this.resolveOption(i,e),[4,r(`change`,m(this.props,{value:e,item:a,items:this.resolveOptions()}))];case 1:return o=s.sent(),o?.prevented||n&&n(e),[2]}})})},i.prototype.handleNodeClick=function(e){return T(this,void 0,void 0,function(){var t,n,r,i;return _(this,function(a){switch(a.label){case 0:return t=this.props,n=t.dispatchEvent,r=t.data,[4,n(`itemClick`,h(r,{item:e}))];case 1:return i=a.sent(),i?.prevented,[2]}})})},i.prototype.renderOptionItem=function(e,t){var r=this.props,i=r.menuTpl,a=r.render,o=r.data;return a(`option/${t.index}`,i,{data:h(h(o,n({},t)),e)})},i.prototype.renderItem=function(e){var t=this.props,n=t.labelField,r=t.options;if(t.hideNodePathLabel)return e[n||`label`];var i=v(r,e,!0);return`${i?i.map(function(e){return`${e[n||`label`]}`}).join(` / `):e[n||`label`]}`},i.prototype.domRef=function(e){this.treeRef=e},i.prototype.renderOuter=function(){var e=this.props,t=e.value,r=e.enableNodePath,i=e.pathSeparator,a=i===void 0?`/`:i,o=e.disabled,s=e.joinValues,c=e.extractValue,l=e.delimiter;e.placeholder;var u=e.options,d=e.multiple,f=e.valueField,p=e.initiallyOpen,m=e.unfoldedLevel,h=e.withChildren,g=e.rootLabel,_=e.cascade,v=e.rootValue,y=e.showIcon,b=e.showRadio;e.popOverContainer;var x=e.onlyChildren,S=e.onlyLeaf,C=e.classPrefix,w=e.optionsPlaceholder,T=e.searchable,D=e.autoComplete,k=e.maxLength,M=e.minLength,N=e.labelField,P=e.deferField,F=e.nodePath,I=e.onAdd,ee=e.creatable,te=e.createTip,L=e.addControls,R=e.onEdit,z=e.editable,B=e.editTip,V=e.editControls,H=e.removable,U=e.removeTip,W=e.onDelete,G=e.rootCreatable,K=e.rootCreateTip,q=e.translate,J=e.deferLoad,Y=e.expandTreeOptions,X=e.selfDisabledAffectChildren,Z=e.showOutline,ne=e.autoCheckChildren,re=e.autoCancelParent,ie=e.hideRoot,ae=e.virtualThreshold;e.itemHeight;var oe=e.menuTpl,se=e.enableDefaultIcon,Q=e.mobileUI,ce=e.testIdBuilder,le=e.nodeBehavior,$=e.itemActions,ue=e.classnames,de=e.id,fe=e.themeCss,pe=!O(D)&&T&&this.state.inputValue?this.filterOptions(u,this.state.inputValue):u;return j.createElement(E,{classPrefix:C,onRef:this.domRef,onlyChildren:x,onHandleNodeClick:this.handleNodeClick,onlyLeaf:S,labelField:N,valueField:f,deferField:P,disabled:o,onChange:Q?this.handleTempChange:this.handleChange,joinValues:s,extractValue:c,delimiter:l,placeholder:q(w),options:pe,highlightTxt:this.state.inputValue,multiple:d,initiallyOpen:p,unfoldedLevel:m,withChildren:h,autoCheckChildren:ne,autoCancelParent:re,rootLabel:q(g),rootValue:v,showIcon:y,showRadio:b,showOutline:Z,cascade:_,foldedField:`collapsed`,hideRoot:ie,value:t||``,nodePath:F,enableNodePath:r,pathSeparator:a,maxLength:k,minLength:M,onAdd:I,creatable:ee,createTip:te,rootCreatable:G,rootCreateTip:K,onEdit:R,editable:z,editTip:B,removable:H,removeTip:U,onDelete:W,bultinCUD:!L&&!V,onDeferLoad:J,onExpandTree:Y,selfDisabledAffectChildren:X,virtualThreshold:ae,itemRender:oe?this.renderOptionItem:void 0,enableDefaultIcon:se,mobileUI:Q,nodeBehavior:le,itemActionsRender:$?this.renderItemActions:void 0,actionClassName:ue(A(n(n({},this.props),{name:`actionControlClassName`,id:de,themeCss:fe}))),testIdBuilder:ce})},i.prototype.renderItemActions=function(e,t){var r=this.props,i=r.itemActions,a=r.data,o=r.render;return o(`action/${t.index}`,i||``,{data:h(h(a,n({},t)),e)})},i.prototype.render=function(){var e=this,r=this.props,i=r.className;r.style;var a=r.disabled,o=r.inline,c=r.loading,l=r.multiple;r.value;var u=r.clearable,d=r.classPrefix,f=r.classnames,p=r.searchable,m=r.autoComplete,h=r.selectedOptions,_=r.placeholder,v=r.popOverContainer,y=r.mobileUI,b=r.maxTagCount,x=r.overflowTagPopover,S=r.translate,w=r.env,T=r.loadingConfig,E=r.testIdBuilder,A=r.wrapperCustomStyle,M=r.id,N=r.themeCss,P=this.state.isOpened,F=l?h:h.length?this.renderItem(h[0]):``;return j.createElement(j.default.Fragment,null,j.createElement(`div`,n({ref:this.container,className:f(`TreeSelectControl`,i)},E?.getTestId()),j.createElement(t,{popOverContainer:v||w.getModalContainer,maxTagCount:b,overflowTagPopover:x,disabled:a,ref:this.targetRef,placeholder:S(_??`placeholder.empty`),inputPlaceholder:``,className:f(`TreeSelect`,{"TreeSelect--inline":o,"TreeSelect--single":!l,"TreeSelect--multi":l,"TreeSelect--searchable":p||O(m),"is-opened":this.state.isOpened,"is-disabled":a}),result:F,onResultClick:this.handleOutClick,value:this.state.inputValue,onChange:this.handleInputChange,onResultChange:this.handleResultChange,itemRender:this.renderItem,onKeyPress:this.handleKeyPress,onFocus:this.handleFocus,onBlur:this.handleBlur,onKeyDown:this.handleInputKeyDown,clearable:u,allowInput:!y&&(p||O(m))&&(l||!F),hasDropDownArrow:!0,readOnly:y,mobileUI:y,testIdBuilder:E?.getChild(`result-box`)},c?j.createElement(s,{loadingConfig:T,size:`sm`}):void 0),!y&&P?j.createElement(C,{container:v||(function(){return e.container.current}),target:function(){return e.target},show:!0},j.createElement(D,{classPrefix:d,className:`${d}TreeSelect-popover`,style:{minWidth:this.target?this.target.offsetWidth:void 0},onHide:this.close,overlay:!0},this.renderOuter())):null,y?j.createElement(g,{container:w.getModalContainer,className:f(`${d}TreeSelect-popup`),isShow:P,onHide:this.close,showConfirm:!0,onConfirm:this.handleConfirm},this.renderOuter()):null),j.createElement(k,n({},this.props,{config:{wrapperCustomStyle:A,id:M,themeCss:N,classNames:[{key:`actionControlClassName`}]},env:w})))},i.defaultProps={hideRoot:!0,placeholder:`Select.placeholder`,optionsPlaceholder:`placeholder.noData`,multiple:!1,clearable:!0,rootLabel:`Tree.root`,rootValue:``,showIcon:!0,joinValues:!0,extractValue:!1,delimiter:`,`,resetValue:``,hideNodePathLabel:!1,enableNodePath:!1,pathSeparator:`/`,selfDisabledAffectChildren:!0},f([r,a(`design:type`,Function),a(`design:paramtypes`,[Object]),a(`design:returntype`,void 0)],i.prototype,`handleOutClick`,null),f([r,a(`design:type`,Function),a(`design:paramtypes`,[Array]),a(`design:returntype`,void 0)],i.prototype,`handleResultChange`,null),f([r,a(`design:type`,Function),a(`design:paramtypes`,[Object,Object]),a(`design:returntype`,void 0)],i.prototype,`addItemFromAction`,null),f([r,a(`design:type`,Function),a(`design:paramtypes`,[Object,Object]),a(`design:returntype`,void 0)],i.prototype,`editItemFromAction`,null),f([r,a(`design:type`,Function),a(`design:paramtypes`,[Object]),a(`design:returntype`,void 0)],i.prototype,`deleteItemFromAction`,null),f([r,a(`design:type`,Function),a(`design:paramtypes`,[Object]),a(`design:returntype`,Promise)],i.prototype,`resultChangeEvent`,null),f([r,a(`design:type`,Function),a(`design:paramtypes`,[Object]),a(`design:returntype`,Promise)],i.prototype,`handleNodeClick`,null),f([r,a(`design:type`,Function),a(`design:paramtypes`,[Object,Object]),a(`design:returntype`,void 0)],i.prototype,`renderOptionItem`,null),f([r,a(`design:type`,Function),a(`design:paramtypes`,[Object]),a(`design:returntype`,void 0)],i.prototype,`renderItem`,null),f([r,a(`design:type`,Function),a(`design:paramtypes`,[Object]),a(`design:returntype`,void 0)],i.prototype,`domRef`,null),f([r,a(`design:type`,Function),a(`design:paramtypes`,[Object,Object]),a(`design:returntype`,void 0)],i.prototype,`renderItemActions`,null),f([l(),a(`design:type`,Function),a(`design:paramtypes`,[]),a(`design:returntype`,void 0)],i.prototype,`render`,null),i}(j.Component),F=function(e){p(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t=f([S({type:`tree-select`})],t),t}(P);export{F as TreeSelectControlRenderer,P as default};