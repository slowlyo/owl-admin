import{$o as e,Ao as t,Ci as n,Do as r,Er as i,Fo as a,Ia as o,Io as s,Ka as c,Kn as l,Ko as u,La as d,Li as f,Lo as p,Ma as m,Mi as h,Mo as g,Na as _,No as v,Nr as y,Oa as b,Oi as x,Po as S,Ro as C,Sa as w,Si as T,Vn as E,_a as D,_i as O,ba as k,ca as A,di as j,ea as M,fr as N,hi as P,jo as F,la as I,ma as L,mi as R,ni as z,qa as B,si as V,ya as H}from"./index-C4Pf1uQ-.js";var U=e(u()),W=e(j()),G=e(P()),K=e(r());c();var q=`__isPlaceholder`,J=function(e){v(r,e);function r(n){var r=e.call(this,n)||this;r.entityId=1,r.subForms={},r.subFormItems={},r.rowPrinstine=[],r.editting={},r.toDispose=[],r.lazyEmitValue=(0,K.default)(r.emitValue.bind(r),50,{trailing:!0,leading:!1}),r.emittedValue=null;var i=n.addHook,a=Array.isArray(n.value)?n.value.concat():[];return r.state=t({columns:r.buildColumns(n),editIndex:``,items:a},r.transformState(a)),r.entries=new R,r.buildItemProps=r.buildItemProps.bind(r),r.confirmEdit=r.confirmEdit.bind(r),r.cancelEdit=r.cancelEdit.bind(r),r.handleSaveTableOrder=r.handleSaveTableOrder.bind(r),r.handleTableSave=r.handleTableSave.bind(r),r.handleRadioChange=r.handleRadioChange.bind(r),r.getEntryId=r.getEntryId.bind(r),r.subFormRef=r.subFormRef.bind(r),r.subFormItemRef=r.subFormItemRef.bind(r),r.handlePageChange=r.handlePageChange.bind(r),r.handleTableQuery=r.handleTableQuery.bind(r),r.emitValue=r.emitValue.bind(r),r.tableRef=r.tableRef.bind(r),r.flush=r.flush.bind(r),r.filterItemIndex=r.filterItemIndex.bind(r),i&&r.toDispose.push(i(r.flush,`flush`)),r}return r.prototype.componentDidUpdate=function(e,n){var r=this.props,i=null;if(e.disabled!==r.disabled||e.static!==r.static||r.$schema.disabled!==e.$schema.disabled||r.$schema.static!==e.$schema.static){var a=this.state.items.filter(function(e){return!e.hasOwnProperty(q)});i=t(t(t(t({},i),{items:a}),this.transformState(a)),{editIndex:``,columns:this.buildColumns(r)})}if(r.columns!==e.columns&&(i=t(t({},i),{columns:this.buildColumns(r)})),r.value!==e.value&&r.value!==this.emittedValue){var a=Array.isArray(r.value)?r.value.concat():[];i=t(t(t(t({},i),{items:a}),this.transformState(a)),{editIndex:``})}i&&this.setState(i)},r.prototype.componentWillUnmount=function(){this.entries.dispose(),this.lazyEmitValue.cancel(),this.toDispose.forEach(function(e){return e()}),this.toDispose=[]},r.prototype.transformState=function(e,n,r){var i=this.props,a=i.perPage,o=i.matchFunc,s=t(t({},this.state),n),c=s.query,l=s.page,u=c??{},d=u.orderBy,f=u.orderDir,m=p(u,[`orderBy`,`orderDir`]);Object.keys(m).length&&(e=T(e,{query:m,columns:this.state.columns,matchFunc:typeof o==`string`&&o?V(o,`items`,`itemsRaw`,`options`):typeof o==`function`?o:void 0})),d&&(e=A(e.concat(),d,typeof f==`string`&&/desc/i.test(f)?-1:1));var h=e.length;if(l=Math.min(l??1,typeof a==`number`?Math.max(1,Math.ceil(h/a)):1),r){var g=e.indexOf(r);~g&&(l=Math.ceil((g+1)/a))}return typeof a==`number`&&a&&e.length>a&&(e=e.slice((l-1)*a,l*a)),{filteredItems:e,page:l,total:h}},r.prototype.flush=function(){return F(this,void 0,void 0,function(){var e,t,n=this;return S(this,function(r){switch(r.label){case 0:return e=[],Object.keys(this.subForms).forEach(function(t){return n.subForms[t]&&e.push(n.subForms[t])}),[4,Promise.all(e.map(function(e){return e.flush()}))];case 1:return r.sent(),t=[],Object.keys(this.subFormItems).forEach(function(e){return n.subFormItems[e]&&t.push(n.subFormItems[e])}),[4,Promise.all(t.map(function(e){var t;return(t=e.props).onFlushChange?.call(t)}))];case 2:return r.sent(),[4,this.lazyEmitValue.flush()];case 3:return r.sent(),[2]}})})},r.prototype.resolveVariableProps=function(e,t){var n={minLength:0,maxLength:1/0},r=e[t];if(!r)return n[t];if(typeof r==`string`)if(k(r)){var i=d(r,e.data,`| raw`);r=typeof i==`number`&&i>=0?i:n[t]}else{var a=parseInt(r,10);r=isNaN(a)?n[t]:a}return r},r.prototype.subFormRef=function(e,t,n){this.subForms[`${t}-${n}`]=e},r.prototype.subFormItemRef=function(e,t,n){this.subFormItems[`${t}-${n}`]=e},r.prototype.validate=function(){return F(this,void 0,void 0,function(){var e,t,n,r,i,a,s,c,l,u,d,f,p,m=this;return S(this,function(h){switch(h.label){case 0:return e=this.props,t=e.value,n=e.translate,r=e.columns,i=this.resolveVariableProps(this.props,`minLength`),a=this.resolveVariableProps(this.props,`maxLength`),this.state.editIndex?[2,n(`Table.editing`)]:i&&(!Array.isArray(t)||t.length<i)?[2,n(`Combo.minLength`,{minLength:i})]:[3,1];case 1:return a&&Array.isArray(t)&&t.length>a?[2,n(`Combo.maxLength`,{maxLength:a})]:[3,2];case 2:return s=[],Object.keys(this.subForms).forEach(function(e){return m.subForms[e]&&s.push(m.subForms[e])}),s.length?[4,Promise.all(s.map(function(e){return e.validate()}))]:[3,4];case 3:if(c=h.sent(),l=~c.indexOf(!1)?n(`Form.validateFailed`):``,u=``,!l&&Array.isArray(r)&&Array.isArray(t)&&r.some(function(e){if(e.unique&&e.name){var n=[];return t.some(function(t){var r=o(t,e.name);return~n.indexOf(r)?(u=`${e.label||e.name}`,!0):(n.push(r),!1)})}return!1})&&(l=n(`InputTable.uniqueError`,{label:u})),l)return[2,l];h.label=4;case 4:return d=[],Object.keys(this.subFormItems).forEach(function(e){return m.subFormItems[e]&&d.push(m.subFormItems[e])}),[4,Promise.all(d.map(function(e){return e.props.onValidate()}))];case 5:return f=h.sent(),p=~f.indexOf(!1)?n(`Form.validateFailed`):``,[2,p]}})})},r.prototype.emitValue=function(e){return F(this,void 0,void 0,function(){var t,n,r;return S(this,function(i){switch(i.label){case 0:return t=e??this.state.items.filter(function(e){return!e.hasOwnProperty(q)}),n=this.props.onChange,[4,this.dispatchEvent(`change`)];case 1:return r=i.sent(),r||(this.emittedValue=t,n?.(t)),[2,r]}})})},r.prototype.doAction=function(e,n){var r=[...arguments].slice(2);return F(this,void 0,void 0,function(){var i,a,o,c,l,u,d,f,p,m,g,_,v,y,b,x,w,T=this;return S(this,function(S){switch(S.label){case 0:return i=this.props,a=i.onAction,o=i.valueField,c=i.env,l=i.needConfirm,u=i.addable,d=i.addApi,f=i.translate,p=i.onChange,m=e.actionType,m===`add`?u===!1?[2]:(g=this.state.items.concat(),d||e.payload?(_=null,z(d,n)?[4,c.fetcher(d,n)]:[3,2]):[3,4]):[3,6];case 1:return v=S.sent(),v&&!v.ok?(!d?.silent&&c.notify(`error`,d?.messages?.failed??(v.msg||f(`fetchFailed`))),[2]):(v&&v.ok&&(_=v.data),[3,3]);case 2:_=O(e.payload,n),S.label=3;case 3:return _=Array.isArray(_)?_:[_],_.forEach(function(e){(!o||!(0,G.default)(g,function(t){return t[o]==e[o]}))&&(g.push(e),l!==!1&&Reflect.set(e,q,!0))}),this.setState(t({items:g},this.transformState(g)),function(){_.length===1&&l!==!1?T.startEdit(`${g.length-1}`,!0):p?.(g)}),[2];case 4:return[2,this.addItem(`${g.length-1}`,!1)];case 5:return[3,7];case 6:if(m===`remove`||m===`delete`){if(o){if(!e.payload)return[2,c.alert(f(`Table.playload`))]}else return[2,c.alert(f(`Table.valueField`))];return y=this.state.items.concat(),b=O(e.payload,n),b=Array.isArray(b)?b:[b],b.forEach(function(e){var t=h(y,function(t){return t[o]==e[o]});t?.length&&(y=I(y,t,1))}),this.setState(t({items:y},this.transformState(y)),function(){p?.(y)}),[2]}else m===`initDrag`?(x=this.table).doAction.apply(x,C([e,n],s(r),!1)):m===`cancelDrag`&&(w=this.table).doAction.apply(w,C([e,n],s(r),!1));S.label=7;case 7:return[2,a&&a.apply(void 0,C([e,n],s(r),!1))]}})})},r.prototype.copyItem=function(e){return F(this,void 0,void 0,function(){var n,r,i,a,o,s,c,l,u,d,p,m,h,g,_,v,y=this;return S(this,function(x){return n=this.props,r=n.needConfirm,i=n.data,a=n.copyData,o=a===void 0?{"&":`$$`}:a,s=this.state.items.concat(),c=e.split(`.`).map(function(e){return parseInt(e,10)}),l=c.concat(),l[l.length-1]+=1,u=s,d=f(s,c),p=O(o,b(i,d)),s=r===!1?I(s,l,0,p):I(s,l,0,t(t({},p),(v={},v[q]=!0,v))),this.reUseRowId(s,u,l),m=s[l[0]],h=t(t({},this.transformState(s)),{items:s}),h.filteredItems.includes(m)||(g=s[c[0]],_=h.filteredItems.findIndex(function(e){return e===g}),h.filteredItems.splice(_+1,0,m)),this.setState(h,function(){return F(y,void 0,void 0,function(){var e;return S(this,function(t){switch(t.label){case 0:return[4,this.dispatchEvent(`add`,{index:l[l.length-1],indexPath:l.join(`.`),item:p})];case 1:return e=t.sent(),e||(r===!1?this.emitValue():this.startEdit(l.join(`.`),!0)),[2]}})})}),[2]})})},r.prototype.addItem=function(e,n,r){return n===void 0&&(n=!0),F(this,void 0,void 0,function(){var i,a,o,s,c,l,u,d,f,p,m,h,g,v,y,b=this;return S(this,function(x){return e||=`${this.state.items.length-1}`,i=this.props,a=i.needConfirm,o=i.scaffold,s=i.columns,c=i.data,i.perPage,l=this.state.items.concat(),u=(y={},y[q]=!0,y),Array.isArray(s)&&s.forEach(function(e){if(e.value!==void 0&&typeof e.name==`string`)if(`type`in e&&(e.type===`input-date`||e.type===`input-datetime`||e.type===`input-time`||e.type===`input-month`||e.type===`input-quarter`||e.type===`input-year`)){if(!(typeof e.value==`string`&&e.value.trim()===``)){var t=w(e.value,c,e.format||`X`);_(u,e.name,(e.utc?B.utc(t):t).format(e.format||`X`))}}else L(e.value)||_(u,e.name,e.value)}),u=t(t({},u),o),a===!1&&Reflect.deleteProperty(u,q),d=e.split(`.`).map(function(e){return parseInt(e,10)}),f=d.concat(),f[f.length-1]+=1,p=l,l=I(l,f,0,u),this.reUseRowId(l,p,f),m=l[f[0]],h=t(t({items:l},this.transformState(l,void 0,m)),a===!1?{}:{editIndex:f.join(`.`),isCreateMode:!0,columns:this.buildColumns(this.props,!0,f.join(`.`))}),h.filteredItems.includes(m)||(g=l[d[0]],v=h.filteredItems.findIndex(function(e){return e===g}),h.filteredItems.splice(v+1,0,m)),this.setState(h,function(){return F(b,void 0,void 0,function(){return S(this,function(e){switch(e.label){case 0:return n?[4,this.dispatchEvent(`add`,{index:f[f.length-1],indexPath:f.join(`.`),item:u})]:[3,2];case 1:e.sent(),e.label=2;case 2:return a===!1&&this.emitValue(),r?.(),[2]}})})}),[2,!1]})})},r.prototype.subAddItem=function(e,t,n){return t===void 0&&(t=!0),F(this,void 0,void 0,function(){return S(this,function(r){return[2,this.addItem(e+`.-1`,t,function(){n?.setExpanded(!0)})]})})},r.prototype.editItem=function(e){return F(this,void 0,void 0,function(){var t,n,r,i;return S(this,function(a){switch(a.label){case 0:return t=this.state.items,n=e.split(`.`).map(function(e){return parseInt(e,10)}),r=f(t,n),[4,this.dispatchEvent(`edit`,{index:n[n.length-1],indexPath:n.join(`.`),item:r})];case 1:return i=a.sent(),!i&&this.startEdit(e,!0),[2]}})})},r.prototype.dispatchEvent=function(e,n){return n===void 0&&(n={}),F(this,void 0,void 0,function(){var r,i,a,o,c;return S(this,function(l){switch(l.label){case 0:return r=this.props.dispatchEvent,i=this.state,a=i.items,o=i.rowIndex,[4,r(e,y(this.props,t({value:C([],s(a),!1),rowIndex:o},n)))];case 1:return c=l.sent(),[2,!!c?.prevented]}})})},r.prototype.startEdit=function(e,t){t===void 0&&(t=!1),this.setState({editIndex:e,isCreateMode:t,columns:this.buildColumns(this.props,t,e)})},r.prototype.confirmEdit=function(){return F(this,void 0,void 0,function(){var e,n,r,i,a,o,s,c,l,u,d,p,m,h,g,_,v,y,x,C,w=this;return S(this,function(T){switch(T.label){case 0:return e=this.props,n=e.addApi,r=e.updateApi,i=e.data,a=e.env,o=e.translate,s=[],Object.keys(this.subForms).forEach(function(e){return w.subForms[e]&&s.push(w.subForms[e])}),s.forEach(function(e){return e.flush()}),c=[],Object.keys(this.subFormItems).forEach(function(e){return w.subFormItems[e]&&c.push(w.subFormItems[e])}),c.forEach(function(e){var t;return(t=e.props).onFlushChange?.call(t)}),l=s,[4,Promise.all(l.map(function(e){return e.validate()}).concat(c.map(function(e){return e.props.onValidate()})))];case 1:return u=T.sent(),~u.indexOf(!1)?[2]:(d=this.state.items.concat(),p=this.state.editIndex.split(`.`).map(function(e){return parseInt(e,10)}),m=t({},f(d,p)),h=m.hasOwnProperty(q),g=h?`addConfirm`:`editConfirm`,[4,this.dispatchEvent(g,{index:p[p.length-1],indexPath:p.join(`.`),item:m})]);case 2:return _=T.sent(),_?[2]:(v=null,y=void 0,h&&z(n,b(i,m))?[4,a.fetcher(n,b(i,m))]:[3,4]);case 3:return v=T.sent(),y=n?.messages?.failed,[3,6];case 4:return!h&&z(r,b(i,m))?[4,a.fetcher(r,b(i,m))]:[3,6];case 5:v=T.sent(),y=r?.messages?.failed,T.label=6;case 6:return v&&!v.ok?(!(h?n:r)?.silent&&a.notify(`error`,y??(v.msg||o(`saveFailed`))),x=h?`addFail`:`editFail`,this.dispatchEvent(x,{index:p[p.length-1],indexPath:p.join(`.`),item:m,error:v}),[2]):(v&&v.ok&&(m=t(t({},(h?n:r).replaceData?{}:m),v.data)),Reflect.deleteProperty(m,q),C=d,d=I(d,p,1,m),this.reUseRowId(d,C,p),this.setState(t(t({editIndex:``,items:d},this.transformState(d)),{columns:this.buildColumns(this.props)}),function(){return F(w,void 0,void 0,function(){var e,t;return S(this,function(n){switch(n.label){case 0:return[4,this.emitValue()];case 1:return e=n.sent(),e?[2]:(t=h?`addSuccess`:`editSuccess`,this.dispatchEvent(t,{index:p[p.length-1],indexPath:p.join(`.`),item:m}),[2])}})})}),[2])}})})},r.prototype.cancelEdit=function(){var e=this.state.items.concat(),n=this.state.lastModifiedRow,r=this.state.editIndex.split(`.`).map(function(e){return parseInt(e,10)}),i=t({},f(e,r)),a=i.hasOwnProperty(q),o=e;a?e=I(e,r,1):n&&~n?.index&&m(n?.data)&&(e=I(e,r,1,t(t({},i),n.data))),this.reUseRowId(e,o,r),this.setState(t(t({editIndex:``,items:e},this.transformState(e)),{columns:this.buildColumns(this.props),lastModifiedRow:void 0}),this.emitValue)},r.prototype.removeItem=function(e){return F(this,void 0,void 0,function(){var n,r,i,a,o,s,c,l,u,d,p,m,h,g,_,v=this;return S(this,function(y){switch(y.label){case 0:return n=this.props,r=n.value,n.onChange,i=n.deleteApi,a=n.deleteConfirmText,o=n.env,s=n.data,c=n.translate,l=Array.isArray(r)?r.concat():[],u=e.split(`.`).map(function(e){return parseInt(e,10)}),d=f(l,u),d?[4,this.dispatchEvent(`delete`,{index:u[u.length-1],indexPath:u.join(`.`),item:d})]:[2];case 1:return p=y.sent(),p?[2]:(m=b(s,d),z(i,m)?[4,o.confirm(a?H(a,m):c(`deleteConfirm`))]:[3,4]);case 2:return h=y.sent(),h?[4,o.fetcher(i,m)]:[2];case 3:if(g=y.sent(),!g.ok)return!i?.silent&&o.notify(`error`,i?.messages?.failed??(g.msg||c(`deleteFailed`))),this.dispatchEvent(`deleteFail`,{index:u[u.length-1],indexPath:u.join(`.`),item:d,error:g}),[2];y.label=4;case 4:return this.removeEntry(d),_=l,l=I(l,u,1),this.reUseRowId(l,_,u),this.setState(t({items:l},this.transformState(l)),function(){return F(v,void 0,void 0,function(){var e;return S(this,function(t){switch(t.label){case 0:return[4,this.emitValue(l)];case 1:return e=t.sent(),e||this.dispatchEvent(`deleteSuccess`,{value:l,index:u[u.length-1],indexPath:u.join(`.`),item:d}),[2]}})})}),[2]}})})},r.prototype.convertToRawPath=function(e,n){var r=t(t({},this.state),n),i=r.filteredItems,a=r.items,o=`${e}`.split(`.`).map(function(e){return parseInt(e,10)}),s=i[o[0]];return o[0]=a.findIndex(function(e){return e===s}),o[0]===-1?e:o.join(`.`)},r.prototype.reUseRowId=function(e,t,n){for(var r=t,i=e,a=0,o=n.length;a<o;a++){var s=n[a];if(!r?.[s]||!i?.[s])break;this.entries.set(i[s],this.entries.get(r[s])||this.entityId++),this.entries.delete(r[s]),i=i[s].children,r=r[s].children}},r.prototype.buildItemProps=function(e,t){var n={},r=this.resolveVariableProps(this.props,`minLength`),i=this.resolveVariableProps(this.props,`maxLength`);return n.inputTableCanAddItem=i?i>this.state.items.length:!0,n.inputTableCanRemoveItem=r?r<this.state.items.length:!0,this.props.needConfirm===!1?(n.quickEditEnabled=!0,n):!this.props.static&&!this.props.editable&&!this.props.addable&&!this.state.isCreateMode?n:(n.quickEditEnabled=this.state.editIndex===this.convertToRawPath(e.path),this.props.enableStaticTransform&&this.props.needConfirm!==!1&&(n.static=!n.quickEditEnabled),n)},r.prototype.buildColumns=function(e,n,r){var a=this;n===void 0&&(n=!1);var o=this.props,s=o.env,c=o.mobileUI,u=o.testIdBuilder,d=Array.isArray(e.columns)?e.columns.concat():[],f=this.props.classPrefix,p=this.props.translate,m=this.props.needConfirm,h=this.props.static,g=this.props.disabled,_=[];if(!h&&e.addable&&e.showTableAddBtn!==!1&&_.push({children:function(t){var n=t.key,r=t.rowIndexPath,i=t.inputTableCanAddItem;return a.state.editIndex&&m!==!1||!i?null:U.createElement(E,{classPrefix:f,size:`sm`,key:n,level:`link`,tooltip:p(`Table.addRow`),tooltipContainer:e.popOverContainer||s.getModalContainer,disabled:g,onClick:a.addItem.bind(a,a.convertToRawPath(r),void 0,void 0),testIdBuilder:u?.getChild(`addRow-${a.convertToRawPath(r)}`)},e.addBtnIcon?U.createElement(l,{cx:e.classnames,icon:e.addBtnIcon,className:`icon`}):null,e.addBtnLabel?U.createElement(`span`,null,e.addBtnLabel):null)}}),!h&&e.childrenAddable&&e.showTableAddBtn!==!1&&_.push({children:function(t){var n=t.key,r=t.rowIndexPath,i=t.row;return a.state.editIndex&&m!==!1?null:U.createElement(E,{classPrefix:f,size:`sm`,key:n,level:`link`,tooltip:p(`Table.subAddRow`),tooltipContainer:e.popOverContainer||s.getModalContainer,disabled:g,onClick:a.subAddItem.bind(a,a.convertToRawPath(r),void 0,i),testIdBuilder:u?.getChild(`subAddRow-${a.convertToRawPath(r)}`)},e.subAddBtnIcon?U.createElement(l,{cx:e.classnames,icon:e.subAddBtnIcon,className:`icon`}):null,e.subAddBtnLabel?U.createElement(`span`,null,e.subAddBtnLabel):null)}}),!h&&e.copyable&&e.showCopyBtn!==!1&&_.push({children:function(t){var n=t.key,r=t.rowIndexPath;return a.state.editIndex&&m!==!1?null:U.createElement(E,{classPrefix:f,size:`sm`,key:n,level:`link`,tooltip:p(`Table.copyRow`),tooltipContainer:e.popOverContainer||s.getModalContainer,disabled:g,onClick:a.copyItem.bind(a,a.convertToRawPath(r),void 0),testIdBuilder:u?.getChild(`copyRow-${a.convertToRawPath(r)}`)},e.copyBtnIcon?U.createElement(l,{cx:e.classnames,icon:e.copyBtnIcon,className:`icon`}):null,e.copyBtnLabel?U.createElement(`span`,null,e.copyBtnLabel):null)}}),e.needConfirm===!1?d=d.map(function(e){var n=e.quickEdit;return n===!1?(0,W.default)(e,[`quickEdit`]):t(t({},e),e.type===`operation`?{}:{quickEdit:t(t(t({},a.columnToQuickEdit(e)),n),{visibleOn:``,hiddenOn:``,visible:!0,hidden:!1,saveImmediately:!0,mode:`inline`,disabled:g,static:h||e.static})})}):h!==!0&&(e.addable||e.editable||n)?(d=d.map(function(e,r){var o=!n&&e.hasOwnProperty(`quickEditOnUpdate`)?e.quickEditOnUpdate:e.quickEdit,s=i(e?.type);return t({},o===!1?(0,W.default)(e,[`quickEdit`]):t(t({},e),{quickEdit:t(t(t({},a.columnToQuickEdit(e)),o),{visibleOn:``,hiddenOn:``,visible:!0,hidden:!1,isQuickEditFormMode:!!s?.isFormItem,saveImmediately:!0,mode:`inline`,disabled:g})}))}),!h&&e.editable&&_.push({children:function(t){var n=t.key,r=t.rowIndexPath,i=t.data;return a.state.editIndex||i&&i.hasOwnProperty(q)?null:U.createElement(E,{classPrefix:f,size:`sm`,key:n,level:`link`,tooltip:p(`Table.editRow`),tooltipContainer:e.popOverContainer||s.getModalContainer,disabled:g,onClick:function(){return a.editItem(a.convertToRawPath(r))},testIdBuilder:u?.getChild(`editRow-${a.convertToRawPath(r)}`)},e.updateBtnIcon===void 0?e.editBtnIcon?U.createElement(l,{cx:e.classnames,icon:e.editBtnIcon,className:`icon`}):null:e.updateBtnIcon?U.createElement(l,{cx:e.classnames,icon:e.updateBtnIcon,className:`icon`}):null,e.updateBtnLabel||e.editBtnLabel?U.createElement(`span`,null,e.updateBtnLabel||e.editBtnLabel):null)}}),!h&&_.push({children:function(t){var n=t.key,r=t.rowIndexPath;return a.state.editIndex===a.convertToRawPath(r)?U.createElement(E,{classPrefix:f,size:`sm`,key:n,level:`link`,tooltip:p(`save`),tooltipContainer:e.popOverContainer||s.getModalContainer,onClick:a.confirmEdit,testIdBuilder:u?.getChild(`confirmRow-${a.convertToRawPath(r)}`)},e.confirmBtnIcon?U.createElement(l,{cx:e.classnames,icon:e.confirmBtnIcon,className:`icon`}):null,e.confirmBtnLabel?U.createElement(`span`,null,e.confirmBtnLabel):null):null}}),!h&&_.push({children:function(t){var n=t.key,r=t.rowIndexPath;return a.state.editIndex===a.convertToRawPath(r)?U.createElement(E,{classPrefix:f,size:`sm`,key:n,level:`link`,tooltip:p(`cancel`),tooltipContainer:e.popOverContainer||s.getModalContainer,onClick:a.cancelEdit,testIdBuilder:u?.getChild(`cancelRow-${a.convertToRawPath(r)}`)},e.cancelBtnIcon?U.createElement(l,{cx:e.classnames,icon:e.cancelBtnIcon,className:`icon`}):null,e.cancelBtnLabel?U.createElement(`span`,null,e.cancelBtnLabel):null):null}})):d=d.map(function(e){return i(e?.type)?.isFormItem?t(t({},e),{quickEdit:t(t({},e),{visibleOn:``,hiddenOn:``,visible:!0,hidden:!1,isFormMode:!0})}):e}),!h&&e.removable&&_.push({children:function(t){var n=t.key,r=t.rowIndexPath,i=t.data,o=t.inputTableCanRemoveItem;return(a.state.editIndex||i&&i.hasOwnProperty(q))&&m!==!1||!o?null:U.createElement(E,{classPrefix:f,size:`sm`,key:n,level:`link`,tooltip:p(`Table.deleteRow`),tooltipContainer:e.popOverContainer||s.getModalContainer,disabled:g,onClick:a.removeItem.bind(a,a.convertToRawPath(r)),testIdBuilder:u?.getChild(`delRow-${a.convertToRawPath(r)}`)},e.deleteBtnIcon?U.createElement(l,{cx:e.classnames,icon:e.deleteBtnIcon,className:`icon`}):null,e.deleteBtnLabel?U.createElement(`span`,null,e.deleteBtnLabel):null)}}),_.length){var v=d.findIndex(function(e){return e.type===`operation`}),y=d[v];v===-1?(y={type:`operation`,buttons:[],label:p(`Table.operation`),className:`v-middle nowrap`,fixed:c?``:`right`,width:150,innerClassName:`m-n`},d.push(y)):(y=t({},y),d.splice(v,1,y)),y.buttons=Array.isArray(y.buttons)?y.buttons.concat():[],y.buttons.unshift.apply(y.buttons,_),y.hasOwnProperty(`quickEdit`)&&delete y.quickEdit}return d},r.prototype.columnToQuickEdit=function(e){return i(e?.type)?.isFormItem||~[`group`].indexOf(e.type)?t(t({},e),{label:``}):{type:`input-text`}},r.prototype.handleTableSave=function(e,n,r){var i=this,a;this.setState(function(n,o){var s={},c=n.editIndex,l=n.lastModifiedRow,u=n.items.concat();if(Array.isArray(e))r.forEach(function(r,a){r=i.convertToRawPath(r,n);var o=r.split(`.`).map(function(e){return parseInt(e,10)}),s=t({},f(e,o));u=I(u,o,1,s)});else{if(r=i.convertToRawPath(r,n),c&&r===c){var d=c.split(`.`).map(function(e){return parseInt(e,10)}),p=n.items.concat(),m=f(p,d);if(!m)return s;var h=t({},e),g=p;return p=I(p,d,1,h),i.reUseRowId(p,g,d),Object.assign(s,t({items:p,filteredItems:n.filteredItems.map(function(e){return e===m?h:e}),rowIndex:c},l?.index===c?{}:{lastModifiedRow:m.hasOwnProperty(q)?void 0:{index:c,data:t({},m)}})),s}var _=r.split(`.`).map(function(e){return parseInt(e,10)}),v=t({},e),y=u;u=I(u,_,1,v),i.reUseRowId(u,y,_)}return Object.assign(s,t({items:u,rowIndex:r},i.transformState(u,n))),a=i.lazyEmitValue,s},function(){a&&a()})},r.prototype.handleRadioChange=function(e,n){var r=this,i=n.name,a=n.row,o=n.trueValue,s=o===void 0?!0:o,c=n.falseValue,l=c===void 0?!1:c,u;return this.setState(function(e,n){var o=a.path,c=M(e.items,function(e,n,r,a,c){var u;return t(t({},e),(u={},u[i]=o===c.join(`.`)?s:l,u))});return u=e.editIndex==a.path?void 0:r.lazyEmitValue,t({items:c},r.transformState(c))},function(){u?.()}),!1},r.prototype.handleSaveTableOrder=function(e,n){var r=this.props.onChange;r(n.map(function(e){return t({},e)}))},r.prototype.handlePageChange=function(e){this.setState(t({},this.transformState(this.state.items,{page:e})))},r.prototype.handleTableQuery=function(e){e=t(t({},this.state.query),e),this.setState(t({query:e},this.transformState(this.state.items,{query:e})))},r.prototype.handlePristineChange=function(e,n){var r=this,i=this.props.needConfirm,a=n.split(`.`).map(function(e){return parseInt(e,10)});this.setState(function(n){var i=n.items.concat(),o=t(t({},f(i,a)),e),s=i;return i=I(i,a,1,o),r.reUseRowId(i,s,a),t({items:i},r.transformState(i))},function(){i===!1&&r.emitValue()})},r.prototype.removeEntry=function(e){this.entries.has(e)&&this.entries.delete(e)},r.prototype.getEntryId=function(e){return this.entries.has(e)||this.entries.set(e,this.entityId++),String(this.entries.get(e))},r.prototype.tableRef=function(e){for(;e&&e.getWrappedInstance;)e=e.getWrappedInstance();this.table=e},r.prototype.computedAddBtnDisabled=function(){return this.props.disabled||!!this.state.editIndex},r.prototype.filterItemIndex=function(e){return this.convertToRawPath(e)},r.prototype.render=function(){var e=this,n=this.props,r=n.className;n.style,n.value;var i=n.disabled,a=n.render,o=n.placeholder,s=n.draggable,c=n.addable,l=n.columnsTogglable,u=n.combineNum,d=n.combineFromIndex,f=n.translate,p=n.canAccessSuperData,m=n.expandConfig,h=n.affixRow,g=n.prefixRow,_=n.formInited,v=n.perPage,y=n.classnames,b=n.rowClassName,x=n.rowClassNameExpr,S=n.affixHeader,C=S===void 0?!1:S,w=n.autoFillHeight,T=w===void 0?!1:w,E=n.tableContentClassName,D=n.static,O=n.showFooterAddBtn,k=n.footerAddBtn,A=n.toolbarClassName,j=n.onEvent,M=n.testIdBuilder,N=n.showIndex,P=this.resolveVariableProps(this.props,`maxLength`);if(_===!1)return null;var F=this.state.query,I=this.state.filteredItems;this.state.items;var L=typeof v==`number`,R=this.state.page||1,z=!D&&c&&O!==!1&&(!P||P>this.state.items.length);return U.createElement(`div`,{className:y(`InputTable`,r)},a(`body`,{type:`table`,placeholder:f(o),columns:this.state.columns,affixHeader:C,prefixRow:g,affixRow:h,autoFillHeight:T,tableContentClassName:E,onEvent:j,showIndex:N},{ref:this.tableRef,value:void 0,saveImmediately:!0,disabled:i,draggable:s&&!this.state.editIndex,items:I,getEntryId:this.getEntryId,reUseRow:`match`,onSave:this.handleTableSave,onRadioChange:this.handleRadioChange,onSaveOrder:this.handleSaveTableOrder,buildItemProps:this.buildItemProps,quickEditFormRef:this.subFormRef,quickEditFormItemRef:this.subFormItemRef,columnsTogglable:l,combineNum:this.state.editIndex?0:u,combineFromIndex:d,expandConfig:m,canAccessSuperData:p,rowClassName:b,rowClassNameExpr:x,onPristineChange:this.handlePristineChange,testIdBuilder:M?.getChild(`table`),onQuery:this.handleTableQuery,query:F,orderBy:F?.orderBy,orderDir:F?.orderDir,filterItemIndex:this.filterItemIndex}),z||L?U.createElement(`div`,{className:y(`InputTable-toolbar`,A)},z?a(`button`,t({type:`button`,level:`primary`,size:`sm`,label:f(`Table.add`),icon:`fa fa-plus`,disabledTip:f(`Table.addButtonDisabledTip`)},k||{}),{disabled:this.computedAddBtnDisabled(),onClick:function(){return e.addItem()},testIdBuilder:M?.getChild(`add`)}):null,L?a(`pager`,{type:`pagination`},{activePage:R,perPage:v,total:this.state.total,onPageChange:this.handlePageChange,className:`InputTable-pager`,testIdBuilder:M?.getChild(`page`),disabled:!!this.state.editIndex}):null):null)},r.defaultProps={placeholder:`placeholder.empty`,scaffold:{},addBtnIcon:`plus`,subAddBtnIcon:`sub-plus`,copyBtnIcon:`copy`,editBtnIcon:`pencil`,deleteBtnIcon:`minus`,confirmBtnIcon:`check`,cancelBtnIcon:`close`,valueField:``,minLength:0,maxLength:1/0,showFooterAddBtn:!0,showTableAddBtn:!0},r.propsList=[`onChange`,`name`,`columns`,`label`,`scaffold`,`showTableAddBtn`,`addable`,`removable`,`copyable`,`editable`,`addApi`,`updateApi`,`deleteApi`,`needConfirm`,`canAccessSuperData`,`formStore`,`footerActions`,`toolbarClassName`],g([n,a(`design:type`,Function),a(`design:paramtypes`,[Object,String]),a(`design:returntype`,void 0)],r.prototype,`handlePristineChange`,null),r}(U.Component),Y=function(e){v(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.setData=function(e,n,r,i){return F(this,void 0,void 0,function(){var a,o,c,l,u,d=this;return S(this,function(p){switch(p.label){case 0:return r===void 0?[3,1]:(a=C([],s(this.state.items),!1),o=String(r).split(`,`),o.forEach(function(r){var i=r.split(`.`).map(function(e){return parseInt(e,10)}),o=a;a=I(a,i,1,n?e:t(t({},f(a,i)),e)),d.reUseRowId(a,o,i)}),this.setState(t({items:a},this.transformState(a)),function(){d.emitValue()}),[3,4]);case 1:return i===void 0?[3,3]:(c=C([],s(this.state.items),!1),l=[],x(c,function(r,a,o,u,p){return l.unshift(function(){return F(d,void 0,void 0,function(){var o,l;return S(this,function(u){switch(u.label){case 0:return[4,D(i,r)];case 1:return o=u.sent(),o&&(l=c,c=I(c,C(C([],s(p),!1),[a],!1),1,n?e:t(t({},f(c,C(C([],s(p),!1),[a],!1))),e)),this.reUseRowId(c,l,C(C([],s(p),!1),[a],!1))),[2]}})})}),!0}),[4,Promise.all(l.map(function(e){return e()}))]);case 2:return p.sent(),this.setState(t({items:c},this.transformState(c)),function(){d.emitValue()}),[3,4];case 3:u=C([],s(e),!1),this.setState(t({items:u},this.transformState(u)),function(){d.emitValue()}),p.label=4;case 4:return[2]}})})},n.prototype.doAction=function(n,r,i,a){return i===void 0&&(i=!1),F(this,void 0,void 0,function(){var c,l,u,d,p,m,h,g,_,v,y,w,T,E,O,k,A,j,M,N,P,A,L,R,B=this;return S(this,function(V){switch(V.label){case 0:return c=this.props,l=c.valueField,u=c.env,d=c.needConfirm,c.addable,p=c.addApi,m=c.deleteApi,h=c.resetValue,g=c.translate,_=c.onChange,v=c.formStore,y=c.store,w=c.name,T=n.actionType,E=this.props.store?.data||{},T===`addItem`?(O=this.state.items.concat(),p||a?(k=null,z(p,E)?[4,u.fetcher(p,E)]:[3,2]):[3,4]):[3,6];case 1:return A=V.sent(),A&&!A.ok?(!p?.silent&&u.notify(`error`,p?.messages?.failed??(A.msg||g(`fetchFailed`))),[2]):(A&&A.ok&&(k=A.data),[3,3]);case 2:k=a.item,V.label=3;case 3:return k=(Array.isArray(k)?k:[k]).filter(function(e){return!l||!(0,G.default)(O,function(t){return t[l]==e[l]})}),j=[],typeof a.index==`string`&&/^\d+(\.\d+)*$/.test(a.index)?j=a.index.split(`.`).map(function(e){return parseInt(e,10)}):typeof a.index==`number`&&(j=[a.index]),j.length?O=I.apply(void 0,C([O,j,0],s(k),!1)):O.push.apply(O,C([],s(k),!1)),this.setState(t({items:O},this.transformState(O)),function(){if(k.length===1&&d!==!1){var e=j.concat();e[e.length-1]+=1,B.startEdit(e.join(`.`),!0)}else _?.(O)}),[2];case 4:return[2,this.addItem(`${O.length-1}`,!1)];case 5:return[3,13];case 6:return T===`deleteItem`?(M=C([],s(this.state.items),!1),N=[],a?.index===void 0?[3,7]:(String(a.index).split(`,`).map(function(e){return e.split(`.`).map(function(e){return parseInt(e,10)})}).sort(function(e,t){for(var n=Math.max(e.length,t.length),r=0;r<n;r++){var i=e[r]||0,a=t[r]||0;if(i!==a)return a-i}return 0}).forEach(function(e){N.push(f(M,e)),M=I(M,e,1)}),[3,9])):[3,12];case 7:return a?.condition===void 0?[3,9]:(P=[],x(M,function(e,t,n,r,i){return P.unshift(function(){return F(B,void 0,void 0,function(){var n;return S(this,function(r){switch(r.label){case 0:return[4,D(a?.condition,e)];case 1:return n=r.sent(),n&&(N.push(e),M=I(M,C(C([],s(i),!1),[t],!1),1)),[2]}})})}),!0}),[4,P.reduce(function(e,t){return e.then(t)},Promise.resolve())]);case 8:V.sent(),V.label=9;case 9:return z(m,b(E,{deletedItems:N}))?[4,u.fetcher(m,b(E,{deletedItems:N}))]:[3,11];case 10:if(A=V.sent(),A&&!A.ok)return!m?.silent&&u.notify(`error`,m?.messages?.failed??(A.msg||g(`fetchFailed`))),[2];V.label=11;case 11:return this.setState(t({items:M},this.transformState(M)),function(){_?.(M)}),[2];case 12:if(T===`clear`)return this.setState({items:[]},function(){_?.([])}),[2];if(T===`reset`)return L=o(v?.pristine??y?.pristine,w)??h,R=Array.isArray(L)?L:[],this.setState(t({items:R},this.transformState(R)),function(){_?.(R)}),[2];V.label=13;case 13:return[2,e.prototype.doAction.call(this,n,r,i,E)]}})})},n=g([N({type:`input-table`})],n),n}(J);export{Y as TableControlRenderer,J as default};