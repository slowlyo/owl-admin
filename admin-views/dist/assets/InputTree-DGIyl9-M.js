import{t as q,bk as Le,am as Be,aF as K,c2 as Re,bK as Q,z as C,bm as Y,G as L,H as B,a4 as x,l as b,ca as Pe,ag as R,aO as Ue,w as ze,x as He,cb as $e,ad as Ge,P as Ke,ae as Qe,D as m,Q as I,T as s,ap as Ye,br as qe,cc as Je,ah as Me,Y as We}from"./index-BnZOs00e.js";var Xe=function(E){q(o,E);function o(e){var t=this,i;return t=E.call(this,e)||this,t.state={keyword:"",filteredOptions:(i=t.props.options)!==null&&i!==void 0?i:[],allowSearch:!1},t.handleSearch=Le(t.handleSearch.bind(t),250,{trailing:!0,leading:!1}),t}return o.prototype.componentDidUpdate=function(e){var t=this.props,i=this.state.keyword;if(e.options!==t.options||e.searchable!==t.searchable){var a=t.options,r=t.searchable;this.setState({filteredOptions:r&&i?this.filterOptions(a,i):a})}},o.prototype.reload=function(e,t){var i=this.props.reloadOptions;i&&i(e,t)},o.prototype.doAction=function(e,t,i){var a,r,l,n,u,d,p,h,c,F,f,T=e==null?void 0:e.actionType,y=this.props,A=y.resetValue,v=y.onChange,g=y.formStore,_=y.store,O=y.name;if(T==="clear")v==null||v("");else if(T==="reset"){var w=(r=Be((a=g==null?void 0:g.pristine)!==null&&a!==void 0?a:_==null?void 0:_.pristine,O))!==null&&r!==void 0?r:A;v==null||v(w??"")}else e.actionType==="expand"?this.treeRef.syncUnFolded(this.props,(l=e.args)===null||l===void 0?void 0:l.openLevel):e.actionType==="collapse"?this.treeRef.syncUnFolded(this.props,((n=e.args)===null||n===void 0?void 0:n.closeLevel)||0):e.actionType==="add"?this.addItemFromAction((u=e.args)===null||u===void 0?void 0:u.item,(d=e.args)===null||d===void 0?void 0:d.parentValue):e.actionType==="edit"?this.editItemFromAction((p=e.args)===null||p===void 0?void 0:p.item,(h=e.args)===null||h===void 0?void 0:h.originValue):e.actionType==="delete"?this.deleteItemFromAction((c=e.args)===null||c===void 0?void 0:c.value):e.actionType==="reload"?this.reload():T==="search"&&(this.setState({allowSearch:!!(!((F=e.args)===null||F===void 0)&&F.keyword)}),this.handleSearch((f=e.args)===null||f===void 0?void 0:f.keyword))},o.prototype.resolveOption=function(e,t){var i=this;return K(e,function(a){var r=i.props.valueField||"value",l=Q(a,r)?a[r]:"";return l===t})},o.prototype.addItemFromAction=function(e,t){var i=this.props,a=i.onAdd,r=i.options,l=i.valueField,n=Re(r,function(u){var d=l||"value",p=Q(u,d)?u[d]:"";return p===t})||[];a&&a(n.concat(0),e,!0)},o.prototype.editItemFromAction=function(e,t){var i=this.props,a=i.onEdit,r=i.options,l=this.resolveOption(r,t);a&&l&&a(C(C({},e),{originValue:t}),l,!0)},o.prototype.deleteItemFromAction=function(e){var t=this.props,i=t.onDelete,a=t.options,r=this.resolveOption(a,e);i&&r&&i(r)},o.prototype.filterOptions=function(e,t){var i=this,a=this.props,r=a.labelField,l=a.valueField;return e.map(function(n){if(n=C({},n),n.visible=!!Y([n],t,{keys:[r||"label",l||"value"],threshold:Y.rankings.CONTAINS}).length,!n.visible&&n.children){n.children=i.filterOptions(n.children,t);var u=n.children.filter(function(d){return d.visible}).length;n.visible=!!u}return n.visible&&(n.collapsed=!1),n})},o.prototype.handleChange=function(e){return L(this,void 0,void 0,function(){var t,i,a,r,l,n,u,d,p,h,c,F,f,T,y,A,v,g;return B(this,function(_){switch(_.label){case 0:return t=this.props,i=t.onChange,a=t.searchable,r=t.options,l=t.dispatchEvent,n=t.multiple,u=t.delimiter,d=t.valueField,p=t.selectedOptions,h=t.joinValues,c=t.extractValue,F=this.state,f=F.filteredOptions,T=F.allowSearch,y=a||T?f:r,A=Je(e,{multiple:n,delimiter:u,valueField:d,options:f}),v=n?null:A[0],n&&(a||T)&&p.length&&(p.forEach(function(O){var w=K(f,function(D){return D[d||"value"]===O[d||"value"]});w||A.push(O)}),e=A.map(function(O){return c||h?O[d||"value"]:O}),h&&(e=e.join(u||","))),[4,l("change",Me(this.props,{value:e,item:v,items:y,selectedItems:A}))];case 1:return g=_.sent(),g!=null&&g.prevented?[2]:(i&&i(e),[2])}})})},o.prototype.handleNodeClick=function(e){return L(this,void 0,void 0,function(){var t,i,a,r;return B(this,function(l){switch(l.label){case 0:return t=this.props,i=t.dispatchEvent,a=t.data,[4,i("itemClick",x(a,{item:e}))];case 1:return r=l.sent(),r!=null&&r.prevented?[2]:[2]}})})},o.prototype.handleSearch=function(e){return L(this,void 0,void 0,function(){var t,i,a,r,l,n,u,d,p,h;return B(this,function(c){switch(c.label){case 0:if(t=this.props,i=t.searchApi,a=t.options,r=t.env,l=t.data,n=t.translate,u=[],!We(i))return[3,5];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,r.fetcher(i,x(l,{term:e}))];case 2:if(d=c.sent(),!d.ok)throw new Error(n(d.msg||"networkError"));if(p=d.data.options||d.data.items||d.data,!Array.isArray(p))throw new Error(n("Tree.invalidArray"));return u=p,[3,4];case 3:return h=c.sent(),r.isCancel(h)||!i.silent&&r.notify("error",h.message),[3,4];case 4:return[3,6];case 5:e&&(u=this.filterOptions(a,e)),c.label=6;case 6:return this.setState({keyword:e,filteredOptions:e?u:a}),[2]}})})},o.prototype.domRef=function(e){this.treeRef=e},o.prototype.validate=function(){var e=this.props,t=e.value,i=e.minLength,a=e.maxLength,r=e.delimiter,l=Array.isArray(t)?t:(t?String(t):"").split(r||",");if(i&&l.length<i)return"已选择数量低于设定的最小个数".concat(i,"，请选择更多的选项。");if(a&&l.length>a)return"已选择数量超出设定的最大个数".concat(a,"，请取消选择超出的选项。")},o.prototype.renderOptionItem=function(e,t){var i=this.props,a=i.menuTpl,r=i.render,l=i.data;return r("option/".concat(t.index),a,{data:x(x(l,C({},t)),e)})},o.prototype.renderItemActions=function(e,t){var i=this.props,a=i.itemActions,r=i.data,l=i.render;return l("action/".concat(t.index),a||"",{data:x(x(r,C({},t)),e)})},o.prototype.renderSearch=function(){var e=this.props,t=e.classPrefix,i=e.searchConfig,a=e.mobileUI,r=e.testIdBuilder;return b.createElement(Pe,C({className:R("".concat(t,"TreeControl-searchbox"),i==null?void 0:i.className,{"is-sticky":i==null?void 0:i.sticky}),mini:!1,clearable:!0},Ue(i,"className","sticky"),{onSearch:this.handleSearch,mobileUI:a,testIdBuilder:r==null?void 0:r.getChild("search")}))},o.prototype.render=function(){var e=this.props,t=e.className,i=e.treeContainerClassName,a=e.classPrefix,r=e.value,l=e.enableNodePath,n=e.pathSeparator,u=n===void 0?"/":n,d=e.disabled,p=e.joinValues,h=e.extractValue,c=e.delimiter,F=e.placeholder,f=e.options,T=e.multiple,y=e.valueField,A=e.initiallyOpen,v=e.unfoldedLevel,g=e.withChildren,_=e.onlyChildren,O=e.onlyLeaf,w=e.loading,D=e.hideRoot,J=e.rootLabel,M=e.autoCheckChildren,W=e.autoCancelParent,X=e.cascade,Z=e.rootValue,ee=e.showIcon,te=e.showRadio,ie=e.showOutline,ae=e.onAdd,re=e.creatable,oe=e.createTip,ne=e.addControls,le=e.onEdit,se=e.editable,de=e.editTip,ue=e.editControls,pe=e.removable,ce=e.removeTip,he=e.onDelete,ve=e.rootCreatable,me=e.rootCreateTip,fe=e.labelField,ye=e.iconField,ge=e.deferField,Ce=e.nodePath,be=e.deferLoad,Fe=e.expandTreeOptions,P=e.translate,Te=e.data,Ae=e.virtualThreshold,Oe=e.loadingConfig,Ie=e.menuTpl,_e=e.enableDefaultIcon,N=e.searchable,U=e.searchConfig,V=U===void 0?{}:U,we=e.heightAuto,Ee=e.mobileUI,S=e.testIdBuilder,Se=e.nodeBehavior,xe=e.itemActions,z=e.id,Ne=e.wrapperCustomStyle,H=e.themeCss,ke=e.env,De=e.treeClassName,k=this.props.highlightTxt,j=this.state,Ve=j.filteredOptions,je=j.keyword,$=j.allowSearch;ze(k)&&(k=He(k,Te));var G=b.createElement($e,{className:De,classPrefix:a,onRef:this.domRef,labelField:fe,valueField:y,iconField:ye,deferField:ge,disabled:d,onChange:this.handleChange,onHandleNodeClick:this.handleNodeClick,joinValues:p,extractValue:h,delimiter:c,placeholder:P(F),options:N||$?Ve:f,highlightTxt:N||$?je:k,multiple:T,initiallyOpen:A,unfoldedLevel:v,withChildren:g,onlyChildren:_,onlyLeaf:O,hideRoot:D,rootLabel:P(J),rootValue:Z,showIcon:ee,showRadio:te,showOutline:ie,autoCheckChildren:M,autoCancelParent:W,cascade:X,foldedField:"collapsed",value:r||"",nodePath:Ce,enableNodePath:l,pathSeparator:u,selfDisabledAffectChildren:!1,onAdd:ae,creatable:re,createTip:oe,rootCreatable:ve,rootCreateTip:me,onEdit:le,editable:se,editTip:de,removable:pe,removeTip:ce,onDelete:he,bultinCUD:!ne&&!ue,onDeferLoad:be,onExpandTree:Fe,virtualThreshold:Ae,itemRender:Ie?this.renderOptionItem:void 0,enableDefaultIcon:_e,mobileUI:Ee,nodeBehavior:Se,itemActionsRender:xe?this.renderItemActions:void 0,actionClassName:R(Ge(C(C({},this.props),{name:"actionControlClassName",id:z,themeCss:H}))),testIdBuilder:S==null?void 0:S.getChild("tree")});return b.createElement(b.Fragment,null,b.createElement("div",C({className:R("".concat(a,"TreeControl"),t,i,{"is-sticky":N&&(V==null?void 0:V.sticky),"h-auto":we})},S==null?void 0:S.getChild("control").getTestId()),w?null:N?b.createElement(b.Fragment,null,this.renderSearch(),G):G,b.createElement(Ke,{size:"sm",key:"info",show:w,loadingConfig:Oe})),b.createElement(Qe,C({},this.props,{config:{wrapperCustomStyle:Ne,id:z,themeCss:H,classNames:[{key:"actionControlClassName"}]},env:ke})))},o.defaultProps={placeholder:"placeholder.noData",multiple:!1,rootLabel:"Tree.root",rootValue:"",showIcon:!0,enableNodePath:!1,pathSeparator:"/"},m([I,s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],o.prototype,"addItemFromAction",null),m([I,s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],o.prototype,"editItemFromAction",null),m([I,s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],o.prototype,"deleteItemFromAction",null),m([I,s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],o.prototype,"handleChange",null),m([I,s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],o.prototype,"handleNodeClick",null),m([I,s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],o.prototype,"domRef",null),m([I,s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],o.prototype,"renderOptionItem",null),m([I,s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],o.prototype,"renderItemActions",null),m([I,s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",void 0)],o.prototype,"renderSearch",null),m([Ye(),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",void 0)],o.prototype,"render",null),o}(b.Component),et=function(E){q(o,E);function o(){return E!==null&&E.apply(this,arguments)||this}return o=m([qe({type:"input-tree"})],o),o}(Xe);export{et as TreeControlRenderer,Xe as default};
