import{$o as e,Ao as t,Ci as n,Fo as r,Io as i,Jr as a,Ko as o,La as s,Mo as c,No as l,Oa as u,Po as d,jo as f,jr as p,kr as m,ti as h,vr as g,wr as _,xr as v}from"./index-C4Pf1uQ-.js";var y=e(o()),b=function(e){l(o,e);function o(){var t=e!==null&&e.apply(this,arguments)||this;return t.IFrameRef=y.createRef(),t.state={width:t.props.width||`100%`,height:t.props.height||`100%`},t}return o.prototype.componentDidMount=function(){window.addEventListener(`message`,this.onMessage)},o.prototype.componentDidUpdate=function(e){var t=this.props.data;t===e.data?(this.props.width!==e.width||this.props.height!==e.height)&&this.setState({width:this.props.width||`100%`,height:this.props.height||`100%`}):this.postMessage(`update`,t)},o.prototype.componentWillUnmount=function(){window.removeEventListener(`message`,this.onMessage)},o.prototype.validateURL=function(e){return e&&typeof e==`string`&&/^data:([a-zA-Z0-9]+\/[a-zA-Z0-9]+);base64,.*/.test(e)?!0:!(e&&typeof e==`string`&&!/^(\.\/|\.\.\/|\/|(blob\:)?https?\:\/\/|\/\/)/.test(e))},o.prototype.onMessage=function(e){return f(this,void 0,void 0,function(){var t,n,r,o,s,c,l,f,m,h,g;return d(this,function(d){switch(d.label){case 0:return t=this.props,n=t.events,r=t.onEvent,o=t.onAction,s=t.data,typeof e?.data?.type!=`string`||(c=i(e.data.type.split(`:`),2),l=c[0],f=c[1],l!==`amis`||!f)?[2]:f===`resize`&&e.data.data?(this.setState({width:e.data.data.width||`100%`,height:e.data.data.height||`100%`}),[3,4]):[3,1];case 1:return m=r?.[f],m&&m.actions?.length?(h=p(f,{env:this.props?.env,nativeEvent:e,data:u(s,e.data.data),scoped:this.context}),[4,a(m.actions,this,h)]):[3,3];case 2:if(d.sent(),h.prevented)return[2];d.label=3;case 3:n&&(g=n[f],g&&o(e,g,u(s,e.data.data))),d.label=4;case 4:return[2]}})})},o.prototype.onLoad=function(){var e=this.props,t=e.src,n=e.data;t&&this.postMessage(`init`,n)},o.prototype.reload=function(e,t){if(t)return this.receive(t);var n=this.props,r=n.src,i=n.data;r&&(this.IFrameRef.current.src=s(r,i,`| raw`))},o.prototype.receive=function(e){var t=this.props,n=t.src,r=t.data,i=u(r,e);this.postMessage(`receive`,i),h(n,n,r,i)&&(this.IFrameRef.current.src=s(n,i,`| raw`))},o.prototype.postMessage=function(e,t){var n;(n=this.IFrameRef.current?.contentWindow)==null||n.postMessage({type:`amis:${e}`,data:JSON.parse(JSON.stringify(t))},`*`)},o.prototype.render=function(){var e=this.state,n=e.width,r=e.height,i=this.props,a=i.className,o=i.src,c=i.name,l=i.frameBorder,u=i.data,d=i.style,f=i.allow,p=i.sandbox,m=i.referrerpolicy,h=i.translate,_=i.id,b=i.wrapperCustomStyle,x=i.env,S=i.themeCss;i.baseControlClassName;var C=i.inDragging,w=i.classnames,T={};n!==void 0&&(T.width=n),r!==void 0&&(T.height=r),d=t(t({},T),d),C&&(d=t(t({},d),{pointerEvents:`none`}));var E=o?s(o,u,`| raw`):void 0;return this.validateURL(E)?(location.protocol===`https:`&&E&&E.startsWith(`http://`)&&x.notify(`error`,h(`Iframe.invalidProtocol`)),y.createElement(y.default.Fragment,null,y.createElement(`iframe`,{name:c,className:w(`IFrame`,a,v(t(t({},this.props),{name:`baseControlClassName`,id:_,themeCss:S})),v(t(t({},this.props),{name:`wrapperCustomStyle`,id:_,themeCss:b}))),frameBorder:l,style:d,ref:this.IFrameRef,onLoad:this.onLoad,src:E,allow:f,referrerPolicy:m,sandbox:p}),y.createElement(g,t({},this.props,{config:{wrapperCustomStyle:b,id:_,themeCss:S,classNames:[{key:`baseControlClassName`}]},env:x})))):y.createElement(`p`,null,h(`Iframe.invalid`))},o.propsList=[`src`,`className`],o.defaultProps={className:``,frameBorder:0},c([n,r(`design:type`,Function),r(`design:paramtypes`,[MessageEvent]),r(`design:returntype`,Promise)],o.prototype,`onMessage`,null),c([n,r(`design:type`,Function),r(`design:paramtypes`,[]),r(`design:returntype`,void 0)],o.prototype,`onLoad`,null),c([n,r(`design:type`,Function),r(`design:paramtypes`,[Object,Object]),r(`design:returntype`,void 0)],o.prototype,`reload`,null),c([n,r(`design:type`,Function),r(`design:paramtypes`,[Object]),r(`design:returntype`,void 0)],o.prototype,`receive`,null),c([n,r(`design:type`,Function),r(`design:paramtypes`,[String,Object]),r(`design:returntype`,void 0)],o.prototype,`postMessage`,null),o}(y.Component),x=function(e){l(t,e);function t(t,n){var r=e.call(this,t)||this;return n.registerComponent(r),r}return t.prototype.componentWillUnmount=function(){this.context.unRegisterComponent(this),e.prototype.componentWillUnmount.call(this)},t.contextType=m,t=c([_({type:`iframe`}),r(`design:paramtypes`,[Object,Object])],t),t}(b);export{x as IFrameRenderer,b as default};