import{$o as e,Ao as t,Br as n,Di as r,Dr as i,En as a,Fo as o,Go as s,Hn as c,Ii as l,Kn as u,Ko as d,La as f,Mo as p,Mr as m,No as h,Oa as g,Po as _,Vn as v,ba as y,hi as b,jo as x,kr as S,or as C,ua as w,vr as T,wr as E,xi as D,xr as O,ya as k}from"./index-DAdqRbKX.js";var A=e(d()),j=s(),M=e(b()),N=function(e){h(n,e);function n(t){var r=e.call(this,t)||this;r.handleAction=r.handleAction.bind(r),r.handleCheck=r.handleCheck.bind(r),r.handleClick=r.handleClick.bind(r),r.handleCheckAll=r.handleCheckAll.bind(r),r.handleQuickChange=r.handleQuickChange.bind(r),r.handleSave=r.handleSave.bind(r),r.handleSaveOrder=r.handleSaveOrder.bind(r),r.reset=r.reset.bind(r),r.dragTipRef=r.dragTipRef.bind(r),r.bodyRef=r.bodyRef.bind(r),r.renderToolbar=r.renderToolbar.bind(r);var i=t.store,a=t.selectable,o=t.draggable,s=t.orderBy,c=t.orderDir,l=t.multiple,u=t.hideCheckToggler,d=t.itemCheckableOn,f=t.itemDraggableOn;return i.update({selectable:a,draggable:o,orderBy:s,orderDir:c,multiple:l,hideCheckToggler:u,itemCheckableOn:d,itemDraggableOn:f}),n.syncItems(i,r.props)&&r.syncSelected(),r}return n.syncItems=function(e,t,n){var r=t.source,i=l(t,function(e){return e.items}),a=[],o=!1;if(Array.isArray(i))(!n||l(n,function(e){return e.items})!==i)&&(a=i,o=!0);else if(typeof r==`string`){var s=f(r,t.data,`| raw`);(n?f(r,n.data,`| raw`):null)===s?o=!1:(a=Array.isArray(s)?s:[],o=!0)}return o&&e.initItems(a,t.fullItems,t.selected),Array.isArray(t.selected)&&e.updateSelected(t.selected,t.valueField),o},n.prototype.componentDidUpdate=function(e){var t=this.props,r=t.store;D([`selectable`,`draggable`,`orderBy`,`orderDir`,`multiple`,`hideCheckToggler`,`itemCheckableOn`,`itemDraggableOn`],e,t)&&r.update({selectable:t.selectable,draggable:t.draggable,orderBy:t.orderBy,orderDir:t.orderDir,multiple:t.multiple,hideCheckToggler:t.hideCheckToggler,itemCheckableOn:t.itemCheckableOn,itemDraggableOn:t.itemDraggableOn}),D([`source`,`value`,`items`],e,t)||!t.value&&!t.items&&(t.data!==e.data||typeof t.source==`string`&&y(t.source))?n.syncItems(r,t,e)&&this.syncSelected():e.selected!==t.selected&&r.updateSelected(t.selected||[],t.valueField)},n.prototype.bodyRef=function(e){this.body=e},n.prototype.handleAction=function(e,t,n){var r=this.props.onAction;return r?.(e,t,n)},n.prototype.handleCheck=function(e){e.toggle(),this.syncSelected();var n=this.props,r=n.store,i=n.dispatchEvent;i(`selectedChange`,g(r.data,t(t({},r.eventContext),{item:e.data})))},n.prototype.handleClick=function(e){var t=this.props,n=t.dispatchEvent,r=t.data;return n(`rowClick`,g(r,{item:e.data,index:e.index}))},n.prototype.handleCheckAll=function(){this.props.store.toggleAll(),this.syncSelected()},n.prototype.handleSelectAll=function(){this.props.store.selectAll(),this.syncSelected()},n.prototype.handleClearAll=function(){this.props.store.clearAll(),this.syncSelected()},n.prototype.syncSelected=function(){var e=this.props,t=e.store,n=e.onSelect,r=e.dispatchEvent,i=t.selectedItems.map(function(e){return e.data}),a=t.unSelectedItems.map(function(e){return e.data});r(`selected`,g(t.data,{selectItems:i,unSelectItems:a})),n&&n(i,a)},n.prototype.handleQuickChange=function(e,t,n,i,a){e.change(t,i);var o=this.props,s=o.onSave,c=o.onItemChange,l=o.primaryField;if(!i){if(c?.(e.data,r(e.data,e.pristine,[`id`,l]),e.index),n&&n.api){this.props.onAction(null,{actionType:`ajax`,api:n.api,reload:a?.reload},e.locals);return}!n||!s||s(e.data,r(e.data,e.pristine,[`id`,l]),e.index,void 0,e.pristine,a)}},n.prototype.handleSave=function(){var e=this.props,t=e.store,n=e.onSave,i=e.primaryField;if(!(!n||!t.modifiedItems.length)){var a=t.modifiedItems.map(function(e){return e.data}),o=t.modifiedItems.map(function(e){return e.index});n(a,t.modifiedItems.map(function(e){return r(e.data,e.pristine,[`id`,i])}),o,t.items.filter(function(e){return!e.modified}).map(function(e){return e.data}),t.modifiedItems.map(function(e){return e.pristine}))}},n.prototype.handleSaveOrder=function(){return x(this,void 0,void 0,function(){var e,t,n,r,i,a,o;return _(this,function(s){switch(s.label){case 0:return e=this.props,t=e.store,n=e.onSaveOrder,r=e.data,i=e.dispatchEvent,a=t.movedItems.map(function(e){return e.data}),[4,i(`orderChange`,g(r,{movedItems:a}))];case 1:return o=s.sent(),o?.prevented||!n||!t.movedItems.length||n(t.movedItems.map(function(e){return e.data}),t.items.map(function(e){return e.data})),[2]}})})},n.prototype.reset=function(){this.props.store.reset()},n.prototype.bulkUpdate=function(e,n){var r=this.props,i=r.store,a=r.primaryField;if(a&&e.ids){var o=e.ids.split(`,`),s=i.items.filter(function(e){return(0,M.default)(o,function(t){return t&&t==e.data[a]})}),c=t(t({},e),{ids:void 0});s.forEach(function(e){return e.change(c)})}else if(Array.isArray(n)){var s=i.items.filter(function(e){return~n.indexOf(e.pristine)});s.forEach(function(t){return t.change(e)})}},n.prototype.getSelected=function(){return this.props.store.selectedItems.map(function(e){return e.data})},n.prototype.dragTipRef=function(e){!this.dragTip&&e?this.initDragging():this.dragTip&&!e&&this.destroyDragging(),this.dragTip=e},n.prototype.initDragging=function(){if(!this.sortable){var e=this.props.store,t=(0,j.findDOMNode)(this),n=this.props.classPrefix;this.sortable=new a(t.querySelector(`.${n}Cards-body`),{group:`table`,animation:150,handle:`.${n}Card-dragBtn`,ghostClass:`is-dragging`,onEnd:function(t){if(t.newIndex!==t.oldIndex){var n=t.to;t.oldIndex<n.childNodes.length-1?n.insertBefore(t.item,n.childNodes[t.oldIndex>t.newIndex?t.oldIndex+1:t.oldIndex]):n.appendChild(t.item),e.exchange(t.oldIndex,t.newIndex)}}})}},n.prototype.destroyDragging=function(){this.sortable&&this.sortable.destroy(),this.sortable=void 0},n.prototype.renderActions=function(e){var n=this,r=this.props,i=r.actions,a=r.render,o=r.store,s=r.classnames,c;return i=Array.isArray(i)?i.concat():[],!~this.renderedToolbars.indexOf(`check-all`)&&(c=this.renderCheckAll())&&i.unshift({type:`button`,children:c}),e===`header`&&!~this.renderedToolbars.indexOf(`drag-toggler`)&&(c=this.renderDragToggler())&&i.unshift({type:`button`,children:c}),Array.isArray(i)&&i.length?A.createElement(`div`,{className:s(`Cards-actions`)},i.map(function(e,r){return a(`action/${r}`,t({type:`button`},e),{onAction:n.handleAction,key:r,btnDisabled:o.dragging})})):null},n.prototype.renderHeading=function(){var e=this.props,t=e.title,n=e.store,r=e.hideQuickSaveBtn,i=e.classnames,a=e.data;return t||n.modified&&!r||n.moved?A.createElement(`div`,{className:i(`Cards-heading`)},n.modified&&!r?A.createElement(`span`,null,`当前有 ${n.modified} 条记录修改了内容, 但并没有提交。请选择:`,A.createElement(`button`,{type:`button`,className:i(`Button Button--xs Button--success m-l-sm`),onClick:this.handleSave},A.createElement(u,{icon:`check`,className:`icon m-r-xs`}),`提交`),A.createElement(`button`,{type:`button`,className:i(`Button Button--xs Button--danger m-l-sm`),onClick:this.reset},A.createElement(u,{icon:`close`,className:`icon m-r-xs`}),`放弃`)):n.moved?A.createElement(`span`,null,`当前有 ${n.moved} 条记录修改了顺序, 但并没有提交。请选择:`,A.createElement(`button`,{type:`button`,className:i(`Button Button--xs Button--success m-l-sm`),onClick:this.handleSaveOrder},A.createElement(u,{icon:`check`,className:`icon m-r-xs`}),`提交`),A.createElement(`button`,{type:`button`,className:i(`Button Button--xs Button--danger m-l-sm`),onClick:this.reset},A.createElement(u,{icon:`close`,className:`icon m-r-xs`}),`放弃`)):t?k(t,a):``):null},n.prototype.renderHeader=function(){var e=this.props,n=e.header,r=e.headerClassName;e.headerToolbar;var i=e.headerToolbarRender,a=e.showHeader,o=e.render,s=e.store,c=e.classnames,l=e.translate;if(a===!1)return null;var u=i?i(t(t({},this.props),s.eventContext),this.renderToolbar):null,d=this.renderActions(`header`),f=d||u||s.dragging?A.createElement(`div`,{className:c(`Cards-toolbar`),key:`header-toolbar`},d,u,s.dragging?A.createElement(`div`,{className:c(`Cards-dragTip`),ref:this.dragTipRef},l(`Card.dragTip`)):null):null,p=n?A.createElement(`div`,{className:c(`Cards-header`,r),key:`header`},o(`header`,n)):null;return p&&f?[p,f]:p||f||null},n.prototype.renderFooter=function(){var e=this.props,n=e.footer,r=e.footerClassName;e.footerToolbar;var i=e.footerToolbarRender,a=e.render,o=e.showFooter,s=e.store,c=e.classnames,l=e.affixFooter;if(o===!1)return null;var u=i?i(t(t({},this.props),s.eventContext),this.renderToolbar):null,d=this.renderActions(`footer`),f=n?A.createElement(`div`,{className:c(`Cards-footer`,r,l?`Cards-footer--affix`:``),key:`footer`},a(`footer`,n)):null,p=d||u?A.createElement(`div`,{className:c(`Cards-toolbar`,!f&&l?`Cards-footToolbar--affix`:``),key:`footer-toolbar`},d,u):null;return f&&p?[p,f]:f||p||null},n.prototype.renderCheckAll=function(){var e=this.props,t=e.store,n=e.multiple,r=e.selectable,i=e.checkAll;return!t.selectable||!n||!r||t.dragging||!t.items.length||!i?null:A.createElement(v,{key:`checkall`,tooltip:`切换全选`,onClick:this.handleCheckAll,size:`sm`,level:t.allChecked?`info`:`default`},`全选`)},n.prototype.renderDragToggler=function(){var e=this,t=this.props,n=t.store;t.multiple,t.selectable;var r=t.popOverContainer,i=t.env,a=t.translate,o=t.dragIcon;return!n.draggable||n.items.length<2?null:A.createElement(v,{iconOnly:!0,key:`dragging-toggle`,tooltip:a(`Card.toggleDrag`),tooltipContainer:r||i?.getModalContainer,size:`sm`,active:n.dragging,onClick:function(t){t.preventDefault(),n.toggleDragging(),n.dragging&&n.clear(),n.dragging&&e.initDragging()}},A.isValidElement(o)?o:A.createElement(u,{icon:`exchange`,className:`icon r90`}))},n.prototype.renderToolbar=function(e,t){var n=e.type||e;if(n===`drag-toggler`)return this.renderedToolbars.push(n),this.renderDragToggler();if(n===`check-all`)return this.renderedToolbars.push(n),this.renderCheckAll()},n.prototype.renderCard=function(e,n,r,a,o){var s=this,c=this.props,l=c.render,u=c.classnames,d=c.store,f=c.multiple,p=c.checkOnItemClick,m=c.hideCheckToggler,h={className:u(i(n&&n.className||``,r.locals),{"is-checked":r.checked,"is-modified":r.modified,"is-moved":r.moved,"is-dragging":d.dragging}),item:r,key:e,itemIndex:r.index,multiple:f,selectable:d.selectable,checkable:r.checkable,draggable:r.draggable,selected:r.checked,dragging:d.dragging,data:r.locals,onAction:this.handleAction,onCheck:this.handleCheck,onClick:this.handleClick,onQuickChange:d.dragging?null:this.handleQuickChange};return n?.type===`card2`&&(h=t(t({},h),{item:r.locals,onCheck:function(){s.handleCheck(r)}})),A.createElement(`div`,{key:r.index,className:u(a),style:o},l(`card/${e}`,t({type:n.type||`card`,hideCheckToggler:m,checkOnItemClick:p},n),h))},n.prototype.render=function(){var e=this,n=this.props,r=n.className,i=n.style,a=n.store,o=n.columnsCount,s=n.itemClassName,l=n.placeholder,u=n.card,d=n.data,f=n.render,p=n.affixHeader,m=n.masonryLayout,h=n.itemsClassName,g=n.classnames,_=n.translate,v=n.loading,y=v===void 0?!1:v,b=n.loadingConfig,x=n.env,S=n.id,E=n.wrapperCustomStyle,D=n.themeCss,k=n.mobileUI;this.renderedToolbars=[];var j=(function(){if(k&&!m)return s||``;if(m&&o){var e=Math.round(12/o);return`Grid-col--xs${e} Grid-col--sm${e} Grid-col--md${e} Grid-col--lg${e}`}return o?`Grid-col--sm${Math.round(12/o)}`:s||``})(),M=this.renderHeader(),N=this.renderHeading(),P=this.renderFooter(),F=``;m&&(F=`Cards--masonry `+j.split(/\s/).map(function(e){return/^Grid-col--(xs|sm|md|lg)(\d+)/.test(e)?`Cards--masonry${w(RegExp.$1)}${RegExp.$2}`:e}).join(` `));var I={},L={};return i?.gutterX>=0&&(I.marginLeft=I.marginRight=-(i?.gutterX/2)+`px`,L.paddingLeft=L.paddingRight=i?.gutterX/2+`px`),i?.gutterY>=0&&(L.marginBottom=i?.gutterY+`px`),A.createElement(`div`,{ref:this.bodyRef,className:g(`Cards`,r,{"Cards--unsaved":!!a.modified||!!a.moved},O(t(t({},this.props),{name:`baseControlClassName`,id:S,themeCss:D})),O(t(t({},this.props),{name:`wrapperCustomStyle`,id:S,themeCss:E}))),style:C(i,d)},p?A.createElement(`div`,{className:g(`Cards-fixedTop`)},M,N):A.createElement(A.default.Fragment,null,M,N),a.items.length?A.createElement(`div`,{className:g(`Cards-body Grid`,h,F),style:I},a.items.map(function(t,n){return e.renderCard(n,u,t,j,L)})):A.createElement(`div`,{className:g(`Cards-placeholder`)},f(`placeholder`,_(l))),P,A.createElement(c,{loadingConfig:b,overlay:!0,show:y}),A.createElement(T,t({},this.props,{config:{wrapperCustomStyle:E,id:S,themeCss:D,classNames:[{key:`baseControlClassName`}]},env:x})))},n.propsList=[`header`,`headerToolbarRender`,`footer`,`footerToolbarRender`,`placeholder`,`source`,`selectable`,`headerClassName`,`footerClassName`,`hideQuickSaveBtn`,`hideCheckToggler`,`itemCheckableOn`,`itemDraggableOn`,`masonryLayout`,`items`,`valueField`],n.defaultProps={className:``,placeholder:`placeholder.noData`,source:`$items`,selectable:!1,headerClassName:``,footerClassName:``,itemClassName:`Grid-col--xs12 Grid-col--sm6 Grid-col--md4 Grid-col--lg3`,hideCheckToggler:!1,masonryLayout:!1,affixHeader:!0,itemsClassName:``,checkAll:!0},n}(A.Component),P=function(e){h(t,e);function t(t,n){var r=e.call(this,t)||this;return n.registerComponent(r),r}return t.prototype.componentWillUnmount=function(){var t;(t=e.prototype.componentWillUnmount)==null||t.call(this),this.context.unRegisterComponent(this)},t.prototype.receive=function(e,t){var n,r,i=this.context;if((n=i?.parent)==null||n.getComponents(),this.props?.host)return(r=this.props.host).receive?.call(r,e,t);if(t)return i.send(t,e)},t.prototype.reload=function(e,t,n,r,i,a){var o;return x(this,void 0,void 0,function(){var r;return _(this,function(i){return this.props.store,a?.index||a?.condition?[2]:(r=this.context,this.props?.host?[2,(o=this.props.host).reload?.call(o,e,t,n)]:e?[2,r.reload(e,n)]:[2])})})},t.prototype.setData=function(e,t,n,r){var i;return x(this,void 0,void 0,function(){var a,o;return _(this,function(s){switch(s.label){case 0:return a=this.props.store,n!==void 0||r!==void 0?[4,m(a.items,this.props.data,n,r)]:[3,2];case 1:return o=s.sent(),o.forEach(function(t){t.updateData(e)}),[3,3];case 2:return this.props?.host?[2,(i=this.props.host).setData?.call(i,e,t,n,r)]:[2,a.updateData(e,void 0,t)];case 3:return[2]}})})},t.prototype.getData=function(){var e=this.props,t=e.store,n=e.data;return t.getData(n)},t.prototype.hasModifiedItems=function(){return this.props.store.modified},t.prototype.doAction=function(e,t,n,r){return x(this,void 0,void 0,function(){var n,i,a,o,s,c,l;return _(this,function(u){switch(u.label){case 0:switch(n=this.props,i=n.store,a=n.valueField,o=n.data,s=e?.actionType,c=s,c){case`selectAll`:return[3,1];case`clearAll`:return[3,2];case`select`:return[3,3];case`initDrag`:return[3,5];case`cancelDrag`:return[3,6];case`submitQuickEdit`:return[3,7]}return[3,9];case 1:return i.clear(),i.toggleAll(),this.syncSelected(),[3,10];case 2:return i.clear(),this.syncSelected(),[3,10];case 3:return[4,m(i.items,t||this.props.data,r.index,r.condition,r.selected)];case 4:return l=u.sent(),i.updateSelected(l.map(function(e){return e.data}),a),this.syncSelected(),[3,10];case 5:return i.startDragging(),[3,10];case 6:return i.stopDragging(),[3,10];case 7:return[4,this.handleSave()];case 8:return u.sent(),[3,10];case 9:return[2,this.handleAction(void 0,e,o)];case 10:return[2]}})})},t.contextType=S,t=p([E({name:`cards`,type:`cards`,storeType:n.name,weight:-100}),o(`design:paramtypes`,[Object,Object])],t),t}(N);export{P as CardsRenderer,N as default};