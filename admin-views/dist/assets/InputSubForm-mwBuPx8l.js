import{$o as e,Ao as t,Ci as n,En as r,Fo as i,Go as a,Hi as o,Kn as s,Ko as c,Mo as l,No as u,Oa as d,Pn as f,Ur as p,di as m,fr as h,ui as g}from"./index-DAdqRbKX.js";var _=e(c()),v=e(g()),y=e(m()),b=e(p()),x=a(),S,C=function(e){return e&&(S||=document.createElement(`div`),S.innerHTML=e,S.innerText)},w=function(e){u(a,e);function a(t){var n=e.call(this,t)||this;return n.state={},n.id=o(),n.addItem=n.addItem.bind(n),n.removeItem=n.removeItem.bind(n),n.editSingle=n.editSingle.bind(n),n.open=n.open.bind(n),n.close=n.close.bind(n),n.dragTipRef=n.dragTipRef.bind(n),n.handleDialogConfirm=n.handleDialogConfirm.bind(n),n}return a.prototype.addItem=function(){this.setState({dialogData:d(this.props.data,this.props.scaffold||{}),dialogCtx:{mode:`add`}})},a.prototype.removeItem=function(e){e.stopPropagation(),e.preventDefault();var t=parseInt(e.currentTarget.getAttribute(`data-index`),10),n=this.props.value;Array.isArray(n)&&(n=n.concat(),n.splice(t,1),this.props.onChange(n))},a.prototype.editSingle=function(){this.props.value?this.setState({dialogData:d(this.props.data,this.props.value),dialogCtx:{mode:`edit`}}):this.addItem()},a.prototype.open=function(e){var t=parseInt(e.currentTarget.getAttribute(`data-index`),10),n=this.props.value;!Array.isArray(n)||!n[t]||(this.tempValue=n[t],this.setState({dialogData:d(this.props.data,n[t]),dialogCtx:{mode:`edit`,index:t}}))},a.prototype.close=function(){this.setState({dialogData:void 0,dialogCtx:void 0})},a.prototype.handleDialogConfirm=function(e){var n=this.props,r=n.multiple,i=n.onChange,a=n.value,o=this.state.dialogCtx;if(r){var s=Array.isArray(a)?a.concat():[];o?.mode===`add`?s.push(t({},e[0])):s[o.index]=t(t({},s[o.index]),e[0]),i(s)}else i(t(t({},a),e[0]));this.close()},a.prototype.handlePopupConfirm=function(){var e=this.tempValue,n=this.props,r=n.multiple,i=n.onChange,a=n.value,o=this.state.dialogCtx;if(r){var s=Array.isArray(a)?a.concat():[];o?.mode===`add`?s.push(t({},e)):s[o.index]=t(t({},s[o.index]),e),i(s)}else i(t(t({},a),e));this.close()},a.prototype.dragTipRef=function(e){!this.dragTip&&e?this.initDragging():this.dragTip&&!e&&this.destroyDragging(),this.dragTip=e},a.prototype.initDragging=function(){var e=this,t=this.props.classPrefix,n=this.props.submitOnChange;this.sortable=new r((0,x.findDOMNode)(this).querySelector(`.${t}SubForm-values`),{group:`SubForm-${this.id}`,animation:150,handle:`.${t}SubForm-valueDragBar`,ghostClass:`${t}SubForm-value--dragging`,onEnd:function(t){if(t.newIndex!==t.oldIndex){var r=t.to;t.oldIndex<r.childNodes.length-1?r.insertBefore(t.item,r.childNodes[t.oldIndex>t.newIndex?t.oldIndex+1:t.oldIndex]):r.appendChild(t.item);var i=e.props.value;if(Array.isArray(i)){var a=i.concat();a.splice(t.newIndex,0,a.splice(t.oldIndex,1)[0]),e.props.onChange(a,n,!0)}}}})},a.prototype.destroyDragging=function(){this.sortable&&this.sortable.destroy()},a.prototype.buildDialogSchema=function(){var e=this.props.form,n=[`title`,`actions`,`name`,`size`,`closeOnEsc`,`closeOnOutside`,`showErrorMsg`,`showCloseButton`,`bodyClassName`,`type`];return t(t({},(0,b.default)(e,n)),{type:`dialog`,body:t(t({type:`form`,canAccessSuperData:!1},(0,y.default)(e,n)),{inheritData:!1})})},a.prototype.buildFormSchema=function(){var e=this.props.form;return t(t({type:`form`,canAccessSuperData:!1},(0,y.default)(e,[`title`,`actions`,`name`,`size`,`closeOnEsc`,`closeOnOutside`,`showErrorMsg`,`showCloseButton`,`bodyClassName`,`type`])),{inheritData:!1})},a.prototype.renderMultipe=function(){var e=this,n=this.props,r=n.addButtonClassName,i=n.itemClassName,a=n.itemsClassName,o=n.disabled,c=n.maxLength,l=n.labelField,u=n.defaultLabel,f=n.value,p=n.btnLabel,m=n.render,h=n.data,g=n.translate,v=n.classnames,y=n.placeholder,b=n.draggable,x=n.draggableTip,S=n.addable,w=n.removable,T=n.minLength,E=n.addButtonText,D=n.testIdBuilder;return _.createElement(_.default.Fragment,null,Array.isArray(f)&&f.length?_.createElement(`div`,{className:v(`SubForm-values`,a),key:`values`},f.map(function(n,r){return _.createElement(`div`,t({className:v(`SubForm-value`,{"is-disabled":o},i),key:r},D?.getChild(`item-${r}`).getTestId()),b&&f.length>1?_.createElement(`a`,{className:v(`SubForm-valueDragBar`)},_.createElement(s,{icon:`drag-bar`,className:v(`icon`)})):null,_.createElement(`span`,{className:v(`SubForm-valueLabel`)},p&&m(`label`,{type:`tpl`,tpl:g(p)},{data:d(h,n)}),!p&&(n&&l&&n[l]&&C(n[l])||g(u))),_.createElement(`a`,{"data-index":r,onClick:e.open,className:v(`SubForm-valueEdit`)},_.createElement(s,{icon:`pencil`,className:`icon`})),!o&&w!==!1&&(!T||f.length>T)?_.createElement(`a`,{"data-index":r,className:v(`SubForm-valueDel`),onClick:e.removeItem},_.createElement(s,{icon:`close`,className:`icon`})):null)})):_.createElement(`div`,{className:v(`SubForm-placeholder`),key:`placeholder`},g(y||`placeholder.empty`)),_.createElement(`div`,{key:`toolbar`,className:v(`SubForm-toolbar`)},S===!1?null:_.createElement(`button`,t({type:`button`,onClick:this.addItem,className:v(`Button SubForm-addBtn`,r),disabled:o||!!(c&&Array.isArray(f)&&f.length>=c)},D?.getChild(`add-button`).getTestId()),_.createElement(s,{icon:`plus`,className:`icon`}),_.createElement(`span`,null,g(E||`SubForm.add`))),b&&Array.isArray(f)&&f.length>1?_.createElement(`span`,{className:v(`Combo-dragableTip`),ref:this.dragTipRef},Array.isArray(f)&&f.length>1?g(x):``):null))},a.prototype.renderSingle=function(){var e=this.props,n=e.classnames,r=e.itemsClassName,i=e.itemClassName,a=e.disabled,o=e.value,c=e.labelField,l=e.defaultLabel,u=e.btnLabel,f=e.render,p=e.data,m=e.translate,h=e.testIdBuilder?.getChild(`edit-single`);return _.createElement(`div`,{className:n(`SubForm-values`,r),key:`values`},_.createElement(`div`,t({className:n(`SubForm-value`,{"is-disabled":a},i),onClick:this.editSingle,"data-tooltip":m(`SubForm.editDetail`),"data-position":`bottom`},h?.getTestId()),_.createElement(`span`,{className:n(`SubForm-valueLabel`)},u&&f(`label`,{type:`tpl`,tpl:m(u)},{data:d(p,o)}),!u&&(o&&c&&o[c]&&C(o[c])||m(l))),_.createElement(`a`,t({className:n(`SubForm-valueEdit`)},h?.getChild(`icon`).getTestId()),_.createElement(s,{icon:`pencil`,className:`icon`}))))},a.prototype.render=function(){var e=this,t=this.props,n=t.multiple,r=t.classPrefix,i=t.className;t.style;var a=t.render,o=t.mobileUI,s=t.env,c=t.popOverContainer,l=this.state.dialogData,u=this.state.dialogCtx;return _.createElement(`div`,{className:(0,v.default)(`${r}SubFormControl`,i)},n?this.renderMultipe():this.renderSingle(),o?_.createElement(f,{isShow:!!u,showConfirm:!0,onConfirm:this.handlePopupConfirm,onHide:this.close,container:o?s?.getModalContainer:c||s.getModalContainer},_.createElement(`div`,{className:`flex-1 pl-10 pr-10`},a(`form`,this.buildFormSchema(),{data:l,formStore:void 0,wrapWithPanel:!1,onChange:function(t){e.tempValue=t}}))):a(`modal`,this.buildDialogSchema(),{show:!!u,onClose:this.close,onConfirm:this.handleDialogConfirm,data:l,formStore:void 0}))},a.defaultProps={minLength:0,maxLength:0,multiple:!1,btnClassName:``,addButtonClassName:``,itemClassName:``,labelField:`label`,defaultLabel:`SubForm.button`,placeholder:`placeholder.empty`},a.propsList=[`form`,`formStore`],l([n,i(`design:type`,Function),i(`design:paramtypes`,[]),i(`design:returntype`,void 0)],a.prototype,`handlePopupConfirm`,null),a}(_.PureComponent),T=function(e){u(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t=l([h({type:`input-sub-form`,sizeMutable:!1,strictMode:!1})],t),t}(w);export{T as SubFormControlRenderer,w as default};