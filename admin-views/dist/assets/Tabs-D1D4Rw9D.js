import{t as me,bk as ge,aM as D,x,aK as ne,a$ as Ce,z as y,am as ie,av as Ke,aZ as ce,a5 as j,G as q,H as G,dk as Ee,L as ue,l as b,ad as U,a4 as he,aw as ve,cq as pe,a6 as P,ae as oe,cp as Ne,D as T,Q as g,T as c,U as Se,E as Ae,ah as ye,cr as _e}from"./index-CG72qQQo.js";var we=function(M){me(l,M);function l(e){var t=M.call(this,e)||this;t.newTabDefaultId=3,t.lazySwitchTo=ge(t.switchTo.bind(t),250,{leading:!0,trailing:!1});var a=e.location||window.location,n=e.tabs,i=e.source,r=e.data,o=0;if(typeof e.activeKey<"u")o=e.activeKey;else if(a&&Array.isArray(n)){var h=a.hash.substring(1),u=D(n,function(N){return N.hash===h});u?o=u.hash:e.defaultKey!==void 0?o=typeof e.defaultKey=="string"?x(e.defaultKey,e.data):e.defaultKey:e.defaultActiveKey&&(o=typeof e.defaultActiveKey=="string"?x(e.defaultActiveKey,e.data):e.defaultActiveKey),o=o||n[0]&&n[0].hash||0}var p=ne(t.initTabArray(n,i,r),2),v=p[0],C=p[1];return t.state={prevKey:void 0,activeKey:t.activeKey=o,localTabs:v,isFromSource:C},t}return l.prototype.initTabArray=function(e,t,a){if(!e)return[[],!1];var n=x(t,a,"| raw");if(!Array.isArray(n))return[e,!1];e=Array.isArray(e)?e:[e];var i=[];return n.forEach(function(r){i.push.apply(i,Ce([],ne(e.map(function(o){return y(y({},o),{data:r})})),!1))}),[i,!0]},l.prototype.componentDidMount=function(){var e,t;this.autoJumpToNeighbour(this.activeKey);var a=this.props,n=a.name,i=a.value,r=a.onChange,o=a.source;a.tabs;var h=a.data,u=this.state.localTabs;if(!(!n||typeof r!="function"||o))if(i=i??ie(h,n),i&&Array.isArray(u)){var p=this.resolveKeyByValue(i);p!==void 0&&this.handleSelect(p)}else{var v=this.resolveTabByKey(this.activeKey);v&&i!==((e=v.value)!==null&&e!==void 0?e:v.title)&&r((t=v.value)!==null&&t!==void 0?t:v.title,n)}},l.prototype.componentDidUpdate=function(e,t){var a,n,i,r=this.props,o=this.state.localTabs,h=x(e.defaultActiveKey,e.data),u=x(r.defaultActiveKey,r.data),p=Ke({tabs:r.tabs,source:x(r.source,r.data,"| raw")},{tabs:e.tabs,source:x(e.source,e.data,"| raw")},!1);if(p){var v=ne(this.initTabArray(r.tabs,r.source,r.data),2),C=v[0],N=v[1];this.setState({localTabs:C,isFromSource:N}),o=C}if(r.location&&e.location&&r.location.hash!==e.location.hash){var _=r.location.hash.substring(1);if(!_)return;var m=D(o,function(I){return I.hash===_});m&&m.hash&&m.hash!==this.state.activeKey&&this.setState({activeKey:this.activeKey=m.hash,prevKey:this.state.activeKey})}else if(Array.isArray(o)&&Array.isArray(t.localTabs)&&JSON.stringify(o.map(function(I){return I.hash}))!==JSON.stringify(t.localTabs.map(function(I){return I.hash}))){var S=this.state.activeKey,H=r.location,m=null;if(H&&Array.isArray(o)){var R=H.hash.substring(1);m=D(o,function(A){return A.hash===R})}m?S=m.hash:(!o||!o.some(function(A,X){return A.hash?A.hash===S:X===S}))&&(S=o&&o[0]&&o[0].hash||0),this.setState({prevKey:void 0,activeKey:this.activeKey=S})}else if(h!==u){if(u==null)return;var w=null,m=D(o,function(A){return A.hash===u});m?w=m.hash:typeof u=="number"&&o[u]&&(w=u),w!==null&&this.setState({prevKey:h,activeKey:this.activeKey=w})}this.autoJumpToNeighbour(this.activeKey);var O=this.props,k=O.name,K=O.value,J=O.onChange,Q=O.source,Z=O.data;if(!(!k||typeof J!="function"||Q)){var V;K=K??ie(Z,k);var $=(a=e.value)!==null&&a!==void 0?a:ie(e.data,e.name);if(K!==$&&(V=this.resolveKeyByValue(K))!==void 0&&V!==this.activeKey)this.handleSelect(V);else if(this.activeKey!==t.activeKey){var m=this.resolveTabByKey(this.activeKey);m&&K!==((n=m.value)!==null&&n!==void 0?n:m.title)&&J((i=m.value)!==null&&i!==void 0?i:m.title,k)}}},l.prototype.componentWillUnmount=function(){this.lazySwitchTo.cancel()},l.prototype.resolveTabByKey=function(e){var t=this.state.localTabs;if(Array.isArray(t))return D(t,function(a,n){return a.hash?a.hash===e:n===e})},l.prototype.resolveKeyByValue=function(e){var t=this.state.localTabs;if(Array.isArray(t)){var a=D(t,function(n){var i;return((i=n.value)!==null&&i!==void 0?i:n.title)===e});return a&&a.hash?a.hash:t.indexOf(a)}},l.prototype.autoJumpToNeighbour=function(e){var t=this.props;t.tabs;var a=t.data,n=this.state.localTabs;if(Array.isArray(n)){var i=ce(n,function(p,v){return p.hash?p.hash===e:v===e});if(n[i]&&!j(n[i],this.props.data))for(var r=n.length,o=i,h=i;o-->=0||h++<r;){var u=null;if(o>=0&&j(n[o],a)?u=n[o].hash||o:h<r&&j(n[h],a)&&(u=n[h].hash||h),u!==null){this.setState({activeKey:this.activeKey=u});break}}}},l.prototype.handleAdd=function(){var e=this,t=this.state.localTabs.concat();t.push({title:"tab".concat(this.newTabDefaultId++),body:"tab"}),this.setState({localTabs:t},function(){e.switchTo(e.state.localTabs.length-1)})},l.prototype.handleClose=function(e,t){return q(this,void 0,void 0,function(){var a,n,i,r;return G(this,function(o){switch(o.label){case 0:return a=this.state.localTabs.concat(),n=a==null?void 0:a.findIndex(function(h,u){var p;return e===(t?h.hash:(p=h.hash)!==null&&p!==void 0?p:u)}),n===-1?[2]:(a.splice(n,1),i=this.props.dispatchEvent,[4,i("delete",ye(this.props,{value:e}))]);case 1:return r=o.sent(),r!=null&&r.prevented?[2]:(this.setState({localTabs:a}),[2])}})})},l.prototype.handleEdit=function(e,t){var a=this.state.localTabs.concat();a[e].title=t,this.setState({localTabs:a})},l.prototype.handleDragChange=function(e){return q(this,void 0,void 0,function(){var t,a,n=this;return G(this,function(i){return t=this.resolveTabByKey(this.activeKey),a=this.state.localTabs.concat(),a.splice(e.newIndex,0,a.splice(e.oldIndex,1)[0]),this.setState({localTabs:a},function(){if(t){var r=a.indexOf(t);n.switchTo(r)}}),[2]})})},l.prototype.handleSelect=function(e){var t;return q(this,void 0,void 0,function(){var a,n,i,r,o,h,u,p,v;return G(this,function(C){switch(C.label){case 0:return a=this.props,n=a.dispatchEvent,a.data,i=a.env,r=a.onSelect,o=a.id,h=this.state.localTabs,u=h==null?void 0:h.find(function(N,_){return e===(N.hash?N.hash:_)}),u?((t=i.tracker)===null||t===void 0||t.call(i,{eventType:"tabChange",eventData:{id:o,key:e}}),[4,n("change",ye(this.props,{value:u!=null&&u.hash?u==null?void 0:u.hash:e+1}))]):[2];case 1:return p=C.sent(),p!=null&&p.prevented?[2]:(typeof e=="string"&&i?i.updateLocation("#".concat(e)):typeof this.state.activeKey=="string"&&i&&i.updateLocation("#"),this.setState({activeKey:this.activeKey=e,prevKey:this.state.activeKey}),typeof r=="string"?(v=_e(r,"key","props"),v&&v(e,this.props)):typeof r=="function"&&r(e,this.props),[2])}})})},l.prototype.doAction=function(e,t,a,n){var i=e==null?void 0:e.actionType,r=Number(n==null?void 0:n.activeKey),o=Ee(r)?n==null?void 0:n.activeKey:r,h=n==null?void 0:n.deleteHash;i==="changeActiveKey"?this.handleSelect(typeof o=="number"?o-1:o):i==="deleteTab"&&this.handleClose(h,!0)},l.prototype.switchTo=function(e,t){var a=this.state.localTabs;Array.isArray(a)&&a[e]&&this.setState({activeKey:this.activeKey=a[e].hash||e},t)},l.prototype.currentIndex=function(){var e=this,t=this.state.localTabs;return Array.isArray(t)?ce(t,function(a,n){return a.hash?a.hash===e.state.activeKey:n===e.state.activeKey}):-1},l.prototype.dispatchEvent=function(e,t,a,n){return q(this,void 0,void 0,function(){var i;return G(this,function(r){return e==="formItemValidateError"&&(i=a==null?void 0:a.props.tabIndex,typeof i=="number"&&this.lazySwitchTo(i)),[2,this.props.dispatchEvent(e,t,a,n)]})})},l.prototype.renderTabTitle=function(e,t,a){var n=this.props.render;return typeof e=="string"||!e?ue(e,a):n("tab-title/".concat(t),e,{data:y({index:t,__index:t},a)})},l.prototype.renderToolbar=function(){var e=this.props,t=e.toolbar,a=e.render,n=e.classnames,i=e.toolbarClassName,r=e.id,o=e.themeCss;return t?b.createElement("div",{className:n("Tabs-toolbar",i,U(y(y({},this.props),{name:"toolbarControlClassName",id:r,themeCss:o})))},a("toolbar",t)):null},l.prototype.renderTabs=function(){var e=this,t=this.props,a=t.classnames,n=t.classPrefix,i=t.contentClassName,r=t.linksClassName,o=t.tabRender,h=t.className,u=t.style,p=t.render,v=t.data,C=t.mode,N=t.tabsMode,_=t.unmountOnExit;t.source;var m=t.formStore,S=t.formMode,H=t.formHorizontal,R=t.subFormMode,w=t.subFormHorizontal,O=t.addable,k=t.closable,K=t.draggable,J=t.showTip,Q=t.showTipClassName,Z=t.editable,V=t.sidePosition,$=t.translate,I=t.addBtnText,A=t.collapseOnExceed,X=t.collapseBtnLabel,L=t.disabled,Y=t.mobileUI,re=t.swipeable,F=t.testIdBuilder,W=t.id,le=t.wrapperCustomStyle,ee=t.themeCss,fe=t.env,be=N||C,te=this.props.mountOnEnter;m&&(te=!1);var de=this.state,f=de.localTabs,Te=de.isFromSource,ae=[],se=[];return Te?(ae=f.map(function(s,d){var E,B,z=he(v,ve(s.data)?y({index:d},s.data):{item:s.data,index:d});return j(s,z)?b.createElement(pe,y({},s,{title:e.renderTabTitle(s.title,d,z),disabled:L||P(s,z),key:d,eventKey:ue(s.hash,z)||d,prevKey:d>0?((E=f[d-1])===null||E===void 0?void 0:E.hash)||d-1:0,nextKey:d<f.length-1?((B=f[d+1])===null||B===void 0?void 0:B.hash)||d+1:f.length-1,swipeable:re,mobileUI:Y,mountOnEnter:te,unmountOnExit:typeof s.reload=="boolean"?s.reload:typeof s.unmountOnExit=="boolean"?s.unmountOnExit:_,onSelect:e.handleSelect,testIdBuilder:F==null?void 0:F.getChild("tab-".concat(typeof s.title=="string"?s.title:d)),className:a(s.className,U(y(y({},s),{name:"panelControlClassName",id:s.id,themeCss:s.themeCss})))}),p("item/".concat(d),s!=null&&s.type?s:s.tab||s.body,{tabIndex:d,dispatchEvent:e.dispatchEvent,disabled:L||P(s,z)||void 0,data:z,formMode:s.mode||R||S,formHorizontal:s.horizontal||w||H})):null}),se=f.map(function(s,d){var E=he(v,ve(s.data)?y({index:d},s.data):{item:s.data,index:d});return j(s,E)?b.createElement(oe,y({},s,{config:{id:s.id,themeCss:s.themeCss,classNames:[{key:"panelControlClassName"}]},env:e.props.env,key:"customstyle_".concat(d)})):null})):(ae=f.map(function(s,d){var E,B;return j(s,v)?b.createElement(pe,y({},s,{title:e.renderTabTitle(s.title,d,v),disabled:L||P(s,v),key:d,eventKey:s.hash||d,prevKey:d>0?((E=f[d-1])===null||E===void 0?void 0:E.hash)||d-1:0,nextKey:d<f.length-1?((B=f[d+1])===null||B===void 0?void 0:B.hash)||d+1:f.length-1,swipeable:re,mobileUI:Y,mountOnEnter:te,unmountOnExit:typeof s.reload=="boolean"?s.reload:typeof s.unmountOnExit=="boolean"?s.unmountOnExit:_,onSelect:e.handleSelect,testIdBuilder:F==null?void 0:F.getChild("tab-".concat(typeof s.title=="string"?s.title:d)),className:a(s.className,U(y(y({},s),{name:"panelControlClassName",id:s.id,themeCss:s.themeCss})))}),e.renderTab?e.renderTab(s,e.props,d):o?o(s,e.props,d):p("tab/".concat(d),s!=null&&s.type?s:s.tab||s.body,{tabIndex:d,dispatchEvent:e.dispatchEvent,disabled:L||P(s,v)||void 0,formMode:s.mode||R||S,formHorizontal:s.horizontal||w||H})):null}),se=f.map(function(s,d){return j(s,v)?b.createElement(oe,{config:{id:s.id,themeCss:s.themeCss,classNames:[{key:"panelControlClassName"}]},env:e.props.env,key:"customstyle_".concat(d)}):null})),b.createElement(b.Fragment,null,b.createElement(Ne,{addBtnText:$(I||"add"),classPrefix:n,classnames:a,mode:be,closable:k,className:a(h,U(y(y({},this.props),{name:"wrapperCustomStyle",id:W,themeCss:le}))),style:u,contentClassName:a(i,U(y(y({},this.props),{name:"contentControlClassName",id:W,themeCss:ee}))),linksClassName:r,titleClassName:a(U(y(y({},this.props),{name:"titleControlClassName",id:W,themeCss:ee}))),onSelect:this.handleSelect,activeKey:this.state.activeKey,toolbar:this.renderToolbar(),addable:O,onAdd:this.handleAdd,onClose:this.handleClose,draggable:K,onDragChange:this.handleDragChange,showTip:J,showTipClassName:Q,editable:Z,onEdit:this.handleEdit,sidePosition:V,collapseOnExceed:A,collapseBtnLabel:X,mobileUI:Y,testIdBuilder:F},ae),se,b.createElement(oe,y({},this.props,{config:{wrapperCustomStyle:le,id:W,themeCss:ee,classNames:[{key:"titleControlClassName",weights:{default:{important:!0,inner:"> a"},focused:{important:!0,suf:".is-active",inner:"> a"},hover:{important:!0,inner:"> a"},disabled:{important:!0,suf:".is-disabled",inner:"> a"}}},{key:"toolbarControlClassName",weights:{default:{important:!0}}},{key:"contentControlClassName",weights:{default:{important:!0}}}]},env:fe})))},l.prototype.render=function(){return this.renderTabs()},l.defaultProps={className:"",mode:"",mountOnEnter:!0,unmountOnExit:!1},T([g,c("design:type",Function),c("design:paramtypes",[Array,String,Object]),c("design:returntype",Array)],l.prototype,"initTabArray",null),T([g,c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",void 0)],l.prototype,"autoJumpToNeighbour",null),T([g,c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",void 0)],l.prototype,"handleAdd",null),T([g,c("design:type",Function),c("design:paramtypes",[Object,Boolean]),c("design:returntype",Promise)],l.prototype,"handleClose",null),T([g,c("design:type",Function),c("design:paramtypes",[Number,String]),c("design:returntype",void 0)],l.prototype,"handleEdit",null),T([g,c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",Promise)],l.prototype,"handleDragChange",null),T([g,c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",Promise)],l.prototype,"handleSelect",null),T([g,c("design:type",Function),c("design:paramtypes",[Number,Function]),c("design:returntype",void 0)],l.prototype,"switchTo",null),T([g,c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",Number)],l.prototype,"currentIndex",null),T([g,c("design:type",Function),c("design:paramtypes",[Object,Object,b.Component,Object]),c("design:returntype",Promise)],l.prototype,"dispatchEvent",null),l}(b.Component),Ie=function(M){me(l,M);function l(e,t){var a=M.call(this,e)||this,n=t;return n.registerComponent(a),a}return l.prototype.componentWillUnmount=function(){var e;(e=M.prototype.componentWillUnmount)===null||e===void 0||e.call(this);var t=this.context;t.unRegisterComponent(this)},l.contextType=Se,l=T([Ae({type:"tabs"}),c("design:paramtypes",[Object,Object])],l),l}(we);export{Ie as TabsRenderer,we as default};
