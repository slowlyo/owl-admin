const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CIkDC_Pr.js","assets/index-CG72qQQo.js","assets/index-BBn-9_NT.css","assets/index-C9DuXPTk.js","assets/index-DVK099C8.js","assets/bmap-aUnw2Cn1.js","assets/echarts-wordcloud-DT2I378B.js"])))=>i.map(i=>d[i]);
import{t as __extends,bk as debounce,G as __awaiter,H as __generator,W as isApiOutdated,w as isPureVariable,x as resolveVariableAndFilter,L as filter,a4 as createObject,z as __assign,aJ as pick,_ as __vitePreload,aK as __read,co as dataMapping,aS as isAlive,b6 as buildStyle,l as React__default,ag as cx,ad as setThemeClassName,dB as themedLazyComponent,ae as CustomStyle,U as ScopedContext,D as __decorate,E as Renderer,df as ServiceStore,T as __metadata,dC as findObjectsWithKey,bE as __values,an as str2function,dD as resizeSensor,dE as loadScript,ds as normalizeApiResponseData,ba as isString,Y as isEffectiveApi}from"./index-CG72qQQo.js";var DEFAULT_EVENT_PARAMS=["componentType","seriesType","seriesIndex","seriesName","name","dataIndex","data","dataType","value","color"],EVAL_CACHE={};function recoverFunctionType(config){["interval","formatter","color","min","max","labelFormatter","valueFormatter","pageFormatter","optionToContent","contentToOption","animationDelay","animationDurationUpdate","animationDelayUpdate","animationDuration","position","sort","renderItem"].forEach(function(key){var e_1,_a,objects=findObjectsWithKey(config,key);try{for(var objects_1=__values(objects),objects_1_1=objects_1.next();!objects_1_1.done;objects_1_1=objects_1.next()){var object=objects_1_1.value,code=object[key];if(typeof code=="string"&&code.trim().startsWith("function"))try{code in EVAL_CACHE||(EVAL_CACHE[code]=eval("("+code+")")),object[key]=EVAL_CACHE[code]}catch(m){console.warn(code,m)}}}catch(m){e_1={error:m}}finally{try{objects_1_1&&!objects_1_1.done&&(_a=objects_1.return)&&_a.call(objects_1)}finally{if(e_1)throw e_1.error}}})}var Chart=function(m){__extends(d,m);function d(t){var e=m.call(this,t)||this;return e.refFn=e.refFn.bind(e),e.reload=e.reload.bind(e),e.reloadEcharts=debounce(e.reloadEcharts.bind(e),300),e.handleClick=e.handleClick.bind(e),e.dispatchEvent=e.dispatchEvent.bind(e),e.loadChartMapData=e.loadChartMapData.bind(e),e.mounted=!0,t.config&&e.renderChart(t.config),e}return d.prototype.componentDidMount=function(){return __awaiter(this,void 0,void 0,function(){var t,e,a,r,s,i,n,o;return __generator(this,function(l){switch(l.label){case 0:return t=this.props,e=t.api,a=t.data,r=t.initFetch,s=t.source,i=t.dispatchEvent,[4,i("init",a,this)];case 1:return n=l.sent(),n!=null&&n.prevented?[2]:(s&&isPureVariable(s)?(o=resolveVariableAndFilter(s,a,"| raw"),o&&this.renderChart(o)):e&&r!==!1&&this.reload(),[2])}})})},d.prototype.componentDidUpdate=function(t){var e=this,a=this.props;if(isApiOutdated(t.api,a.api,t.data,a.data))this.reload();else if(a.source&&isPureVariable(a.source)){var r=t.source?resolveVariableAndFilter(t.source,t.data,"| raw"):null,s=resolveVariableAndFilter(a.source,a.data,"| raw");r!==s&&this.renderChart(s||{})}else if(a.config!==t.config)this.renderChart(a.config||{});else if(a.config&&a.trackExpression&&filter(a.trackExpression,a.data)!==filter(t.trackExpression,t.data))this.renderChart(a.config||{});else if(isApiOutdated(t.mapURL,a.mapURL,t.data,a.data)){var i=a.source,n=a.data,o=a.api,l=a.config;this.loadChartMapData(function(){if(i&&isPureVariable(i)){var v=resolveVariableAndFilter(i,n,"| raw");v&&e.renderChart(v)}else o?e.reload():l&&e.renderChart(l||{})})}},d.prototype.componentWillUnmount=function(){this.mounted=!1,this.reloadEcharts.cancel(),clearTimeout(this.timer)},d.prototype.loadChartMapData=function(t){return __awaiter(this,void 0,void 0,function(){var e,a,r,s,i,n,o;return __generator(this,function(l){switch(l.label){case 0:return e=this.props,a=e.env,r=e.data,s=this.props,i=s.mapName,n=s.mapURL,n&&i&&window.echarts?(isPureVariable(i)&&(i=resolveVariableAndFilter(i,r)),[4,a.fetcher(n,r)]):[3,2];case 1:o=l.sent(),o.ok||console.warn("fetch map geo error "+n),window.echarts.registerMap(i,o.data),l.label=2;case 2:return t&&t(),[2]}})})},d.prototype.handleClick=function(t){return __awaiter(this,void 0,void 0,function(){var e,a,r,s,i,n;return __generator(this,function(o){switch(o.label){case 0:return e=this.props,a=e.onAction,r=e.clickAction,s=e.data,i=e.dispatchEvent,[4,i(t.event,createObject(s,__assign({},pick(t,DEFAULT_EVENT_PARAMS))))];case 1:return n=o.sent(),n!=null&&n.prevented?[2]:(r&&a&&a(null,r,createObject(s,t)),[2])}})})},d.prototype.dispatchEvent=function(t){var e=this.props,a=e.data,r=e.dispatchEvent;r(t.event||t.type,createObject(a,__assign({},pick(t,t.type==="legendselectchanged"?["name","selected"]:DEFAULT_EVENT_PARAMS))))},d.prototype.refFn=function(t){var e=this,a=this.props.chartRef,r=this.props,s=r.chartTheme,i=r.onChartWillMount,n=r.onChartUnMount,o=r.env,l=r.loadBaiduMap;r.data;var v=this.props,b=v.mapURL,C=v.mapName,c=this.props.onChartMount||this.onChartMount;t?Promise.all([__vitePreload(()=>import("./index-DVK099C8.js").then(h=>h.i),[]),__vitePreload(()=>import("./index-CIkDC_Pr.js").then(h=>h.i),__vite__mapDeps([0,1,2])),__vitePreload(()=>import("./index-C9DuXPTk.js"),__vite__mapDeps([3,4])),__vitePreload(()=>import("./bmap-aUnw2Cn1.js"),__vite__mapDeps([5,4])),__vitePreload(()=>import("./echarts-wordcloud-DT2I378B.js").then(h=>h.e),__vite__mapDeps([6,1,2]))]).then(function(h){var _=__read(h,2),f=_[0],p=_[1];return __awaiter(e,void 0,void 0,function(){var g,w=this;return __generator(this,function(u){switch(u.label){case 0:return window.echarts=f,window.ecStat=(p==null?void 0:p.default)||p,b&&C?[4,this.loadChartMapData()]:[3,2];case 1:u.sent(),u.label=2;case 2:return l?[4,loadScript("//api.map.baidu.com/api?v=3.0&ak=".concat(this.props.ak,"&callback={{callback}}"))]:[3,4];case 3:u.sent(),u.label=4;case 4:return g="default",s&&(f.registerTheme("custom",s),g="custom"),i?[4,i(f)]:[3,6];case 5:u.sent(),u.label=6;case 6:return p.transform&&(f.registerTransform(p.transform.regression),f.registerTransform(p.transform.histogram),f.registerTransform(p.transform.clustering)),o.loadChartExtends?[4,o.loadChartExtends()]:[3,8];case 7:u.sent(),u.label=8;case 8:return this.echarts=f.init(t,g),typeof c=="string"&&(c=str2function(c,"chart","echarts")),c==null||c(this.echarts,f),this.echarts.on("click",this.handleClick),this.echarts.on("mouseover",this.dispatchEvent),this.echarts.on("legendselectchanged",this.dispatchEvent),this.unSensor=resizeSensor(t,function(){var y,A=t.offsetWidth,E=t.offsetHeight;(y=w.echarts)===null||y===void 0||y.resize({width:A,height:E})}),a&&a(this.echarts),this.renderChart(),[2]}})})}):(a&&a(null),this.unSensor&&this.unSensor(),this.echarts&&(n==null||n(this.echarts,window.echarts),this.echarts.dispose(),delete this.echarts)),this.ref=t},d.prototype.doAction=function(t,e,a){var r,s;return(s=(r=this.echarts)===null||r===void 0?void 0:r.dispatchAction)===null||s===void 0?void 0:s.call(r,__assign({type:t.actionType},e))},d.prototype.reload=function(t,e,a,r,s){var i,n,o,l,v,b;return __awaiter(this,void 0,void 0,function(){var C,c,h,_,f,p,g,w,u,y,A=this;return __generator(this,function(E){switch(E.label){case 0:if(C=this.props,c=C.api,h=C.env,_=C.store,f=C.translate,e)return[2,this.receive(e,void 0,s)];if(!h||!h.fetcher||!isEffectiveApi(c,_.data))return[2];clearTimeout(this.timer),this.reloadCancel&&(this.reloadCancel(),delete this.reloadCancel,(i=this.echarts)===null||i===void 0||i.hideLoading()),(n=this.echarts)===null||n===void 0||n.showLoading(),_.markFetching(!0),E.label=1;case 1:return E.trys.push([1,3,,4]),[4,h.fetcher(c,_.data,{cancelExecutor:function(T){return A.reloadCancel=T}})];case 2:return p=E.sent(),isAlive(_)&&_.markFetching(!1),p.ok?(delete this.reloadCancel,g=normalizeApiResponseData(p.data),!g.series&&this.props.config?(w=createObject(this.props.data,g),this.renderChart(this.props.config,w)):this.renderChart(p.data||{}),(v=this.echarts)===null||v===void 0||v.hideLoading(),u=this.props.interval,u&&isString(u)&&(u=Number.parseInt(u)),u&&this.mounted&&(this.timer=setTimeout(this.reload,Math.max(u,1e3))),[2,_.data]):(!(c!=null&&c.silent)&&h.notify("error",(l=(o=c==null?void 0:c.messages)===null||o===void 0?void 0:o.failed)!==null&&l!==void 0?l:p.msg||f("fetchFailed"),p.msgTimeout!==void 0?{closeButton:!0,timeout:p.msgTimeout}:void 0),[2]);case 3:return y=E.sent(),h.isCancel(y)?[2]:(isAlive(_)&&_.markFetching(!1),!(c!=null&&c.silent)&&h.notify("error",y),(b=this.echarts)===null||b===void 0||b.hideLoading(),[3,4]);case 4:return[2]}})})},d.prototype.receive=function(t,e,a){var r=this.props.store;r.updateData(t,void 0,a),this.reload()},d.prototype.renderChart=function(t,e){var a,r;if(t&&(this.pending=t),e&&(this.pendingCtx=e),!!this.echarts){var s=this.props.store,i=this.props.onDataFilter,n=this.props.dataFilter;!i&&typeof n=="string"&&(i=new Function("config","echarts","data",n)),t=t||this.pending,e=e||this.pendingCtx||this.props.data,typeof t=="string"&&(t=new Function("return "+t)());try{i&&(t=i(t,window.echarts,e)||t)}catch(o){console.warn(o)}if(t)try{this.props.disableDataMapping||(t=dataMapping(t,e,function(o,l){return typeof l=="function"||typeof l=="string"&&l.startsWith("function")})),recoverFunctionType(t),isAlive(s)&&s.loading?(a=this.echarts)===null||a===void 0||a.showLoading():(r=this.echarts)===null||r===void 0||r.hideLoading(),this.reloadEcharts(t)}catch(o){console.warn(o)}}},d.prototype.reloadEcharts=function(t){var e=this,a;(a=this.echarts)===null||a===void 0||a.setOption(t,this.props.replaceChartOption),this.echarts.on("finished",function(){return __awaiter(e,void 0,void 0,function(){var r,s,i,n;return __generator(this,function(o){switch(o.label){case 0:return r=this.props,s=r.data,i=r.dispatchEvent,[4,i("finished",createObject(s,{},{echarts:{value:this.echarts,enumerable:!1,configurable:!0,writable:!0}}))];case 1:return n=o.sent(),n!=null&&n.prevented?[2]:[2]}})})})},d.prototype.render=function(){var t=this,e=this.props,a=e.className,r=e.width,s=e.height,i=e.classPrefix,n=e.unMountOnHidden,o=e.data,l=e.id,v=e.wrapperCustomStyle,b=e.env,C=e.themeCss;e.baseControlClassName;var c=this.props.style||{};c.width=c.width||r||"100%",c.height=c.height||s||"300px";var h=buildStyle(c,o);return React__default.createElement("div",{className:cx("".concat(i,"Chart"),a,setThemeClassName(__assign(__assign({},this.props),{name:"baseControlClassName",id:l,themeCss:C})),setThemeClassName(__assign(__assign({},this.props),{name:"wrapperCustomStyle",id:l,themeCss:v}))),style:h},React__default.createElement(themedLazyComponent,{unMountOnHidden:n,placeholder:"...",component:function(){return React__default.createElement("div",{className:"".concat(i,"Chart-content"),ref:t.refFn})}}),React__default.createElement(CustomStyle,__assign({},this.props,{config:{wrapperCustomStyle:v,id:l,themeCss:C,classNames:[{key:"baseControlClassName"}]},env:b})))},d.defaultProps={replaceChartOption:!1,unMountOnHidden:!1},d.propsList=[],d}(React__default.Component),ChartRenderer=function(m){__extends(d,m);function d(t,e){var a=m.call(this,t)||this,r=e;return r.registerComponent(a),a}return d.prototype.componentWillUnmount=function(){m.prototype.componentWillUnmount.call(this);var t=this.context;t.unRegisterComponent(this)},d.prototype.setData=function(t,e){var a=this.props.store;a.updateData(t,void 0,e),this.renderChart(this.props.config,a.data)},d.prototype.getData=function(){var t=this.props.store;return t.data},d.contextType=ScopedContext,d=__decorate([Renderer({type:"chart",storeType:ServiceStore.name}),__metadata("design:paramtypes",[Object,Object])],d),d}(Chart);export{Chart,ChartRenderer};
