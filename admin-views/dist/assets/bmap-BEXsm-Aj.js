import{a as e,extendComponentModel as t,extendComponentView as n,i as r,n as i,r as a,registerAction as o,registerCoordinateSystem as s,t as c}from"./echarts-hicIRVTY.js";function l(e,t){this._bmap=e,this.dimensions=[`lng`,`lat`],this._mapOffset=[0,0],this._api=t,this._projection=new BMap.MercatorProjection}l.prototype.type=`bmap`,l.prototype.dimensions=[`lng`,`lat`],l.prototype.setZoom=function(e){this._zoom=e},l.prototype.setCenter=function(e){this._center=this._projection.lngLatToPoint(new BMap.Point(e[0],e[1]))},l.prototype.setMapOffset=function(e){this._mapOffset=e},l.prototype.getBMap=function(){return this._bmap},l.prototype.dataToPoint=function(e){var t=new BMap.Point(e[0],e[1]),n=this._bmap.pointToOverlayPixel(t),r=this._mapOffset;return[n.x-r[0],n.y-r[1]]},l.prototype.pointToData=function(e){var t=this._mapOffset;return e=this._bmap.overlayPixelToPoint({x:e[0]+t[0],y:e[1]+t[1]}),[e.lng,e.lat]},l.prototype.getViewRect=function(){var e=this._api;return new c(0,0,e.getWidth(),e.getHeight())},l.prototype.getRoamTransform=function(){return i()},l.prototype.prepareCustoms=function(){var e=this.getViewRect();return{coordSys:{type:`bmap`,x:e.x,y:e.y,width:e.width,height:e.height},api:{coord:a(this.dataToPoint,this),size:a(u,this)}}},l.prototype.convertToPixel=function(e,t,n){return this.dataToPoint(n)},l.prototype.convertFromPixel=function(e,t,n){return this.pointToData(n)};function u(t,n){return n||=[0,0],e([0,1],function(e){var r=n[e],i=t[e]/2,a=[],o=[];return a[e]=r-i,o[e]=r+i,a[1-e]=o[1-e]=n[1-e],Math.abs(this.dataToPoint(a)[e]-this.dataToPoint(o)[e])},this)}var d;l.dimensions=l.prototype.dimensions;function f(){function e(e){this._root=e}return e.prototype=new BMap.Overlay,e.prototype.initialize=function(e){return e.getPanes().labelPane.appendChild(this._root),this._root},e.prototype.draw=function(){},e}l.create=function(e,t){var n,i=t.getDom();return e.eachComponent(`bmap`,function(e){var a=t.getZr().painter,o=a.getViewportRoot();if(typeof BMap>`u`)throw Error(`BMap api is not loaded`);if(d||=f(),n)throw Error(`Only one bmap component can exist`);var s;if(!e.__bmap){var c=i.querySelector(`.ec-extension-bmap`);c&&(o.style.left=`0px`,o.style.top=`0px`,i.removeChild(c)),c=document.createElement(`div`),c.className=`ec-extension-bmap`,c.style.cssText=`position:absolute;width:100%;height:100%`,i.appendChild(c);var u=e.get(`mapOptions`);u&&(u=r(u),delete u.mapType),s=e.__bmap=new BMap.Map(c,u);var p=new d(o);s.addOverlay(p),a.getViewportRootOffset=function(){return{offsetLeft:0,offsetTop:0}}}s=e.__bmap;var m=e.get(`center`),h=e.get(`zoom`);if(m&&h){var g=s.getCenter(),_=s.getZoom();if(e.centerOrZoomChanged([g.lng,g.lat],_)){var v=new BMap.Point(m[0],m[1]);s.centerAndZoom(v,h)}}n=new l(s,t),n.setMapOffset(e.__mapOffset||[0,0]),n.setZoom(h),n.setCenter(m),e.coordinateSystem=n}),e.eachSeries(function(e){e.get(`coordinateSystem`)===`bmap`&&(e.coordinateSystem=n)}),n&&[n]};var p=l;function m(e,t){return e&&t&&e[0]===t[0]&&e[1]===t[1]}t({type:`bmap`,getBMap:function(){return this.__bmap},setCenterAndZoom:function(e,t){this.option.center=e,this.option.zoom=t},centerOrZoomChanged:function(e,t){var n=this.option;return!(m(e,n.center)&&t===n.zoom)},defaultOption:{center:[104.114129,37.550339],zoom:5,mapStyle:{},mapStyleV2:{},mapOptions:{},roam:!1}});function h(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}n({type:`bmap`,render:function(e,t,n){var i=!0,a=e.getBMap(),o=n.getZr().painter.getViewportRoot(),s=e.coordinateSystem,c=function(t,r){if(!i){var a=o.parentNode.parentNode.parentNode,c=[-parseInt(a.style.left,10)||0,-parseInt(a.style.top,10)||0],l=o.style,u=c[0]+`px`,d=c[1]+`px`;l.left!==u&&(l.left=u),l.top!==d&&(l.top=d),s.setMapOffset(c),e.__mapOffset=c,n.dispatchAction({type:`bmapRoam`,animation:{duration:0}})}};function l(){i||n.dispatchAction({type:`bmapRoam`,animation:{duration:0}})}a.removeEventListener(`moving`,this._oldMoveHandler),a.removeEventListener(`moveend`,this._oldMoveHandler),a.removeEventListener(`zoomend`,this._oldZoomEndHandler),a.addEventListener(`moving`,c),a.addEventListener(`moveend`,c),a.addEventListener(`zoomend`,l),this._oldMoveHandler=c,this._oldZoomEndHandler=l;var u=e.get(`roam`);u&&u!==`scale`?a.enableDragging():a.disableDragging(),u&&u!==`move`?(a.enableScrollWheelZoom(),a.enableDoubleClickZoom(),a.enablePinchToZoom()):(a.disableScrollWheelZoom(),a.disableDoubleClickZoom(),a.disablePinchToZoom());var d=e.__mapStyle,f=e.get(`mapStyle`)||{},p=JSON.stringify(f);JSON.stringify(d)!==p&&(h(f)||a.setMapStyle(r(f)),e.__mapStyle=JSON.parse(p));var m=e.__mapStyle2,g=e.get(`mapStyleV2`)||{},_=JSON.stringify(g);JSON.stringify(m)!==_&&(h(g)||a.setMapStyleV2(r(g)),e.__mapStyle2=JSON.parse(_)),i=!1}}),s(`bmap`,p),o({type:`bmapRoam`,event:`bmapRoam`,update:`updateLayout`},function(e,t){t.eachComponent(`bmap`,function(e){var t=e.getBMap(),n=t.getCenter();e.setCenterAndZoom([n.lng,n.lat],t.getZoom())})});var g=`1.0.0`;export{g as version};