import{$o as e,Ao as t,Ci as n,Do as r,Fo as i,Hn as a,Ia as o,J as s,Ko as c,La as l,Mi as u,Mo as d,No as f,Nr as p,Oa as m,Po as h,Ui as g,Ya as _,Zt as v,_n as y,ba as b,di as x,dr as S,ji as C,jo as w,ln as ee,ni as T,ui as E,vr as te,xr as ne}from"./index-zRImlZB6.js";var D=e(c()),O=e(x()),k=e(r()),A=e(E()),j=function(e){f(r,e);function r(t){var n=this;return n=e.call(this,t)||this,n.state={keyword:``,filteredOptions:n.props.options??[],allowSearch:!1},n.handleSearch=(0,k.default)(n.handleSearch.bind(n),250,{trailing:!0,leading:!1}),n}return r.prototype.componentDidUpdate=function(e){var t=this.props,n=this.state.keyword;if(e.options!==t.options||e.searchable!==t.searchable){var r=t.options,i=t.searchable;this.setState({filteredOptions:i&&n?this.filterOptions(r,n):r})}},r.prototype.reload=function(e,t){var n=this.props.reloadOptions;n&&n(e,t)},r.prototype.doAction=function(e,t,n){var r=e?.actionType,i=this.props,a=i.resetValue,s=i.onChange,c=i.formStore,l=i.store,u=i.name;if(r===`clear`)s?.(``);else if(r===`reset`){var d=o(c?.pristine??l?.pristine,u)??a;s?.(d??``)}else e.actionType===`expand`?this.treeRef.syncUnFolded(this.props,e.args?.openLevel):e.actionType===`collapse`?this.treeRef.syncUnFolded(this.props,e.args?.closeLevel||0):e.actionType===`add`?this.addItemFromAction(e.args?.item,e.args?.parentValue):e.actionType===`edit`?this.editItemFromAction(e.args?.item,e.args?.originValue):e.actionType===`delete`?this.deleteItemFromAction(e.args?.value):e.actionType===`reload`?this.reload():r===`search`&&(this.setState({allowSearch:!!e.args?.keyword}),this.handleSearch(e.args?.keyword))},r.prototype.resolveOption=function(e,t){var n=this;return C(e,function(e){var r=n.props.valueField||`value`;return(g(e,r)?e[r]:``)===t})},r.prototype.addItemFromAction=function(e,t){var n=this.props,r=n.onAdd,i=n.options,a=n.valueField,o=u(i,function(e){var n=a||`value`;return(g(e,n)?e[n]:``)===t})||[];r&&r(o.concat(0),e,!0)},r.prototype.editItemFromAction=function(e,n){var r=this.props,i=r.onEdit,a=r.options,o=this.resolveOption(a,n);i&&o&&i(t(t({},e),{originValue:n}),o,!0)},r.prototype.deleteItemFromAction=function(e){var t=this.props,n=t.onDelete,r=t.options,i=this.resolveOption(r,e);n&&i&&n(i)},r.prototype.filterOptions=function(e,n){var r=this,i=this.props,a=i.labelField,o=i.valueField;return e.map(function(e){if(e=t({},e),e.visible=!!_([e],n,{keys:[a||`label`,o||`value`],threshold:_.rankings.CONTAINS}).length,!e.visible&&e.children){e.children=r.filterOptions(e.children,n);var i=e.children.filter(function(e){return e.visible}).length;e.visible=!!i}return e.visible&&(e.collapsed=!1),e})},r.prototype.handleChange=function(e){return w(this,void 0,void 0,function(){var t,n,r,i,a,o,s,c,l,u,d,f,m,g,_,v,b,x;return h(this,function(h){switch(h.label){case 0:return t=this.props,n=t.onChange,r=t.searchable,i=t.options,a=t.dispatchEvent,o=t.multiple,s=t.delimiter,c=t.valueField,l=t.selectedOptions,u=t.joinValues,d=t.extractValue,f=this.state,m=f.filteredOptions,g=f.allowSearch,_=r||g?m:i,v=y(e,{multiple:o,delimiter:s,valueField:c,options:m}),b=o?null:v[0],o&&(r||g)&&l.length&&(l.forEach(function(e){C(m,function(t){return t[c||`value`]===e[c||`value`]})||v.push(e)}),e=v.map(function(e){return d||u?e[c||`value`]:e}),u&&(e=e.join(s||`,`))),[4,a(`change`,p(this.props,{value:e,item:b,items:_,selectedItems:v}))];case 1:return x=h.sent(),x?.prevented||n&&n(e),[2]}})})},r.prototype.handleNodeClick=function(e){return w(this,void 0,void 0,function(){var t,n,r,i;return h(this,function(a){switch(a.label){case 0:return t=this.props,n=t.dispatchEvent,r=t.data,[4,n(`itemClick`,m(r,{item:e}))];case 1:return i=a.sent(),i?.prevented,[2]}})})},r.prototype.handleSearch=function(e){return w(this,void 0,void 0,function(){var t,n,r,i,a,o,s,c,l,u;return h(this,function(d){switch(d.label){case 0:if(t=this.props,n=t.searchApi,r=t.options,i=t.env,a=t.data,o=t.translate,s=[],!T(n))return[3,5];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,i.fetcher(n,m(a,{term:e}))];case 2:if(c=d.sent(),!c.ok)throw Error(o(c.msg||`networkError`));if(l=c.data.options||c.data.items||c.data,!Array.isArray(l))throw Error(o(`Tree.invalidArray`));return s=l,[3,4];case 3:return u=d.sent(),i.isCancel(u)||!n.silent&&i.notify(`error`,u.message),[3,4];case 4:return[3,6];case 5:e&&(s=this.filterOptions(r,e)),d.label=6;case 6:return this.setState({keyword:e,filteredOptions:e?s:r}),[2]}})})},r.prototype.domRef=function(e){this.treeRef=e},r.prototype.validate=function(){var e=this.props,t=e.value,n=e.minLength,r=e.maxLength,i=e.delimiter,a=Array.isArray(t)?t:(t?String(t):``).split(i||`,`);if(n&&a.length<n)return`已选择数量低于设定的最小个数${n}，请选择更多的选项。`;if(r&&a.length>r)return`已选择数量超出设定的最大个数${r}，请取消选择超出的选项。`},r.prototype.renderOptionItem=function(e,n){var r=this.props,i=r.menuTpl,a=r.render,o=r.data;return a(`option/${n.index}`,i,{data:m(m(o,t({},n)),e)})},r.prototype.renderItemActions=function(e,n){var r=this.props,i=r.itemActions,a=r.data,o=r.render;return o(`action/${n.index}`,i||``,{data:m(m(a,t({},n)),e)})},r.prototype.renderSearch=function(){var e=this.props,n=e.classPrefix,r=e.searchConfig,i=e.mobileUI,a=e.testIdBuilder;return D.createElement(v,t({className:(0,A.default)(`${n}TreeControl-searchbox`,r?.className,{"is-sticky":r?.sticky}),mini:!1,clearable:!0},(0,O.default)(r,`className`,`sticky`),{onSearch:this.handleSearch,mobileUI:i,testIdBuilder:a?.getChild(`search`)}))},r.prototype.render=function(){var e=this.props,n=e.className,r=e.treeContainerClassName,i=e.classPrefix,o=e.value,s=e.enableNodePath,c=e.pathSeparator,u=c===void 0?`/`:c,d=e.disabled,f=e.joinValues,p=e.extractValue,m=e.delimiter,h=e.placeholder,g=e.options,_=e.multiple,v=e.valueField,y=e.initiallyOpen,x=e.unfoldedLevel,S=e.withChildren,C=e.onlyChildren,w=e.onlyLeaf,T=e.loading,E=e.hideRoot,O=e.rootLabel,k=e.autoCheckChildren,j=e.autoCancelParent,M=e.cascade,re=e.rootValue,ie=e.showIcon,ae=e.showRadio,oe=e.showOutline,se=e.onAdd,ce=e.creatable,le=e.createTip,ue=e.addControls,de=e.onEdit,N=e.editable,P=e.editTip,F=e.editControls,I=e.removable,L=e.removeTip,R=e.onDelete,z=e.rootCreatable,B=e.rootCreateTip,V=e.labelField,H=e.iconField,fe=e.deferField,pe=e.nodePath,me=e.deferLoad,he=e.expandTreeOptions,U=e.translate,ge=e.data,_e=e.virtualThreshold,ve=e.loadingConfig,ye=e.menuTpl,be=e.enableDefaultIcon,W=e.searchable,G=e.searchConfig,xe=G===void 0?{}:G,Se=e.heightAuto,Ce=e.mobileUI,K=e.testIdBuilder,we=e.nodeBehavior,Te=e.itemActions,q=e.id,Ee=e.wrapperCustomStyle,J=e.themeCss,De=e.env,Y=e.treeClassName,X=this.props.highlightTxt,Z=this.state,Oe=Z.filteredOptions,ke=Z.keyword,Q=Z.allowSearch;b(X)&&(X=l(X,ge));var $=D.createElement(ee,{className:Y,classPrefix:i,onRef:this.domRef,labelField:V,valueField:v,iconField:H,deferField:fe,disabled:d,onChange:this.handleChange,onHandleNodeClick:this.handleNodeClick,joinValues:f,extractValue:p,delimiter:m,placeholder:U(h),options:W||Q?Oe:g,highlightTxt:W||Q?ke:X,multiple:_,initiallyOpen:y,unfoldedLevel:x,withChildren:S,onlyChildren:C,onlyLeaf:w,hideRoot:E,rootLabel:U(O),rootValue:re,showIcon:ie,showRadio:ae,showOutline:oe,autoCheckChildren:k,autoCancelParent:j,cascade:M,foldedField:`collapsed`,value:o||``,nodePath:pe,enableNodePath:s,pathSeparator:u,selfDisabledAffectChildren:!1,onAdd:se,creatable:ce,createTip:le,rootCreatable:z,rootCreateTip:B,onEdit:de,editable:N,editTip:P,removable:I,removeTip:L,onDelete:R,bultinCUD:!ue&&!F,onDeferLoad:me,onExpandTree:he,virtualThreshold:_e,itemRender:ye?this.renderOptionItem:void 0,enableDefaultIcon:be,mobileUI:Ce,nodeBehavior:we,itemActionsRender:Te?this.renderItemActions:void 0,actionClassName:(0,A.default)(ne(t(t({},this.props),{name:`actionControlClassName`,id:q,themeCss:J}))),testIdBuilder:K?.getChild(`tree`)});return D.createElement(D.default.Fragment,null,D.createElement(`div`,t({className:(0,A.default)(`${i}TreeControl`,n,r,{"is-sticky":W&&xe?.sticky,"h-auto":Se})},K?.getChild(`control`).getTestId()),T?null:W?D.createElement(D.default.Fragment,null,this.renderSearch(),$):$,D.createElement(a,{size:`sm`,key:`info`,show:T,loadingConfig:ve})),D.createElement(te,t({},this.props,{config:{wrapperCustomStyle:Ee,id:q,themeCss:J,classNames:[{key:`actionControlClassName`}]},env:De})))},r.defaultProps={placeholder:`placeholder.noData`,multiple:!1,rootLabel:`Tree.root`,rootValue:``,showIcon:!0,enableNodePath:!1,pathSeparator:`/`},d([n,i(`design:type`,Function),i(`design:paramtypes`,[Object,Object]),i(`design:returntype`,void 0)],r.prototype,`addItemFromAction`,null),d([n,i(`design:type`,Function),i(`design:paramtypes`,[Object,Object]),i(`design:returntype`,void 0)],r.prototype,`editItemFromAction`,null),d([n,i(`design:type`,Function),i(`design:paramtypes`,[Object]),i(`design:returntype`,void 0)],r.prototype,`deleteItemFromAction`,null),d([n,i(`design:type`,Function),i(`design:paramtypes`,[Object]),i(`design:returntype`,Promise)],r.prototype,`handleChange`,null),d([n,i(`design:type`,Function),i(`design:paramtypes`,[Object]),i(`design:returntype`,Promise)],r.prototype,`handleNodeClick`,null),d([n,i(`design:type`,Function),i(`design:paramtypes`,[Object]),i(`design:returntype`,void 0)],r.prototype,`domRef`,null),d([n,i(`design:type`,Function),i(`design:paramtypes`,[Object,Object]),i(`design:returntype`,void 0)],r.prototype,`renderOptionItem`,null),d([n,i(`design:type`,Function),i(`design:paramtypes`,[Object,Object]),i(`design:returntype`,void 0)],r.prototype,`renderItemActions`,null),d([n,i(`design:type`,Function),i(`design:paramtypes`,[]),i(`design:returntype`,void 0)],r.prototype,`renderSearch`,null),d([s(),i(`design:type`,Function),i(`design:paramtypes`,[]),i(`design:returntype`,void 0)],r.prototype,`render`,null),r}(D.Component),M=function(e){f(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t=d([S({type:`input-tree`})],t),t}(j);export{M as TreeControlRenderer,j as default};