import{$o as e,Ao as t,Fo as n,Hn as r,Ia as i,In as a,J as o,Ko as s,Mo as c,Na as l,No as u,Nr as d,Po as f,ei as p,fr as m,jo as h,ni as g,ri as _}from"./index-C4Pf1uQ-.js";var v=e(s()),y=function(e){u(s,e);function s(t){var n=e.call(this,t)||this;return n.mounted=!1,n.toDispose=[],n.state={columns:t.columns||[],rows:t.rows||[],loading:!1},n.toggleItem=n.toggleItem.bind(n),n.reload=n.reload.bind(n),n.initOptions=n.initOptions.bind(n),n.mounted=!0,n}return s.prototype.componentDidMount=function(){var e=this.props,t=e.formInited,n=e.addHook,r=e.formItem;r&&this.toDispose.push(t||!n?r.addInitHook(this.initOptions):n(this.initOptions,`init`))},s.prototype.componentDidUpdate=function(e){var t=this.props;if(e.columns!==t.columns||e.rows!==t.rows)this.setState({columns:t.columns||[],rows:t.rows||[]});else if(t.formInited&&(t.source!==e.source||e.data!==t.data)){var n=p(e.source,e.data,{ignoreData:!0}),r=p(t.source,t.data,{ignoreData:!0});n.url!==r.url&&_(r.url)&&this.reload()}},s.prototype.componentWillUnmount=function(){this.mounted=!1,this.toDispose.forEach(function(e){return e()}),this.toDispose=[]},s.prototype.doAction=function(e,t,n){var r=this.props,a=r.resetValue,o=r.onChange,s=r.formStore,c=r.store,l=r.name,u=e?.actionType;if(u===`clear`)o?.(``);else if(u===`reset`){var d=i(s?.pristine??c?.pristine,l)??a;o?.(d??``)}},s.prototype.initOptions=function(e){return h(this,void 0,void 0,function(){var t,n,r;return f(this,function(i){switch(i.label){case 0:return[4,this.reload()];case 1:return i.sent(),t=this.props,n=t.formItem,r=t.name,n&&n.value&&l(e,r,n.value),[2]}})})},s.prototype.reload=function(){return h(this,void 0,void 0,function(){var e,t,n,r,i,a,o=this;return f(this,function(s){switch(s.label){case 0:if(e=this.props,t=e.source,n=e.data,r=e.env,i=e.onChange,a=e.translate,!g(t,n)||this.state.loading)return[2];if(!r||!r.fetcher)throw Error(`fetcher is required`);return[4,new Promise(function(e,s){if(!o.mounted)return e();o.setState({loading:!0},function(){if(!o.mounted)return e();r.fetcher(t,n).then(function(n){if(!n.ok)throw Error(n.msg||a(`fetchFailed`));if(!o.mounted)return e();o.setState({loading:!1,rows:n.data.rows||[],columns:n.data.columns||[]},function(){t&&t.replaceData;var r=n.data.value;r&&(r=t.replaceData?r:x(r,o.state.columns,o.state.rows),i(r)),e()})}).catch(function(t){return o.setState({error:t,loading:!1},function(){return e()})})})})];case 1:return[2,s.sent()]}})})},s.prototype.toggleItem=function(e,n,r){return h(this,void 0,void 0,function(){var i,a,o,s,c,l,u,p,m,h,g,h,g,h,m,_,v;return f(this,function(f){switch(f.label){case 0:if(i=this.state,a=i.columns,o=i.rows,s=this.props,c=s.multiple,l=s.singleSelectMode,u=s.dispatchEvent,s.data,p=this.props.value||b(a,o),c)p[n][r]=t(t({},p[n][r]),{checked:e});else if(l===`row`)for(m=0,h=a.length;m<h;m++)p[m][r]=t(t({},p[m][r]),{checked:n===m?e:!e});else if(l===`column`)for(g=0,h=o.length;g<h;g++)p[n][g]=t(t({},p[n][g]),{checked:r===g?e:!e});else for(g=0,h=o.length;g<h;g++)for(m=0,_=a.length;m<_;m++)p[m][g]=t(t({},p[m][g]),{checked:n===m&&r===g?e:!e});return[4,u(`change`,d(this.props,{value:p.concat()}))];case 1:return v=f.sent(),v?.prevented||this.props.onChange(p.concat()),[2]}})})},s.prototype.isColumChecked=function(e,t){var n=e[t];return n?n.some(function(e){return e&&e.checked}):!1},s.prototype.isColumnPartialChecked=function(e,t){var n=e[t];if(!n||n.length==1)return!1;var r=n[0].checked;return n.some(function(e){return e.checked!==r})&&!n.every(function(e){return e.checked===r})},s.prototype.toggleColumnCheckAll=function(e,t,n){return h(this,void 0,void 0,function(){var r,i;return f(this,function(a){switch(a.label){case 0:r=t[n],i=0,a.label=1;case 1:return i<r.length?[4,this.toggleItem(e,n,i)]:[3,4];case 2:a.sent(),a.label=3;case 3:return i++,[3,1];case 4:return[2]}})})},s.prototype.isRowChecked=function(e,t){return e&&e.some(function(e){return e[t]&&e[t].checked})},s.prototype.isRowPartialChecked=function(e,t){if(!e||e.length==1)return!1;var n=e[0][t].checked;return e.some(function(e){return n!==e[t].checked})&&!e.every(function(e){return e.checked})},s.prototype.toggleRowCheckAll=function(e,t,n){return h(this,void 0,void 0,function(){var r;return f(this,function(i){switch(i.label){case 0:r=0,i.label=1;case 1:return r<t.length?[4,this.toggleItem(e,r,n)]:[3,4];case 2:i.sent(),i.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},s.prototype.renderInput=function(e){var t=this;e===void 0&&(e=!1);var n=this.state,r=n.columns,i=n.rows,o=this.props,s=o.rowLabel,c=o.disabled,l=o.classnames,u=o.multiple,d=o.textAlign,f=o.xCheckAll,p=o.yCheckAll,m=o.testIdBuilder,h=o.mobileUI,g=this.props.value||b(r,i);return v.createElement(`div`,{className:l(`Table m-b-none`,{"is-mobile":h})},v.createElement(`div`,{className:l(`Table-content`)},v.createElement(`table`,{className:l(`Table-table`)},v.createElement(`thead`,null,v.createElement(`tr`,null,v.createElement(`th`,null,s),r.map(function(n,r){return v.createElement(`th`,{key:r,className:`text-`+(d||u?`left`:`center`)},u&&p?v.createElement(a,{type:`checkbox`,disabled:e||c,checked:t.isColumChecked(g,r),partial:t.isColumnPartialChecked(g,r),onChange:function(e){return t.toggleColumnCheckAll(e,g,r)}}):null,n.label)}))),v.createElement(`tbody`,null,i.map(function(n,i){return v.createElement(`tr`,{key:i},v.createElement(`td`,null,u&&f?v.createElement(a,{type:`checkbox`,disabled:e||c,checked:t.isRowChecked(g,i),partial:t.isRowPartialChecked(g,i),onChange:function(e){return t.toggleRowCheckAll(e,g,i)},testIdBuilder:m?.getChild(i)}):null,n.label,n.description||n.desc?v.createElement(`span`,{className:`m-l-xs text-muted text-xs`},n.description||n.desc):null),r.map(function(n,r){return v.createElement(`td`,{key:r,className:`text-`+(d||u?`left`:`center`)},v.createElement(a,{type:u?`checkbox`:`radio`,disabled:e||c,checked:!!(g[r]&&g[r][i]&&g[r][i].checked),onChange:function(e){return t.toggleItem(e,r,i)},testIdBuilder:m?.getChild(`${r}-${i}`)}))}))})))))},s.prototype.renderStatic=function(e){e===void 0&&(e=`-`);var t=this.props,n=t.className;t.render;var r=t.classnames,i=this.state.error;return v.createElement(`div`,{key:`input`,className:r(`MatrixControl`,n||``)},i?e:this.renderInput(!0))},s.prototype.render=function(){var e=this.props,t=e.className;e.render;var n=e.classnames,i=e.loadingConfig,a=this.state,o=a.error,s=a.loading;return v.createElement(`div`,{key:`input`,className:n(`MatrixControl`,t||``)},o?v.createElement(`div`,{className:n(`MatrixControl-error Alert Alert--danger`)},String(o)):this.renderInput(),v.createElement(r,{size:`lg`,overlay:!0,key:`info`,show:s,loadingConfig:i}))},s.defaultProps={columns:[],rows:[],multiple:!0,singleSelectMode:`column`},c([o(),n(`design:type`,Function),n(`design:paramtypes`,[]),n(`design:returntype`,void 0)],s.prototype,`render`,null),s}(v.Component);function b(e,n){return Array.isArray(e)||(e=[]),Array.isArray(n)||(n=[]),e.map(function(e){return n.map(function(n){return t(t(t({},n),e),{checked:!1})})})}function x(e,n,r){return e.map(function(e,i){return e.map(function(e,a){return t(t(t({},n[i]),r[a]),e)})})}var S=function(e){u(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t=c([m({type:`matrix-checkboxes`,strictMode:!1,sizeMutable:!1})],t),t}(y);export{S as MatrixRenderer,y as default};