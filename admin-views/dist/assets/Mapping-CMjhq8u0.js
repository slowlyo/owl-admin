import{dn as M,dp as S,dq as E,H as b,aw as c,z as h,dr as x,t as w,w as g,x as m,W as N,Y as O,d4 as R,l as f,a4 as z,aq as D,D as $,E as j,ds as q,bd as C}from"./index-CG72qQQo.js";var y,A=M.named("MappingStore").props({fetching:!1,errorMsg:"",valueField:"value",map:S.frozen({})}).actions(function(l){var s=E(function(e,n,a){var r,t,i;return b(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,3,4]),l.fetching=!0,[4,e.fetcher(n,a)];case 1:if(r=o.sent(),r.ok)t=q(r.data),l.setMap(Array.isArray(t.options)?t.options:Array.isArray(t.items)?t.items:Array.isArray(t.records)?t.records:t);else throw new Error(r.msg||"fetch error");return[3,4];case 2:return i=o.sent(),l.errorMsg=i.message,[3,4];case 3:return l.fetching=!1,[7];case 4:return[2]}})});return{load:s,setMap:function(e){Array.isArray(e)&&(e=e.reduce(function(n,a){if(a==null)return n;if(c(a)){var r=Object.keys(a);r.length===1||r.length==2&&r.includes("$$id")?(r=r.filter(function(t){return t!=="$$id"}),n[r[0]]=a[r[0]]):r.length>1&&(n[a[l.valueField]]=a)}return n},{})),c(e)&&(l.map=h({},e))}}}),P=x(function(l){return A.create({id:C(),storeType:A.name},l.env)})((y=function(l){w(s,l);function s(e){var n=l.call(this,e)||this;return e.store.syncProps(e,void 0,["valueField","map"]),n}return s.prototype.componentDidMount=function(){this.reload()},s.prototype.componentDidUpdate=function(e){var n=this.props,a=this.props,r=a.store,t=a.source,i=a.data;if(r.syncProps(n,e,t?["valueField"]:["valueField","map"]),g(t)){var o=m(e.source,e.data,"| raw"),u=m(t,i,"| raw");o!==u&&r.setMap(u)}else N(e.source,n.source,e.data,n.data)&&this.reload()},s.prototype.reload=function(){var e,n=this.props,a=n.source,r=n.data,t=n.env,i=this.props.store;if(g(a))i.setMap(m(a,r,"| raw"));else if(O(a,r)){var o=R(a,"get");o.cache=(e=o.cache)!==null&&e!==void 0?e:30*1e3,i.load(t,o,r)}},s.prototype.renderSingleValue=function(e,n,a){var r,t=this.props,i=t.className,o=t.style,u=t.placeholder,v=t.classnames,d=t.store,V=f.createElement("span",{className:"text-muted"},u),p=d.map,_=void 0;e=typeof e=="string"?e.trim():e;var F=a?o:void 0;return typeof e<"u"&&p&&(_=(r=this.renderValue(p,e))!==null&&r!==void 0?r:e===!0&&p[1]?p[1]:e===!1&&p[0]?p[0]:p["*"])!==void 0&&(V=this.renderViewValue(_,e)),f.createElement("span",{key:"map-".concat(n),className:v("MappingField",i),style:F},V)},s.prototype.renderViewValue=function(e,n){var a=this.props,r=a.render,t=a.itemSchema,i=a.renderViewValue,o=a.data,u=a.labelField,v=a.name;if(i)return i(e,n);if(!t){var d=e;return c(e)&&(u===void 0||u===""?e.hasOwnProperty("type")?d=h({name:v},d):d=e.label:d=e[u||"label"]),c(d)&&d.type==="tag"&&!c(d.label)&&d.label!=null?r("mapping-tag",d,{value:null}):r("tpl",d)}return r("mappingItemSchema",t,h({data:z(o,c(e)?e:{item:e})},(t==null?void 0:t.type)==="tag"?{value:null}:{}))},s.prototype.renderValue=function(e,n){var a=this.props.renderValue;return a?a(e,n):e[n]},s.prototype.render=function(){var e=this,n=this.props,a=n.style,r=n.defaultValue,t=n.data,i=D(this.props);return r&&g(r)&&r===i&&(i=m(r,t,"| raw")),Array.isArray(i)?f.createElement("span",{style:a},i.map(function(o,u){return e.renderSingleValue(o,u)})):this.renderSingleValue(i,0,!0)},s}(f.Component),y.defaultProps={placeholder:"-",map:{"*":"通配值"}},y)),I=function(l){w(s,l);function s(){return l!==null&&l.apply(this,arguments)||this}return s.prototype.render=function(){return f.createElement(P,h({},this.props))},s=$([j({type:"mapping",alias:["map"],name:"mapping"})],s),s}(f.Component);export{P as MappingField,I as MappingFieldRenderer,A as Store};
