const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Db1Q--Hg.js","assets/index-CG72qQQo.js","assets/index-BBn-9_NT.css"])))=>i.map(i=>d[i]);
import{t as x,l as c,W as b,L as g,x as O,a4 as S,G as h,H as p,_ as E,P as W,U as V,D as F,E as R,T,z as v}from"./index-CG72qQQo.js";var A=function(u){x(s,u);function s(e){var t=u.call(this,e)||this;return t.rootElement=c.createRef(),t.state={loading:!1},t}return s.prototype.componentDidMount=function(){var e;!((e=this.rootElement)===null||e===void 0)&&e.current&&this.renderWord()},s.prototype.componentDidUpdate=function(e){var t=this,r,n;if(!this.state.loading){var i=this.props;b(e.src,i.src,e.data,i.data)&&this.fetchWord().then(function(){t.renderWord()}),i.name&&e.data[i.name]!==i.data[i.name]&&this.renderWord(),(JSON.stringify(e.wordOptions)!==JSON.stringify(i.wordOptions)||e.display!==i.display)&&this.renderWord(),!((r=i.wordOptions)===null||r===void 0)&&r.enableVar&&(i.trackExpression&&g(i.trackExpression,i.data)!==g(e.trackExpression,e.data)?this.renderWord():(n=this.office)===null||n===void 0||n.updateVariable())}},s.prototype.doAction=function(e,t,r,n){var i,l,a=e==null?void 0:e.actionType;a==="saveAs"&&((i=this.office)===null||i===void 0||i.download((n==null?void 0:n.name)||this.fileName)),a==="print"&&((l=this.office)===null||l===void 0||l.print())},s.prototype.evalVar=function(e,t){var r=this.props.data;return O("${"+e+"}",S(t,r),"| raw")},s.prototype.renderWord=function(){return h(this,void 0,void 0,function(){var e,t,r;return p(this,function(n){switch(n.label){case 0:return e=this.props,t=e.src,r=e.name,t?this.document?[3,2]:[4,this.fetchWord()]:[3,4];case 1:n.sent(),n.label=2;case 2:return[4,this.renderRemoteWord()];case 3:return n.sent(),[3,5];case 4:r&&this.renderFormFile(),n.label=5;case 5:return[2]}})})},s.prototype.fetchWord=function(){var e;return h(this,void 0,void 0,function(){var t,r,n,i,l,a,o,d;return p(this,function(f){switch(f.label){case 0:if(t=this.props,r=t.env,n=t.src,i=t.data,l=t.translate,o=n?O(n,i,"| raw"):void 0,typeof o=="string"?(a=o,this.fileName=a.split("/").pop()):typeof o=="object"&&typeof o.value=="string"&&(a=o.value,this.fileName=o.name||a.split("/").pop()),!a)return console.warn("file src is empty"),[2];this.finalSrc=a,this.setState({loading:!0}),f.label=1;case 1:return f.trys.push([1,3,4,5]),[4,r.fetcher(a,i,{responseType:"arraybuffer"})];case 2:return d=f.sent(),this.document=d.data,[3,5];case 3:return f.sent(),!((e=this.rootElement)===null||e===void 0)&&e.current&&(this.rootElement.current.innerHTML=l("loadingFailed")+" url:"+a),[3,5];case 4:return this.setState({loading:!1}),[7];case 5:return[2]}})})},s.prototype.initOffice=function(e,t){return h(this,void 0,void 0,function(){var r,n,i,l,a,o;return p(this,function(d){switch(d.label){case 0:return r=this.props,n=r.wordOptions,i=r.excelOptions,r.env,r.src,l=r.data,r.translate,a=e.createOfficeViewer,[4,a(t||this.document,{},this.finalSrc)];case 1:return o=d.sent(),o instanceof e.Word?(o.updateOptions(v(v({},n),{data:l,evalVar:this.evalVar.bind(this)})),[3,4]):[3,2];case 2:return o instanceof e.Excel?(o.updateOptions(v(v({},i),{data:l,evalVar:this.evalVar.bind(this)})),[4,o.loadExcel()]):[3,4];case 3:d.sent(),d.label=4;case 4:return[2,o]}})})},s.prototype.renderRemoteWord=function(){return h(this,void 0,void 0,function(){var e,t,r=this;return p(this,function(n){return e=this.props,e.wordOptions,e.excelOptions,e.env,e.src,e.data,t=e.display,e.translate,this.document?(E(()=>import("./index-Db1Q--Hg.js"),__vite__mapDeps([0,1,2])).then(function(i){return h(r,void 0,void 0,function(){var l,a,o;return p(this,function(d){switch(d.label){case 0:return[4,this.initOffice(i)];case 1:return l=d.sent(),t!==!1?l.render((a=this.rootElement)===null||a===void 0?void 0:a.current):t===!1&&(!((o=this.rootElement)===null||o===void 0)&&o.current)&&(this.rootElement.current.innerHTML=""),this.office=l,this.setState({loading:!1}),[2]}})})}),[2]):[2]})})},s.prototype.renderFormFile=function(){var e=this;this.setState({loading:!0});var t=this.props;t.wordOptions;var r=t.name,n=t.data,i=t.display,l=n[r];if(l instanceof File){var a=new FileReader;a.onload=function(o){var d=a.result;E(()=>import("./index-Db1Q--Hg.js"),__vite__mapDeps([0,1,2])).then(function(f){return h(e,void 0,void 0,function(){var m,y,_;return p(this,function(w){switch(w.label){case 0:return[4,this.initOffice(f,d)];case 1:return m=w.sent(),i!==!1?m.render((y=this.rootElement)===null||y===void 0?void 0:y.current):i===!1&&(!((_=this.rootElement)===null||_===void 0)&&_.current)&&(this.rootElement.current.innerHTML=""),this.office=m,this.setState({loading:!1}),[2]}})})})},a.readAsArrayBuffer(l)}else this.setState({loading:!1})},s.prototype.render=function(){var e=this.props,t=e.classnames;e.translate;var r=e.className,n=e.loading,i=n===void 0?!1:n,l=e.src,a=e.name,o=e.display,d=e.loadingConfig;return c.createElement("div",null,o!==!1&&!l&&!a&&c.createElement("svg",{width:"100%",height:"100",xmlns:"http://www.w3.org/2000/svg"},c.createElement("rect",{x:"0",y:"0",width:"100%",height:"100",style:{fill:"#F7F7F9"}}),c.createElement("text",{x:"50%",y:"50%",fontSize:"18",textAnchor:"middle",alignmentBaseline:"middle",fontFamily:"monospace, sans-serif",fill:"#555555"},"office viewer")),c.createElement("div",{ref:this.rootElement,className:t("office-viewer",r)}),c.createElement(W,{overlay:!0,key:"info",show:i&&this.state.loading,loadingConfig:d}))},s}(c.Component),C=function(u){x(s,u);function s(e,t){var r=u.call(this,e)||this,n=t;return n.registerComponent(r),r}return s.prototype.componentWillUnmount=function(){var e;(e=u.prototype.componentWillUnmount)===null||e===void 0||e.call(this);var t=this.context;t.unRegisterComponent(this)},s.contextType=V,s=F([R({type:"office-viewer"}),T("design:paramtypes",[Object,Object])],s),s}(A);export{C as OfficeViewerRenderer,A as default};
