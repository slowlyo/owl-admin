import{$a as e,$o as t,Ao as n,Ci as r,Fo as i,Ia as a,Io as o,J as s,Kn as c,Ko as l,La as u,Mo as d,No as f,Nr as p,Oa as m,Po as h,Va as g,Wn as _,ba as v,di as y,dr as b,gi as x,gt as S,hi as C,jo as w,lo as T,ni as E,sn as D,ta as O,ti as k,ui as A,vn as j,vr as M,xr as N,ya as P}from"./index-DAdqRbKX.js";var F=t(l()),I=t(A()),L=t(y()),R=t(C()),z=t(g()),B=t(x()),V=t(e()),H=t(D()),U=function(e){f(t,e);function t(t){var n=e.call(this,t)||this;n.state={isOpened:!1,schema:n.buildSchema(n.props),isFocused:!1},n.input=F.createRef(),n.toDispose=[],n.mounted=!1;var r=t.formInited,i=t.addHook,a=t.formItem,o=function(){return w(n,void 0,void 0,function(){var e=this;return h(this,function(t){switch(t.label){case 0:return[4,this.fetchOptions()];case 1:return t.sent(),this.mounted&&this.toDispose.push(T(function(){return JSON.stringify(a?.tmpValue)},function(){return e.fetchOptions()})),[2]}})})};return a&&n.toDispose.push(r||!i?a.addInitHook(o):i(o,`init`)),n}return t.prototype.componentDidMount=function(){this.mounted=!0},t.prototype.componentDidUpdate=function(e){var t,n=this.props;[`multiple`,`source`,`pickerSchema`].some(function(t){return!(0,z.default)(e[t],n[t])})?this.setState({schema:this.buildSchema(n)}):k(e.source,n.source,e.data,n.data)&&(t=n.formItem)!=null&&t.inited&&this.fetchOptions()},t.prototype.componentWillUnmount=function(){this.toDispose.forEach(function(e){return e()}),this.toDispose=[],this.mounted=!1},t.prototype.fetchOptions=function(){var e,t=this.props,n=t.value,r=t.formItem,i=t.valueField,a=t.labelField,o=t.source,s=t.data,c;if(!(!o||!r||(i||`value`)===(a||`label`)||(c=r.getSelectedOptions(n))&&(!c.length||c[0][i||`value`]!==c[0][a||`label`]))){var l=m(s,(e={value:n},e[i||`value`]=n,e.op=`loadOptions`,e));if(v(o))r.setOptions(u(o,s,`| raw`));else if(E(o,l))return r.loadOptions(o,l,{autoAppend:!0})}},t.prototype.buildSchema=function(e){var t=v(e.source);return n(n({checkOnItemClick:!0,listItem:{title:`\${${e.labelField||`label`}|raw}`}},e.pickerSchema),{labelTpl:e.pickerSchema?.labelTpl??e.labelTpl,type:`crud`,pickerMode:!0,syncLocation:!1,filterCanAccessSuperData:!1,api:t?null:e.source,source:t?e.source:null,keepItemSelectionOnPageChange:!0,valueField:e.valueField,labelField:e.labelField,bulkActions:e.multiple?e.pickerSchema.bulkActions:[]})},t.prototype.crudRef=function(e){for(;e&&e.getWrappedInstance;)e=e.getWrappedInstance();this.crud=e},t.prototype.reload=function(e,t){if(this.crud)this.crud.reload(e,t);else{var n=this.props.reloadOptions;n&&n(e,t)}},t.prototype.open=function(){this.setState({isOpened:!0})},t.prototype.close=function(){this.setState({isOpened:!1})},t.prototype.handleModalConfirm=function(e,t,n,r){return w(this,void 0,void 0,function(){var t;return h(this,function(n){switch(n.label){case 0:return t=(0,B.default)(r,function(e){return e.props.type===`crud`}),[4,this.handleChange(e[t].items)];case 1:return n.sent(),this.close(),[2]}})})},t.prototype.handleChange=function(e){return w(this,void 0,void 0,function(){var t,n,r,i,a,o,s,c,l,u,d,f,m,g;return h(this,function(h){switch(h.label){case 0:return t=this.props,n=t.joinValues,r=t.valueField,i=t.delimiter,a=t.extractValue,o=t.multiple,s=t.options,t.data,c=t.dispatchEvent,t.selectedOptions,l=t.setOptions,u=t.onChange,d=e,d=n?e.map(function(e){return e[r||`value`]}).join(i||`,`):a?o?e.map(function(e){return e[r||`value`]}):e[0]&&e[0][r||`value`]||``:o?e:e[0],f=[],e.forEach(function(e){(0,R.default)(s,function(t){return e[r||`value`]==t[r||`value`]})||f.push(e)}),f.length&&l(s.concat(f)),m=o?e:e[0],[4,c(`change`,p(this.props,{value:d,option:m,selectedItems:m}))];case 1:return g=h.sent(),g?.prevented||u(d),[2]}})})},t.prototype.handleItemClick=function(e){return w(this,void 0,void 0,function(){var t,n,r,i;return h(this,function(a){switch(a.label){case 0:return t=this.props,n=t.data,r=t.dispatchEvent,[4,r(`itemClick`,m(n,{item:e}))];case 1:return i=a.sent(),i?.prevented,[2]}})})},t.prototype.removeItem=function(e){return w(this,void 0,void 0,function(){var t,n,r,i,a,s,c,l,u,d,f,m,g,_;return h(this,function(h){switch(h.label){case 0:return t=this.props,n=t.selectedOptions,r=t.joinValues,i=t.extractValue,a=t.delimiter,s=t.valueField,c=t.onChange,l=t.multiple,u=t.dispatchEvent,d=n.concat(),f=o(d.splice(e,1),1),m=f[0],g=d,g=r?d.map(function(e){return e[s||`value`]}).join(a||`,`):i?l?d.map(function(e){return e[s||`value`]}):d[0]&&d[0][s||`value`]||``:l?d:d[0],[4,u(`change`,p(this.props,{value:g,option:m,selectedItems:m}))];case 1:return _=h.sent(),_?.prevented||c(g),[2]}})})},t.prototype.handleKeyDown=function(e){var t=this.props.selectedOptions;e.key===` `?(this.open(),e.preventDefault()):t.length&&e.key==`Backspace`&&this.removeItem(t.length-1)},t.prototype.handleFocus=function(e){this.input.current&&this.input.current.focus(),e.stopPropagation(),this.setState({isFocused:!0})},t.prototype.handleBlur=function(){this.setState({isFocused:!1})},t.prototype.handleClick=function(){this.open()},t.prototype.clearValue=function(e){e.stopPropagation();var t=this.props,n=t.onChange,r=t.resetValue;n(r===void 0?``:r)},t.prototype.getOverflowConfig=function(){var e=this.props.overflowConfig;return(0,V.default)(t.defaultProps.overflowConfig,e)},t.prototype.handleSelect=function(e,t){var n=this.props,r=n.selectedOptions,i=n.valueField;if(!(!Array.isArray(e)||!Array.isArray(t)||!e.length&&!t.length)){var a=(0,H.default)(e,r,function(e,t){var n=e[i||`value`],r=t[i||`value`];return n||r?n===r:(0,z.default)((0,L.default)(e,`value`),(0,L.default)(t,`value`))});a.length===e.length&&a.length===r.length||this.handleChange(e)}},t.prototype.renderTag=function(e,t){var r=this,i=this.props,o=i.itemClearable,s=o===void 0?!0:o,c=i.classPrefix,l=i.classnames,u=i.labelField,d=i.labelTpl;i.translate;var f=i.disabled,p=i.env,m=i.id,h=i.themeCss,g=i.css;return F.createElement(`div`,{key:t,className:l(`${c}Picker-value`,N(n(n({},this.props),{name:`pickValueWrapClassName`,id:m,themeCss:h||g})),{"is-disabled":f})},s&&F.createElement(`span`,{className:l(`${c}Picker-valueIcon`,N(n(n({},this.props),{name:`pickValueIconClassName`,id:m,themeCss:h||g}))),onClick:function(e){e.stopPropagation(),r.removeItem(t)}},`×`),F.createElement(S,{inline:!1,tooltip:a(e,u||`label`)},F.createElement(`span`,{className:l(`${c}Picker-valueLabel`,N(n(n({},this.props),{name:`pickFontClassName`,id:m,themeCss:h||g}))),onClick:function(t){t.stopPropagation(),r.handleItemClick(e)}},d?F.createElement(_,{html:P(d,e),filterHtml:p.filterHtml}):`${a(e,u||`label`)||a(e,`id`)}`)))},t.prototype.renderValues=function(){var e=this,t=this.props;t.classPrefix;var r=t.selectedOptions,i=t.translate;t.disabled;var a=t.multiple,o=t.popOverContainer;t.id,t.themeCss,t.css;var s=this.getOverflowConfig(),c=s.maxTagCount,l=s.overflowTagPopover,u=r,d=a!==!1&&typeof c==`number`&&c>0,f=n({tooltipClassName:(0,I.default)(`Picker-overflow`,l?.tooltipClassName),title:i(`已选项`)},(0,L.default)(l,[`children`,`content`,`tooltipClassName`]));return F.createElement(j,{enabled:!!d,tooltipClassName:(0,I.default)(`Picker-overflow-wrapper`),items:u,popOverContainer:o,tooltipOptions:f,maxVisibleCount:c,renderItem:function(t,n,r){return e.renderTag(t,n)}})},t.prototype.overrideCRUDProps=function(){return{}},t.prototype.renderBody=function(e){var t=(e===void 0?{}:e).popOverContainer,r=this.props,i=r.render,a=r.selectedOptions,o=r.options,s=r.multiple,c=r.valueField,l=r.embed,u=r.source,d=r.strictMode,f=r.testIdBuilder,p=this.getOverflowConfig(),m=p.maxTagCount,h=p.overflowTagPopoverInCRUD,g=p.displayPosition;return i(`modal-body`,this.state.schema,n(n({value:a,valueField:c,primaryField:c,options:u?[]:o,multiple:s,strictMode:d,onSelect:l?this.handleSelect:void 0,testIdBuilder:f?.getChild(`body-schema`),ref:this.crudRef,popOverContainer:t},l||Array.isArray(g)&&g.includes(`crud`)?{maxTagCount:m,overflowTagPopover:h}:{}),this.overrideCRUDProps()))},t.prototype.render=function(){var e=this.props,t=e.className;e.style;var r=e.modalClassName,i=e.classnames,a=e.disabled,o=e.render,s=e.modalMode,l=e.source,u=e.modalSize,d=e.clearable,f=e.multiple,p=e.placeholder,m=e.embed,h=e.selectedOptions,g=e.translate,_=e.popOverContainer,v=e.modalTitle,y=e.data,b=e.mobileUI,x=e.env,S=e.themeCss,C=e.css,w=e.id,T=e.classPrefix,E=e.testIdBuilder;return F.createElement(`div`,{className:i(`PickerControl`,{"is-mobile":b},t)},m?F.createElement(`div`,{className:i(`Picker`)},this.renderBody({popOverContainer:_})):F.createElement(`div`,{className:i(`Picker`,{"Picker--single":!f,"Picker--multi":f,"is-focused":this.state.isFocused,"is-disabled":a})},F.createElement(`div`,{onClick:this.handleClick,className:i(`Picker-input`,a&&`is-disabled`,this.state.isFocused&&`is-focused`,N(n(n({},this.props),{name:`pickControlClassName`,id:w,themeCss:S||C})))},!h.length&&p?F.createElement(`div`,{className:i(`Picker-placeholder`)},g(p)):F.createElement(`div`,n({className:i(`Picker-valueWrap`)},E?.getTestId()),this.renderValues(),F.createElement(`input`,{onChange:O,value:``,ref:this.input,onKeyDown:this.handleKeyDown,onClick:this.handleFocus,onBlur:this.handleBlur,readOnly:b})),d&&!a&&h.length?F.createElement(`a`,{onClick:this.clearValue,className:i(`Picker-clear`)},F.createElement(c,{icon:`input-clear`,className:`icon`})):null,F.createElement(`span`,n({onClick:this.open,className:i(`Picker-btn`)},E?.getChild(`picker-open-btn`).getTestId()),F.createElement(c,{icon:`window-restore`,className:i(`icon`,N(n(n({},this.props),{name:`pickIconClassName`,id:w,themeCss:S||C}))),iconContent:`Picker-icon`}))),o(`modal`,{title:v&&typeof v==`string`?P(v,y):g(`Select.placeholder`),size:u,type:s,className:r,body:{children:this.renderBody},testIdBuilder:E?.getChild(`modal`)},{key:`modal`,lazyRender:!!l,onConfirm:this.handleModalConfirm,onClose:this.close,show:this.state.isOpened})),F.createElement(M,n({},this.props,{config:{themeCss:S||C,classNames:[{key:`pickControlClassName`,weights:{default:{important:!0},hover:{important:!0},focused:{important:!0,parent:`.${T}Picker.is-focused >`},disabled:{important:!0,parent:`.${T}Picker.is-disabled >`}}},{key:`pickFontClassName`},{key:`pickValueWrapClassName`,weights:{default:{important:!0}}},{key:`pickValueIconClassName`,weights:{default:{important:!0},hover:{important:!0}}},{key:`pickIconClassName`,weights:{default:{suf:` svg`}}}],id:w},env:x})))},t.propsList=[`modalTitle`,`modalMode`,`modalSize`,`pickerSchema`,`labelField`,`onChange`,`options`,`value`,`inline`,`multiple`,`embed`,`resetValue`,`placeholder`,`onQuery`],t.defaultProps={modalMode:`dialog`,multiple:!1,placeholder:`Picker.placeholder`,labelField:`label`,valueField:`value`,pickerSchema:{mode:`list`},embed:!1,overflowConfig:{maxTagCount:-1,displayPosition:[`select`,`crud`],overflowTagPopover:{placement:`top`,trigger:`hover`,showArrow:!1,offset:[0,-5]},overflowTagPopoverInCRUD:{placement:`bottom`,trigger:`hover`,showArrow:!1,offset:[0,0]}}},d([r,i(`design:type`,Function),i(`design:paramtypes`,[]),i(`design:returntype`,Object)],t.prototype,`fetchOptions`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[Object]),i(`design:returntype`,void 0)],t.prototype,`crudRef`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[]),i(`design:returntype`,void 0)],t.prototype,`open`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[]),i(`design:returntype`,void 0)],t.prototype,`close`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[Array,Object,Object,Array]),i(`design:returntype`,Promise)],t.prototype,`handleModalConfirm`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[Array]),i(`design:returntype`,Promise)],t.prototype,`handleChange`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[Object]),i(`design:returntype`,Promise)],t.prototype,`handleItemClick`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[Object]),i(`design:returntype`,void 0)],t.prototype,`handleKeyDown`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[Object]),i(`design:returntype`,void 0)],t.prototype,`handleFocus`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[]),i(`design:returntype`,void 0)],t.prototype,`handleBlur`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[]),i(`design:returntype`,void 0)],t.prototype,`handleClick`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[Object]),i(`design:returntype`,void 0)],t.prototype,`clearValue`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[Array,Array]),i(`design:returntype`,void 0)],t.prototype,`handleSelect`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[]),i(`design:returntype`,void 0)],t.prototype,`overrideCRUDProps`,null),d([r,i(`design:type`,Function),i(`design:paramtypes`,[Object]),i(`design:returntype`,void 0)],t.prototype,`renderBody`,null),d([s(),i(`design:type`,Function),i(`design:paramtypes`,[]),i(`design:returntype`,void 0)],t.prototype,`render`,null),t}(F.PureComponent),W=function(e){f(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t=d([b({type:`picker`,autoLoadOptionsFromSource:!1,sizeMutable:!1})],t),t}(U);export{W as PickerControlRenderer,U as default};