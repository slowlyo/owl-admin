const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/echarts-mbWB3xWp.js","assets/index-DAdqRbKX.js","assets/index-C-Yoix6T.css","assets/echarts-stat-B45dq0bn.js","assets/dataTool-CZMaX-wB.js","assets/bmap-BVsIa8z6.js","assets/echarts-wordcloud-VtyStMpQ.js"])))=>i.map(i=>d[i]);
import{$o as __toESM,Ai as findObjectsWithKey,Ao as __assign,Do as require_debounce,Fo as __metadata,Gr as ServiceStore,Io as __read,Ko as require_react,La as resolveVariableAndFilter,Mo as __decorate,No as __extends,Oa as createObject,Po as __generator,Qi as loadScript,Qo as __toDynamicImportESM,Qr as resizeSensor,Sr as themedLazyComponent,Ur as require_pick,Xa as require_isString,_i as dataMapping,ai as normalizeApiResponseData,ba as isPureVariable,jo as __awaiter,kr as ScopedContext,ni as isEffectiveApi,or as buildStyle,si as str2function,so as isAlive,ti as isApiOutdated,ui as require_classnames,vr as CustomStyle,wr as Renderer,xr as setThemeClassName,ya as filter,za as __vitePreload,zo as __values}from"./index-DAdqRbKX.js";var import_react=__toESM(require_react()),import_classnames=__toESM(require_classnames()),import_debounce=__toESM(require_debounce()),import_pick=__toESM(require_pick()),import_isString=__toESM(require_isString()),DEFAULT_EVENT_PARAMS=[`componentType`,`seriesType`,`seriesIndex`,`seriesName`,`name`,`dataIndex`,`data`,`dataType`,`value`,`color`],EVAL_CACHE={};function recoverFunctionType(config){[`interval`,`formatter`,`color`,`min`,`max`,`labelFormatter`,`valueFormatter`,`pageFormatter`,`optionToContent`,`contentToOption`,`animationDelay`,`animationDurationUpdate`,`animationDelayUpdate`,`animationDuration`,`position`,`sort`,`renderItem`].forEach(function(key){var e_1,_a,objects=findObjectsWithKey(config,key);try{for(var objects_1=__values(objects),objects_1_1=objects_1.next();!objects_1_1.done;objects_1_1=objects_1.next()){var object=objects_1_1.value,code=object[key];if(typeof code==`string`&&code.trim().startsWith(`function`))try{code in EVAL_CACHE||(EVAL_CACHE[code]=eval(`(`+code+`)`)),object[key]=EVAL_CACHE[code]}catch(e){console.warn(code,e)}}}catch(e_1_1){e_1={error:e_1_1}}finally{try{objects_1_1&&!objects_1_1.done&&(_a=objects_1.return)&&_a.call(objects_1)}finally{if(e_1)throw e_1.error}}})}var Chart=function(_super){__extends(Chart$1,_super);function Chart$1(props){var _this=_super.call(this,props)||this;return _this.refFn=_this.refFn.bind(_this),_this.reload=_this.reload.bind(_this),_this.reloadEcharts=(0,import_debounce.default)(_this.reloadEcharts.bind(_this),300),_this.handleClick=_this.handleClick.bind(_this),_this.dispatchEvent=_this.dispatchEvent.bind(_this),_this.loadChartMapData=_this.loadChartMapData.bind(_this),_this.mounted=!0,props.config&&_this.renderChart(props.config),_this}return Chart$1.prototype.componentDidMount=function(){return __awaiter(this,void 0,void 0,function(){var _a,api,data,initFetch,source,dispatchEvent,rendererEvent,ret;return __generator(this,function(_b){switch(_b.label){case 0:return _a=this.props,api=_a.api,data=_a.data,initFetch=_a.initFetch,source=_a.source,dispatchEvent=_a.dispatchEvent,[4,dispatchEvent(`init`,data,this)];case 1:return rendererEvent=_b.sent(),rendererEvent?.prevented||(source&&isPureVariable(source)?(ret=resolveVariableAndFilter(source,data,`| raw`),ret&&this.renderChart(ret)):api&&initFetch!==!1&&this.reload()),[2]}})})},Chart$1.prototype.componentDidUpdate=function(prevProps){var _this=this,props=this.props;if(isApiOutdated(prevProps.api,props.api,prevProps.data,props.data))this.reload();else if(props.source&&isPureVariable(props.source)){var prevRet=prevProps.source?resolveVariableAndFilter(prevProps.source,prevProps.data,`| raw`):null,ret=resolveVariableAndFilter(props.source,props.data,`| raw`);prevRet!==ret&&this.renderChart(ret||{})}else if(props.config!==prevProps.config)this.renderChart(props.config||{});else if(props.config&&props.trackExpression&&filter(props.trackExpression,props.data)!==filter(prevProps.trackExpression,prevProps.data))this.renderChart(props.config||{});else if(isApiOutdated(prevProps.mapURL,props.mapURL,prevProps.data,props.data)){var source_1=props.source,data_1=props.data,api_1=props.api,config_1=props.config;this.loadChartMapData(function(){if(source_1&&isPureVariable(source_1)){var ret$1=resolveVariableAndFilter(source_1,data_1,`| raw`);ret$1&&_this.renderChart(ret$1)}else api_1?_this.reload():config_1&&_this.renderChart(config_1||{})})}},Chart$1.prototype.componentWillUnmount=function(){this.mounted=!1,this.reloadEcharts.cancel(),clearTimeout(this.timer)},Chart$1.prototype.loadChartMapData=function(callBackFn){return __awaiter(this,void 0,void 0,function(){var _a,env,data,_b,mapName,mapURL,mapGeoResult;return __generator(this,function(_c){switch(_c.label){case 0:return _a=this.props,env=_a.env,data=_a.data,_b=this.props,mapName=_b.mapName,mapURL=_b.mapURL,mapURL&&mapName&&window.echarts?(isPureVariable(mapName)&&(mapName=resolveVariableAndFilter(mapName,data)),[4,env.fetcher(mapURL,data)]):[3,2];case 1:mapGeoResult=_c.sent(),mapGeoResult.ok||console.warn(`fetch map geo error `+mapURL),window.echarts.registerMap(mapName,mapGeoResult.data),_c.label=2;case 2:return callBackFn&&callBackFn(),[2]}})})},Chart$1.prototype.handleClick=function(ctx){return __awaiter(this,void 0,void 0,function(){var _a,onAction,clickAction,data,dispatchEvent,rendererEvent;return __generator(this,function(_b){switch(_b.label){case 0:return _a=this.props,onAction=_a.onAction,clickAction=_a.clickAction,data=_a.data,dispatchEvent=_a.dispatchEvent,[4,dispatchEvent(ctx.event,createObject(data,__assign({},(0,import_pick.default)(ctx,DEFAULT_EVENT_PARAMS))))];case 1:return rendererEvent=_b.sent(),rendererEvent?.prevented||clickAction&&onAction&&onAction(null,clickAction,createObject(data,ctx)),[2]}})})},Chart$1.prototype.dispatchEvent=function(ctx){var _a=this.props,data=_a.data,dispatchEvent=_a.dispatchEvent;dispatchEvent(ctx.event||ctx.type,createObject(data,__assign({},(0,import_pick.default)(ctx,ctx.type===`legendselectchanged`?[`name`,`selected`]:DEFAULT_EVENT_PARAMS))))},Chart$1.prototype.refFn=function(ref){var _this=this,chartRef=this.props.chartRef,_a=this.props,chartTheme=_a.chartTheme,onChartWillMount=_a.onChartWillMount,onChartUnMount=_a.onChartUnMount,env=_a.env,loadBaiduMap=_a.loadBaiduMap,data=_a.data,_b=this.props,mapURL=_b.mapURL,mapName=_b.mapName,onChartMount=this.props.onChartMount||this.onChartMount;ref?Promise.all([__vitePreload(()=>import(`./echarts-mbWB3xWp.js`),__vite__mapDeps([0,1,2])),__vitePreload(()=>import(`./echarts-stat-B45dq0bn.js`).then(__toDynamicImportESM()),__vite__mapDeps([3,1,2])),__vitePreload(()=>import(`./dataTool-CZMaX-wB.js`),__vite__mapDeps([4,1,2,0])),__vitePreload(()=>import(`./bmap-BVsIa8z6.js`),__vite__mapDeps([5,0,1,2])),__vitePreload(()=>import(`./echarts-wordcloud-VtyStMpQ.js`).then(__toDynamicImportESM()),__vite__mapDeps([6,1,2]))]).then(function(_a$1){var _b$1=__read(_a$1,2),echarts=_b$1[0],ecStat=_b$1[1];return __awaiter(_this,void 0,void 0,function(){var theme,_this$1=this;return __generator(this,function(_c){switch(_c.label){case 0:return window.echarts=echarts,window.ecStat=ecStat?.default||ecStat,mapURL&&mapName?[4,this.loadChartMapData()]:[3,2];case 1:_c.sent(),_c.label=2;case 2:return loadBaiduMap?[4,loadScript(`//api.map.baidu.com/api?v=3.0&ak=${this.props.ak}&callback={{callback}}`)]:[3,4];case 3:_c.sent(),_c.label=4;case 4:return theme=`default`,chartTheme&&(echarts.registerTheme(`custom`,chartTheme),theme=`custom`),onChartWillMount?[4,onChartWillMount(echarts)]:[3,6];case 5:_c.sent(),_c.label=6;case 6:return ecStat.transform&&(echarts.registerTransform(ecStat.transform.regression),echarts.registerTransform(ecStat.transform.histogram),echarts.registerTransform(ecStat.transform.clustering)),env.loadChartExtends?[4,env.loadChartExtends()]:[3,8];case 7:_c.sent(),_c.label=8;case 8:return this.echarts=echarts.init(ref,theme),typeof onChartMount==`string`&&(onChartMount=str2function(onChartMount,`chart`,`echarts`)),onChartMount?.(this.echarts,echarts),this.echarts.on(`click`,this.handleClick),this.echarts.on(`mouseover`,this.dispatchEvent),this.echarts.on(`legendselectchanged`,this.dispatchEvent),this.unSensor=resizeSensor(ref,function(){var _a$2,width=ref.offsetWidth,height=ref.offsetHeight;(_a$2=_this$1.echarts)==null||_a$2.resize({width,height})}),chartRef&&chartRef(this.echarts),this.renderChart(),[2]}})})}):(chartRef&&chartRef(null),this.unSensor&&this.unSensor(),this.echarts&&(onChartUnMount?.(this.echarts,window.echarts),this.echarts.dispose(),delete this.echarts)),this.ref=ref},Chart$1.prototype.doAction=function(action,data,throwErrors){var _a,_b;return throwErrors===void 0&&(throwErrors=!1),((_a=this.echarts)?.dispatchAction)?.call(_a,__assign({type:action.actionType},data))},Chart$1.prototype.reload=function(subpath,query,ctx,silent,replace){var _a,_b,_c,_d,_e,_f;return __awaiter(this,void 0,void 0,function(){var _g,api,env,store,__,result,data,ctx_1,curInterval,reason_1,_this=this;return __generator(this,function(_h){switch(_h.label){case 0:if(_g=this.props,api=_g.api,env=_g.env,store=_g.store,__=_g.translate,query)return[2,this.receive(query,void 0,replace)];if(!env||!env.fetcher||!isEffectiveApi(api,store.data))return[2];clearTimeout(this.timer),this.reloadCancel&&(this.reloadCancel(),delete this.reloadCancel,(_a=this.echarts)==null||_a.hideLoading()),(_b=this.echarts)==null||_b.showLoading(),store.markFetching(!0),_h.label=1;case 1:return _h.trys.push([1,3,,4]),[4,env.fetcher(api,store.data,{cancelExecutor:function(executor){return _this.reloadCancel=executor}})];case 2:return result=_h.sent(),isAlive(store)&&store.markFetching(!1),result.ok?(delete this.reloadCancel,data=normalizeApiResponseData(result.data),!data.series&&this.props.config?(ctx_1=createObject(this.props.data,data),this.renderChart(this.props.config,ctx_1)):this.renderChart(result.data||{}),(_e=this.echarts)==null||_e.hideLoading(),curInterval=this.props.interval,curInterval&&(0,import_isString.default)(curInterval)&&(curInterval=Number.parseInt(curInterval)),curInterval&&this.mounted&&(this.timer=setTimeout(this.reload,Math.max(curInterval,1e3))),[2,store.data]):(!api?.silent&&env.notify(`error`,api?.messages?.failed??(result.msg||__(`fetchFailed`)),result.msgTimeout===void 0?void 0:{closeButton:!0,timeout:result.msgTimeout}),[2]);case 3:return reason_1=_h.sent(),env.isCancel(reason_1)?[2]:(isAlive(store)&&store.markFetching(!1),!api?.silent&&env.notify(`error`,reason_1),(_f=this.echarts)==null||_f.hideLoading(),[3,4]);case 4:return[2]}})})},Chart$1.prototype.receive=function(data,subPath,replace){this.props.store.updateData(data,void 0,replace),this.reload()},Chart$1.prototype.renderChart=function(config,data){var _a,_b;if(config&&(this.pending=config),data&&(this.pendingCtx=data),this.echarts){var store=this.props.store,onDataFilter=this.props.onDataFilter,dataFilter=this.props.dataFilter;!onDataFilter&&typeof dataFilter==`string`&&(onDataFilter=Function(`config`,`echarts`,`data`,dataFilter)),config||=this.pending,data=data||this.pendingCtx||this.props.data,typeof config==`string`&&(config=Function(`return `+config)());try{onDataFilter&&(config=onDataFilter(config,window.echarts,data)||config)}catch(e){console.warn(e)}if(config)try{this.props.disableDataMapping||(config=dataMapping(config,data,function(key,value){return typeof value==`function`||typeof value==`string`&&value.startsWith(`function`)})),recoverFunctionType(config),isAlive(store)&&store.loading?(_a=this.echarts)==null||_a.showLoading():(_b=this.echarts)==null||_b.hideLoading(),this.reloadEcharts(config)}catch(e){console.warn(e)}}},Chart$1.prototype.reloadEcharts=function(config){var _this=this,_a;(_a=this.echarts)==null||_a.setOption(config,this.props.replaceChartOption),this.echarts.on(`finished`,function(){return __awaiter(_this,void 0,void 0,function(){var _a$1,data,dispatchEvent,rendererEvent;return __generator(this,function(_b){switch(_b.label){case 0:return _a$1=this.props,data=_a$1.data,dispatchEvent=_a$1.dispatchEvent,[4,dispatchEvent(`finished`,createObject(data,{},{echarts:{value:this.echarts,enumerable:!1,configurable:!0,writable:!0}}))];case 1:return rendererEvent=_b.sent(),rendererEvent?.prevented,[2]}})})})},Chart$1.prototype.render=function(){var _this=this,_a=this.props,className=_a.className,width=_a.width,height=_a.height,ns=_a.classPrefix,unMountOnHidden=_a.unMountOnHidden,data=_a.data,id=_a.id,wrapperCustomStyle=_a.wrapperCustomStyle,env=_a.env,themeCss=_a.themeCss,baseControlClassName=_a.baseControlClassName,style=this.props.style||{};style.width=style.width||width||`100%`,style.height=style.height||height||`300px`;var styleVar=buildStyle(style,data);return import_react.createElement(`div`,{className:(0,import_classnames.default)(`${ns}Chart`,className,setThemeClassName(__assign(__assign({},this.props),{name:`baseControlClassName`,id,themeCss})),setThemeClassName(__assign(__assign({},this.props),{name:`wrapperCustomStyle`,id,themeCss:wrapperCustomStyle}))),style:styleVar},import_react.createElement(themedLazyComponent,{unMountOnHidden,placeholder:`...`,component:function(){return import_react.createElement(`div`,{className:`${ns}Chart-content`,ref:_this.refFn})}}),import_react.createElement(CustomStyle,__assign({},this.props,{config:{wrapperCustomStyle,id,themeCss,classNames:[{key:`baseControlClassName`}]},env})))},Chart$1.defaultProps={replaceChartOption:!1,unMountOnHidden:!1},Chart$1.propsList=[],Chart$1}(import_react.Component),ChartRenderer=function(_super){__extends(ChartRenderer$1,_super);function ChartRenderer$1(props,context){var _this=_super.call(this,props)||this;return context.registerComponent(_this),_this}return ChartRenderer$1.prototype.componentWillUnmount=function(){_super.prototype.componentWillUnmount.call(this),this.context.unRegisterComponent(this)},ChartRenderer$1.prototype.setData=function(values,replace){var store=this.props.store;store.updateData(values,void 0,replace),this.renderChart(this.props.config,store.data)},ChartRenderer$1.prototype.getData=function(){return this.props.store.data},ChartRenderer$1.contextType=ScopedContext,ChartRenderer$1=__decorate([Renderer({type:`chart`,storeType:ServiceStore.name}),__metadata(`design:paramtypes`,[Object,Object])],ChartRenderer$1),ChartRenderer$1}(Chart);export{Chart,ChartRenderer};