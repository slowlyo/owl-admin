import{$o as e,Ao as t,Hi as n,Ii as r,Ko as i,La as a,Ma as o,Mo as s,No as c,Oa as l,Po as u,ai as d,ba as f,bn as p,co as m,ii as h,ni as g,oo as _,pi as v,ti as y,wr as b}from"./index-zRImlZB6.js";var x=e(i()),S,C=v.named(`MappingStore`).props({fetching:!1,errorMsg:``,valueField:`value`,map:m.frozen({})}).actions(function(e){return{load:_(function(t,n,r){var i,a,o;return u(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,3,4]),e.fetching=!0,[4,t.fetcher(n,r)];case 1:if(i=s.sent(),i.ok)a=d(i.data),e.setMap(Array.isArray(a.options)?a.options:Array.isArray(a.items)?a.items:Array.isArray(a.records)?a.records:a);else throw Error(i.msg||`fetch error`);return[3,4];case 2:return o=s.sent(),e.errorMsg=o.message,[3,4];case 3:return e.fetching=!1,[7];case 4:return[2]}})}),setMap:function(n){Array.isArray(n)&&(n=n.reduce(function(t,n){if(n==null)return t;if(o(n)){var r=Object.keys(n);r.length===1||r.length==2&&r.includes(`$$id`)?(r=r.filter(function(e){return e!==`$$id`}),t[r[0]]=n[r[0]]):r.length>1&&(t[n[e.valueField]]=n)}return t},{})),o(n)&&(e.map=t({},n))}}}),w=p(function(e){return C.create({id:n(),storeType:C.name},e.env)})((S=function(e){c(n,e);function n(t){var n=e.call(this,t)||this;return t.store.syncProps(t,void 0,[`valueField`,`map`]),n}return n.prototype.componentDidMount=function(){this.reload()},n.prototype.componentDidUpdate=function(e){var t=this.props,n=this.props,r=n.store,i=n.source,o=n.data;if(r.syncProps(t,e,i?[`valueField`]:[`valueField`,`map`]),f(i)){var s=a(e.source,e.data,`| raw`),c=a(i,o,`| raw`);s!==c&&r.setMap(c)}else y(e.source,t.source,e.data,t.data)&&this.reload()},n.prototype.reload=function(){var e=this.props,t=e.source,n=e.data,r=e.env,i=this.props.store;if(f(t))i.setMap(a(t,n,`| raw`));else if(g(t,n)){var o=h(t,`get`);o.cache=o.cache??30*1e3,i.load(r,o,n)}},n.prototype.renderSingleValue=function(e,t,n){var r=this.props,i=r.className,a=r.style,o=r.placeholder,s=r.classnames,c=r.store,l=x.createElement(`span`,{className:`text-muted`},o),u=c.map,d=void 0;e=typeof e==`string`?e.trim():e;var f=n?a:void 0;return e!==void 0&&u&&(d=this.renderValue(u,e)??(e===!0&&u[1]?u[1]:e===!1&&u[0]?u[0]:u[`*`]))!==void 0&&(l=this.renderViewValue(d,e)),x.createElement(`span`,{key:`map-${t}`,className:s(`MappingField`,i),style:f},l)},n.prototype.renderViewValue=function(e,n){var r=this.props,i=r.render,a=r.itemSchema,s=r.renderViewValue,c=r.data,u=r.labelField,d=r.name;if(s)return s(e,n);if(!a){var f=e;return o(e)&&(f=u===void 0||u===``?e.hasOwnProperty(`type`)?t({name:d},f):e.label:e[u||`label`]),o(f)&&f.type===`tag`&&!o(f.label)&&f.label!=null?i(`mapping-tag`,f,{value:null}):i(`tpl`,f)}return i(`mappingItemSchema`,a,t({data:l(c,o(e)?e:{item:e})},a?.type===`tag`?{value:null}:{}))},n.prototype.renderValue=function(e,t){var n=this.props.renderValue;return n?n(e,t):e[t]},n.prototype.render=function(){var e=this,t=this.props,n=t.style,i=t.defaultValue,o=t.data,s=r(this.props);return i&&f(i)&&i===s&&(s=a(i,o,`| raw`)),Array.isArray(s)?x.createElement(`span`,{style:n},s.map(function(t,n){return e.renderSingleValue(t,n)})):this.renderSingleValue(s,0,!0)},n}(x.Component),S.defaultProps={placeholder:`-`,map:{"*":`通配值`}},S)),T=function(e){c(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.render=function(){return x.createElement(w,t({},this.props))},n=s([b({type:`mapping`,alias:[`map`],name:`mapping`})],n),n}(x.Component);export{w as MappingField,T as MappingFieldRenderer,C as Store};