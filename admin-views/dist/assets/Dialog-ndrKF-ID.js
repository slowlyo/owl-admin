import{$o as e,Ao as t,Ar as n,Ci as r,Fo as i,Gn as a,Go as o,Hi as s,Hn as c,Io as l,Kn as u,Ko as d,Lo as f,Mo as p,No as m,Oa as h,Po as g,Ro as _,Yi as v,Zi as y,jo as b,kr as x,lo as S,so as C,vr as w,wr as T,xr as E,ya as D,zr as O}from"./index-DAdqRbKX.js";var k=e(d()),A=o(),j=function(e){m(n,e);function n(t){var n=e.call(this,t)||this;n.isDead=!1,n.$$id=s(),t.store.setEntered(!!t.show),n.handleSelfClose=n.handleSelfClose.bind(n),n.handleSelfScreen=n.handleSelfScreen.bind(n),n.handleAction=n.handleAction.bind(n),n.handleActionSensor=n.handleActionSensor.bind(n),n.handleDialogConfirm=n.handleDialogConfirm.bind(n),n.handleDialogClose=n.handleDialogClose.bind(n),n.handleDrawerConfirm=n.handleDrawerConfirm.bind(n),n.handleDrawerClose=n.handleDrawerClose.bind(n),n.handleEntered=n.handleEntered.bind(n),n.handleExited=n.handleExited.bind(n),n.handleFormInit=n.handleFormInit.bind(n),n.handleFormSaved=n.handleFormSaved.bind(n),n.handleFormChange=n.handleFormChange.bind(n),n.handleChildFinished=n.handleChildFinished.bind(n);var r=t.store;return n.reaction=S(function(){return`${r.loading}${r.error}`},function(){return n.forceUpdate()}),n}return n.prototype.componentWillUnmount=function(){this.reaction&&this.reaction(),this.isDead=!0},n.prototype.buildActions=function(){var e=this.props,t=e.actions,n=e.confirm,r=e.translate,i=e.testIdBuilder;if(t!==void 0)return t;var a=[];return a.push({type:`button`,testIdBuilder:i?.getChild(`cancel`),actionType:`cancel`,label:r(`cancel`)}),n&&a.push({type:`button`,testIdBuilder:i?.getChild(`confirm`),actionType:`confirm`,label:r(`confirm`),primary:!0}),a},n.prototype.handleSelfScreen=function(e){e.preventDefault(),e.stopPropagation();var t=this.props.store;t.setFullScreen(!t.isFullscreen)},n.prototype.handleSelfClose=function(e,t){return b(this,void 0,void 0,function(){var e,n,r,i,a;return g(this,function(o){switch(o.label){case 0:return e=this.props,n=e.onClose,r=e.store,i=e.dispatchEvent,[4,i(`cancel`,this.props.data)];case 1:return a=o.sent(),a?.prevented?[2]:a?.pendingPromise.length?[4,a.allDone()]:[3,3];case 2:o.sent(),o.label=3;case 3:return r.updateMessage(),r.setFullScreen(!1),n(t),[2]}})})},n.prototype.handleActionSensor=function(e){var t=this,n=this.props.store,r=n.busying;n.markBusying(!0),n.updateMessage(),e.then(function(){n.markBusying(r)}).catch(function(e){t.isDead||(n.updateMessage(e.message,!0),n.markBusying(r))})},n.prototype.handleAction=function(e,t,n){var r=this.props,i=r.store,a=r.onAction;t.type===`reset`?i.reset():t.actionType===`cancel`?this.handleSelfClose():a&&a(e,t,n)},n.prototype.handleDialogConfirm=function(e,t){var n=[...arguments].slice(2),r=this.props.store;t.mergeData&&e.length===1&&e[0]&&r.updateData(e[0]);var i=r.action.dialog;i&&i.onConfirm&&i.onConfirm.apply(i,_([e,t],l(n),!1))===!1||r.closeDialog(!0,e)},n.prototype.handleDialogClose=function(){var e=[...arguments],t=this.props.store,n=t.action.dialog;n.onClose&&n.onClose.apply(n,_([],l(e),!1))===!1||t.closeDialog(e[1])},n.prototype.handleDrawerConfirm=function(e,t){var n=[...arguments].slice(2),r=this.props.store;t.mergeData&&e.length===1&&e[0]&&r.updateData(e[0]);var i=r.action.drawer;i&&i.onConfirm&&i.onConfirm.apply(i,_([e,t],l(n),!1))===!1||r.closeDrawer(!0,e)},n.prototype.handleDrawerClose=function(){var e=[...arguments],t=this.props.store,n=t.action.drawer;n.onClose&&n.onClose.apply(n,_([],l(e),!1))===!1||t.closeDrawer.apply(t,_([],l(e),!1))},n.prototype.handleEntered=function(){var e=this.props,t=e.lazySchema,n=e.store;n.setEntered(!0),n.markBusying(!1),typeof t==`function`&&n.setSchema(t(this.props));var r=document.activeElement;if(r){var i=(0,A.findDOMNode)(this);i&&!i.contains(r)&&r.blur()}},n.prototype.handleExited=function(){var e=this.props,t=e.lazySchema,n=e.store,r=e.statusStore;r&&C(r)&&r.resetAll(),C(n)&&(n.reset(),n.clearMessage(),n.markBusying(!1),n.setEntered(!1),typeof t==`function`&&n.setSchema(``))},n.prototype.handleFormInit=function(e){this.props.store.setFormData(e)},n.prototype.handleFormChange=function(e,t){var n=this.props.store;if(typeof t==`string`){n.changeValue(t,e);return}n.setFormData(e)},n.prototype.handleFormSaved=function(e,n){this.props.store.setFormData(t(t({},e),n))},n.prototype.handleChildFinished=function(e,t){},n.prototype.openFeedback=function(e,t){var n=this;return new Promise(function(r){var i=n.props.store;i.setCurrentAction({type:`button`,actionType:`dialog`,dialog:e},n.props.resolveDefinitions),i.openDialog(t,void 0,function(e){r(e)},n.context)})},n.prototype.getPopOverContainer=function(){return(0,A.findDOMNode)(this).querySelector(`.${this.props.classPrefix}Modal-content`)},n.prototype.renderBody=function(e,n){var r=this,i=this.props,a=i.render,o=i.store;if(Array.isArray(e))return e.map(function(e,t){return r.renderBody(e,t)});var s={key:n,disabled:e&&e.disabled||o.loading,onAction:this.handleAction,onFinished:this.handleChildFinished,popOverContainer:this.getPopOverContainer,onChange:this.handleFormChange,onInit:this.handleFormInit,onSaved:this.handleFormSaved,onActionSensor:this.handleActionSensor,btnDisabled:o.loading,syncLocation:!1};if(!e.type)return a(`body${n?`/${n}`:``}`,e,s);var c=e;return c.type===`form`&&(c=t({mode:`horizontal`,wrapWithPanel:!1,submitText:null},c)),a(`body${n?`/${n}`:``}`,c,s)},n.prototype.renderFooter=function(){var e=this,t=this.buildActions(),n=this.props.hideActions;if(!t||!t.length||n)return null;var r=this.props,i=r.store,a=r.render,o=r.env,s=r.classnames,l=r.showErrorMsg,u=r.showLoading,d=r.show,f=r.dialogFooterClassName;return k.createElement(`div`,{className:s(`Modal-footer`,f)},u!==!1&&i.loading||l!==!1&&i.error?k.createElement(`div`,{className:s(`Dialog-info`),key:`info`},u===!1?null:k.createElement(c,{size:`sm`,key:`info`,show:i.loading}),!o.forceSilenceInsideError&&i.error&&l!==!1?k.createElement(`span`,{className:s(`Dialog-error`)},i.msg):null):null,t.map(function(t,n){return a(`action/${n}`,t,{data:i.formData,onAction:e.handleAction,onActionSensor:void 0,btnDisabled:i.loading,key:n,disabled:t.disabled||i.loading||!d})}))},n.prototype.render=function(){var e=this.props.store,n=t(t({},this.props),e.schema),r=n.className,i=n.style,o=n.size,s=n.height,l=n.width,d=n.closeOnEsc,p=n.closeOnOutside,m=n.title,h=n.render,g=n.header,_=n.body,v=n.bodyClassName,y=n.headerClassName,b=n.show,x=n.lazyRender,S=n.lazySchema,C=n.wrapperComponent,T=n.showCloseButton,O=n.env,A=n.classnames,j=n.classPrefix,M=n.translate,N=n.loadingConfig,P=n.overlay,F=n.dialogType,I=n.cancelText,L=n.confirmText,R=n.confirmBtnLevel,z=n.cancelBtnLevel;n.popOverContainer,n.inDesign;var B=n.themeCss,V=n.allowFullscreen,H=n.draggable,U=n.id,W=f(n,`className.style.size.height.width.closeOnEsc.closeOnOutside.title.render.header.body.bodyClassName.headerClassName.show.lazyRender.lazySchema.wrapperComponent.showCloseButton.env.classnames.classPrefix.translate.loadingConfig.overlay.dialogType.cancelText.confirmText.confirmBtnLevel.cancelBtnLevel.popOverContainer.inDesign.themeCss.allowFullscreen.draggable.id`.split(`.`)),G=C||a;return k.createElement(G,t({},W,{classPrefix:j,className:A(r),style:i,draggable:e.isFullscreen?!1:H,size:o,height:s,width:l,isFullscreen:e.isFullscreen,modalClassName:A(E(t(t({},this.props),{name:`dialogClassName`,id:U,themeCss:B})),e.isFullscreen?`Modal-fullScreen`:``),modalMaskClassName:E(t(t({},this.props),{name:`dialogMaskClassName`,id:U,themeCss:B})),backdrop:`static`,onHide:this.handleSelfClose,keyboard:d&&!e.loading,closeOnEsc:d,closeOnOutside:!e.dialogOpen&&p,show:b,onEntered:this.handleEntered,onExited:this.handleExited,container:O?.getModalContainer,enforceFocus:!1,disabled:e.loading,overlay:P,dialogType:F,cancelText:I,confirmText:L,confirmBtnLevel:R,cancelBtnLevel:z}),m&&typeof m==`string`?k.createElement(`div`,{className:A(`Modal-header`,y,E(t(t({},this.props),{name:`dialogHeaderClassName`,id:U,themeCss:B})))},T!==!1&&!e.loading?k.createElement(`a`,{"data-tooltip":M(`Dialog.close`),"data-position":`left`,onClick:this.handleSelfClose,className:A(`Modal-close`)},k.createElement(u,{icon:`close`,className:`icon`,iconContent:`Dialog-close`})):null,V?k.createElement(`a`,{"data-tooltip":e.isFullscreen?M(`Dialog.reset`):M(`Dialog.screen`),"data-position":`left`,onClick:this.handleSelfScreen,className:A(`Modal-close Modal-screen`)},k.createElement(u,{icon:e.isFullscreen?`un-fullscreen`:`full-screen`,className:`icon`})):null,k.createElement(`div`,{className:A(`Modal-title`,E(t(t({},this.props),{name:`dialogTitleClassName`,id:U,themeCss:B})))},D(M(m),e.formData))):m?k.createElement(`div`,{className:A(`Modal-header`,y,E(t(t({},this.props),{name:`dialogHeaderClassName`,id:U,themeCss:B})))},T!==!1&&!e.loading?k.createElement(`a`,{"data-tooltip":M(`Dialog.close`),onClick:this.handleSelfClose,className:A(`Modal-close`)},k.createElement(u,{icon:`close`,className:`icon`,iconContent:`Dialog-close`})):null,V?k.createElement(`a`,{"data-tooltip":e.isFullscreen?M(`Dialog.reset`):M(`Dialog.screen`),"data-position":`left`,onClick:this.handleSelfScreen,className:A(`Modal-close Modal-screen`)},k.createElement(u,{icon:e.isFullscreen?`un-fullscreen`:`full-screen`,className:`icon`})):null,h(`title`,m,{data:e.formData,onAction:this.handleAction,onActionSensor:void 0,btnDisabled:e.loading})):T!==!1&&!e.loading?k.createElement(`a`,{"data-tooltip":M(`Dialog.close`),onClick:this.handleSelfClose,className:A(`Modal-close`)},k.createElement(u,{icon:`close`,className:`icon`,iconContent:`Dialog-close`})):null,g?h(`header`,g,{data:e.formData,onAction:this.handleAction,onActionSensor:void 0,btnDisabled:e.loading}):null,!e.entered&&x||S&&!_?k.createElement(`div`,{className:A(`Modal-body`,v,E(t(t({},this.props),{name:`dialogBodyClassName`,id:U,themeCss:B}))),role:`dialog-body`},k.createElement(c,{overlay:!0,show:!0,size:`lg`,loadingConfig:N})):_?k.createElement(`div`,{className:A(`Modal-body`,v,E(t(t({},this.props),{name:`dialogBodyClassName`,id:U,themeCss:B}))),role:`dialog-body`},this.renderBody(_,`body`),k.createElement(w,t({},this.props,{config:{themeCss:B,classNames:[{key:`dialogClassName`},{key:`dialogMaskClassName`},{key:`dialogHeaderClassName`},{key:`dialogTitleClassName`},{key:`dialogBodyClassName`},{key:`dialogFooterClassName`}],id:U},env:O}))):null,_?this.renderFooter():null,_?h(`drawer`,t(t({},e.drawerSchema),{type:`drawer`}),{key:`drawer`,data:e.drawerData,onConfirm:this.handleDrawerConfirm,onClose:this.handleDrawerClose,show:e.drawerOpen,onAction:this.handleAction}):null,_?h(`dialog`,t(t({},e.dialogSchema),{type:`dialog`}),{key:`dialog`,data:e.dialogData,onConfirm:this.handleDialogConfirm,onClose:this.handleDialogClose,show:e.dialogOpen,onAction:this.handleAction}):null)},n.propsList=[`title`,`size`,`closeOnEsc`,`closeOnOutside`,`children`,`bodyClassName`,`headerClassName`,`confirm`,`onClose`,`onConfirm`,`show`,`body`,`showCloseButton`,`showErrorMsg`,`actions`,`popOverContainer`,`overlay`,`draggable`,`allowFullscreen`],n.defaultProps={title:`Dialog.title`,bodyClassName:``,confirm:!0,show:!1,lazyRender:!1,showCloseButton:!0,wrapperComponent:a,closeOnEsc:!1,closeOnOutside:!1,showErrorMsg:!0},p([r,i(`design:type`,Function),i(`design:paramtypes`,[]),i(`design:returntype`,void 0)],n.prototype,`getPopOverContainer`,null),n}(k.Component),M=function(e){m(r,e);function r(t,n){var r=e.call(this,t)||this;return n.registerComponent(r),r}return r.prototype.componentWillUnmount=function(){this.context.unRegisterComponent(this),e.prototype.componentWillUnmount.call(this),clearTimeout(this.clearErrorTimer)},r.prototype.tryChildrenToHandle=function(e,n,r){var i=this,a=this.context,o=[],s=this.props,c=s.onConfirm,u=s.store;if(e.target&&o.push.apply(o,_([],l(e.target.split(`,`).map(function(e){return a.getComponentByName(e)}).filter(function(e){return e&&e.doAction})),!1)),e?.isolateScope!==!0&&!o.length)for(var d=a.getComponents().filter(function(e){return!~[`drawer`,`dialog`].indexOf(e.props.type)}).concat();d.length;){var f=d.pop();if(~[`crud`,`form`,`wizard`].indexOf(f.props.type)){o.push(f);break}else if(~[`drawer`,`dialog`].indexOf(f.props.type))continue;else ~[`page`,`service`].indexOf(f.props.type)&&d.unshift.apply(d,f.context.getComponents())}return o.length?(u.markBusying(!0),u.updateMessage(),Promise.all(o.map(function(r){return r.doAction(t(t({},e),{from:i.$$id}),n,!0)})).then(function(t){(e.type===`submit`||e.actionType===`submit`||e.actionType===`confirm`)&&e.close!==!1&&!o.some(function(e){return e.props.closeDialogOnSubmit===!1})?c&&c(t,r||e,n,o):e.close&&(e.close===!0?i.handleSelfClose():i.closeTarget(e.close)),u.markBusying(!1)}).catch(function(e){i.isDead||(u.updateMessage(e.message,!0),u.markBusying(!1),clearTimeout(i.clearErrorTimer),i.clearErrorTimer=setTimeout(function(){i.isDead||u.updateMessage(``)},3e3))}),!0):!1},r.prototype.doAction=function(e,t,n){this.handleAction(void 0,e,t)},r.prototype.handleAction=function(e,r,i,a,o,s){return a===void 0&&(a=!1),b(this,void 0,void 0,function(){var c,l,u,d,f,p,m,_,v,x,S,C,w=this;return g(this,function(T){switch(T.label){case 0:return c=this.props,l=c.onAction,u=c.store,d=c.onConfirm,f=c.env,p=c.dispatchEvent,m=c.onClose,_=c.show,r.from===this.$$id||!_?[2,l?l(e,r,i,a,o||this.context):!1]:s?.pendingPromise.length?[4,s.allDone()]:[3,2];case 1:T.sent(),T.label=2;case 2:return v=this.context,r.type===`reset`?(u.setCurrentAction(r,this.props.resolveDefinitions),u.reset(),[3,19]):[3,3];case 3:return r.actionType===`close`||r.actionType===`cancel`?[4,p(`cancel`,h(this.props.data,i))]:[3,7];case 4:return x=T.sent(),x?.prevented?[2]:x?.pendingPromise.length?[4,x.allDone()]:[3,6];case 5:T.sent(),T.label=6;case 6:return u.setCurrentAction(r,this.props.resolveDefinitions),u.updateMessage(),m(),r.close&&(r.close===!0?this.handleSelfClose():this.closeTarget(r.close)),[3,19];case 7:return r.actionType===`confirm`?[4,p(`confirm`,h(this.props.data,i))]:[3,11];case 8:return S=T.sent(),S?.prevented?[2]:S?.pendingPromise.length?[4,S.allDone()]:[3,10];case 9:T.sent(),T.label=10;case 10:return u.setCurrentAction(r,this.props.resolveDefinitions),C=this.tryChildrenToHandle(t(t({},r),{actionType:`submit`}),i,r),C||(u.updateMessage(),r.close!==!1&&m(!0)),[3,19];case 11:return r.actionType===`next`||r.actionType===`prev`?(u.setCurrentAction(r,this.props.resolveDefinitions),r.type===`submit`?this.tryChildrenToHandle(t(t({},r),{actionType:`submit`,close:!0}),i,r)||this.handleSelfClose(void 0,!0):d([i],r,i,[]),[3,19]):[3,12];case 12:return r.actionType===`dialog`?(u.setCurrentAction(r,this.props.resolveDefinitions),[2,new Promise(function(e){u.openDialog(i,void 0,function(t,n){var i;(i=r.callback)==null||i.call(r,t,n),e({confirmed:t,value:n})},o||w.context)})]):[3,13];case 13:return r.actionType===`drawer`?(u.setCurrentAction(r,this.props.resolveDefinitions),[2,new Promise(function(e){u.openDrawer(i,void 0,function(t,n){var i;(i=r.callback)==null||i.call(r,t,n),e({confirmed:t,value:n})})})]):[3,14];case 14:return r.actionType===`reload`?(u.setCurrentAction(r,this.props.resolveDefinitions),r.target&&v.reload(r.target,i),(r.close||r.type===`submit`)&&(this.handleSelfClose(void 0,r.type===`submit`),r.close&&typeof r.close==`string`&&this.closeTarget(r.close)),[3,19]):[3,15];case 15:return!r.from&&this.tryChildrenToHandle(r,i)?[3,19]:[3,16];case 16:return r.actionType===`ajax`?(u.setCurrentAction(r,this.props.resolveDefinitions),[2,u.saveRemote(r.api,i,{successMessage:r.messages&&r.messages.success,errorMessage:r.messages&&r.messages.failed}).then(function(){return b(w,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return r.feedback&&y(r.feedback,u.data)?[4,this.openFeedback(r.feedback,u.data)]:[3,2];case 1:t.sent(),t.label=2;case 2:return e=r.redirect&&D(r.redirect,u.data),e&&f.jumpTo(e,r,u.data),r.reload&&this.reloadTarget(n(r.reload,u.data),u.data),r.close&&(r.close===!0?this.handleSelfClose():this.closeTarget(r.close)),[2]}})})}).catch(function(e){if(a||r.countDown)throw e})]):[3,17];case 17:return l?[4,l(e,t(t({},r),{close:!1}),i,a,o||this.context)]:[3,19];case 18:T.sent(),r.close&&(r.close===!0?this.handleSelfClose():this.closeTarget(r.close)),T.label=19;case 19:return[2]}})})},r.prototype.handleChildFinished=function(e,t){if(!(t&&t.from===this.$$id||t.close===!1)){var n=this.context.getComponents().filter(function(e){return!~[`drawer`,`dialog`,`action`,`button`,`submit`,`reset`].indexOf(e.props.type)}),r=this.props.onConfirm,i=this.props.onClose;n.length===1&&(n[0].props.type===`form`||n[0].props.type===`wizard`)&&(t.close===!0||n[0].props.closeDialogOnSubmit!==!1)?r&&r([e],t,{},n):t.close===!0&&i()}},r.prototype.handleDialogConfirm=function(t,n){var r=[...arguments].slice(2);e.prototype.handleDialogConfirm.apply(this,_([t,n],l(r),!1));var i=this.props.store,a=i.getDialogScoped()||this.context,o=i.action,s=n.reload??o.reload;s?a.reload(s,i.data):a.component!==this&&a.component?.reload?a.component.reload():this.context.getComponents().filter(function(e){return e.props.type===`crud`}).forEach(function(e){return e.reload&&e.reload()})},r.prototype.handleDrawerConfirm=function(t,n){for(var r=this,i=[],a=2;a<arguments.length;a++)i[a-2]=arguments[a];e.prototype.handleDrawerConfirm.call(this,t,n);var o=this.props.store,s=o.getDialogScoped()||this.context,c=o.action,l=n.reload??c.reload;setTimeout(function(){l?s.reload(l,o.data):s.component!==r&&s.component?.reload?s.component.reload():r.context.getComponents().filter(function(e){return e.props.type===`crud`}).forEach(function(e){return e.reload&&e.reload()})},300)},r.prototype.reloadTarget=function(e,t){this.context.reload(e,t)},r.prototype.closeTarget=function(e){this.context.close(e)},r.prototype.setData=function(e,t){return this.props.store.updateData(e,void 0,t)},r.prototype.getData=function(){return this.props.store.data},r.contextType=x,r=p([T({type:`dialog`,storeType:O.name,storeExtendsData:!1,isolateScope:!0,shouldSyncSuperStore:function(e,t,n){return!!((e.dialogOpen||t.show)&&(t.show!==n.show||v(n.data,t.data)))}}),i(`design:paramtypes`,[Object,Object])],r),r}(j);export{M as DialogRenderer,j as default};