import{t as N,l as m,G as j,H as A,x as R,a4 as S,W as U,z as p,ad as M,ae as W,D as y,Q as b,T as n,U as D,E as z,dV as B,dW as T,aK as J}from"./index-BnZOs00e.js";var P=function(c){N(a,c);function a(){var e=c!==null&&c.apply(this,arguments)||this;return e.IFrameRef=m.createRef(),e.state={width:e.props.width||"100%",height:e.props.height||"100%"},e}return a.prototype.componentDidMount=function(){window.addEventListener("message",this.onMessage)},a.prototype.componentDidUpdate=function(e){var r=this.props.data;r!==e.data?this.postMessage("update",r):(this.props.width!==e.width||this.props.height!==e.height)&&this.setState({width:this.props.width||"100%",height:this.props.height||"100%"})},a.prototype.componentWillUnmount=function(){window.removeEventListener("message",this.onMessage)},a.prototype.validateURL=function(e){return e&&typeof e=="string"&&/^data:([a-zA-Z0-9]+\/[a-zA-Z0-9]+);base64,.*/.test(e)?!0:!(e&&typeof e=="string"&&!/^(\.\/|\.\.\/|\/|(blob\:)?https?\:\/\/|\/\/)/.test(e))},a.prototype.onMessage=function(e){var r,s,t;return j(this,void 0,void 0,function(){var i,u,v,_,w,o,C,d,f,g,l;return A(this,function(h){switch(h.label){case 0:return i=this.props,u=i.events,v=i.onEvent,_=i.onAction,w=i.data,typeof((r=e==null?void 0:e.data)===null||r===void 0?void 0:r.type)!="string"?[2]:(o=J(e.data.type.split(":"),2),C=o[0],d=o[1],C!=="amis"||!d?[2]:d==="resize"&&e.data.data?(this.setState({width:e.data.data.width||"100%",height:e.data.data.height||"100%"}),[3,4]):[3,1]);case 1:return f=v==null?void 0:v[d],f&&(!((s=f.actions)===null||s===void 0)&&s.length)?(g=B(d,{env:(t=this.props)===null||t===void 0?void 0:t.env,nativeEvent:e,data:S(w,e.data.data),scoped:this.context}),[4,T(f.actions,this,g)]):[3,3];case 2:if(h.sent(),g.prevented)return[2];h.label=3;case 3:u&&(l=u[d],l&&_(e,l,S(w,e.data.data))),h.label=4;case 4:return[2]}})})},a.prototype.onLoad=function(){var e=this.props,r=e.src,s=e.data;r&&this.postMessage("init",s)},a.prototype.reload=function(e,r){if(r)return this.receive(r);var s=this.props,t=s.src,i=s.data;t&&(this.IFrameRef.current.src=R(t,i,"| raw"))},a.prototype.receive=function(e){var r=this.props,s=r.src,t=r.data,i=S(t,e);this.postMessage("receive",i),U(s,s,t,i)&&(this.IFrameRef.current.src=R(s,i,"| raw"))},a.prototype.postMessage=function(e,r){var s,t;(t=(s=this.IFrameRef.current)===null||s===void 0?void 0:s.contentWindow)===null||t===void 0||t.postMessage({type:"amis:".concat(e),data:JSON.parse(JSON.stringify(r))},"*")},a.prototype.render=function(){var e=this.state,r=e.width,s=e.height,t=this.props,i=t.className,u=t.src,v=t.name,_=t.frameBorder,w=t.data,o=t.style,C=t.allow,d=t.sandbox,f=t.referrerpolicy,g=t.translate,l=t.id,h=t.wrapperCustomStyle,x=t.env,I=t.themeCss;t.baseControlClassName;var O=t.inDragging,L=t.classnames,E={};r!==void 0&&(E.width=r),s!==void 0&&(E.height=s),o=p(p({},E),o),O&&(o=p(p({},o),{pointerEvents:"none"}));var F=u?R(u,w,"| raw"):void 0;return this.validateURL(F)?(location.protocol==="https:"&&F&&F.startsWith("http://")&&x.notify("error",g("Iframe.invalidProtocol")),m.createElement(m.Fragment,null,m.createElement("iframe",{name:v,className:L("IFrame",i,M(p(p({},this.props),{name:"baseControlClassName",id:l,themeCss:I})),M(p(p({},this.props),{name:"wrapperCustomStyle",id:l,themeCss:h}))),frameBorder:_,style:o,ref:this.IFrameRef,onLoad:this.onLoad,src:F,allow:C,referrerPolicy:f,sandbox:d}),m.createElement(W,p({},this.props,{config:{wrapperCustomStyle:h,id:l,themeCss:I,classNames:[{key:"baseControlClassName"}]},env:x})))):m.createElement("p",null,g("Iframe.invalid"))},a.propsList=["src","className"],a.defaultProps={className:"",frameBorder:0},y([b,n("design:type",Function),n("design:paramtypes",[MessageEvent]),n("design:returntype",Promise)],a.prototype,"onMessage",null),y([b,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",void 0)],a.prototype,"onLoad",null),y([b,n("design:type",Function),n("design:paramtypes",[Object,Object]),n("design:returntype",void 0)],a.prototype,"reload",null),y([b,n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",void 0)],a.prototype,"receive",null),y([b,n("design:type",Function),n("design:paramtypes",[String,Object]),n("design:returntype",void 0)],a.prototype,"postMessage",null),a}(m.Component),Z=function(c){N(a,c);function a(e,r){var s=c.call(this,e)||this,t=r;return t.registerComponent(s),s}return a.prototype.componentWillUnmount=function(){var e=this.context;e.unRegisterComponent(this),c.prototype.componentWillUnmount.call(this)},a.contextType=D,a=y([z({type:"iframe"}),n("design:paramtypes",[Object,Object])],a),a}(P);export{Z as IFrameRenderer,P as default};
