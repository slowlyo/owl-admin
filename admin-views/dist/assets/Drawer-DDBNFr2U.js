import{$o as e,Ao as t,Ar as n,Ci as r,Dn as i,Fo as a,Go as o,Hi as s,Hn as c,Io as l,Ko as u,Lo as d,Mo as f,No as p,Oa as m,Po as h,Ro as g,Yi as _,Zi as v,jo as y,kr as b,lo as x,so as S,vr as C,wr as w,xr as T,ya as E,zr as D}from"./index-C4Pf1uQ-.js";var O=e(u()),k=o(),A=function(e){p(n,e);function n(t){var n=e.call(this,t)||this;n.$$id=s(),t.store.setEntered(!!t.show),n.handleSelfClose=n.handleSelfClose.bind(n),n.handleAction=n.handleAction.bind(n),n.handleActionSensor=n.handleActionSensor.bind(n),n.handleDrawerConfirm=n.handleDrawerConfirm.bind(n),n.handleDrawerClose=n.handleDrawerClose.bind(n),n.handleDialogConfirm=n.handleDialogConfirm.bind(n),n.handleDialogClose=n.handleDialogClose.bind(n),n.handleChildFinished=n.handleChildFinished.bind(n),n.handleEntered=n.handleEntered.bind(n),n.handleExited=n.handleExited.bind(n),n.handleFormInit=n.handleFormInit.bind(n),n.handleFormChange=n.handleFormChange.bind(n),n.handleFormSaved=n.handleFormSaved.bind(n);var r=t.store;return n.reaction=x(function(){return`${r.loading}${r.error}`},function(){return n.forceUpdate()}),n}return n.prototype.componentWillUnmount=function(){this.reaction&&this.reaction(),clearTimeout(this.clearErrorTimer)},n.prototype.buildActions=function(){var e=this.props,t=e.actions,n=e.confirm,r=e.translate,i=e.testIdBuilder;if(t!==void 0)return t;var a=[];return a.push({type:`button`,testIdBuilder:i?.getChild(`cancel`),actionType:`close`,label:r(`cancel`)}),n&&a.push({type:`button`,actionType:`confirm`,testIdBuilder:i?.getChild(`confirm`),label:r(`confirm`),primary:!0}),a},n.prototype.handleSelfClose=function(){return y(this,void 0,void 0,function(){var e,t,n,r,i;return h(this,function(a){switch(a.label){case 0:return e=this.props,t=e.onClose,n=e.store,r=e.dispatchEvent,n.dialogOpen!==!1||n.drawerOpen!==!1?[2]:[4,r(`cancel`,this.props.data)];case 1:return i=a.sent(),i?.prevented?[2]:i?.pendingPromise.length?[4,i.allDone()]:[3,3];case 2:a.sent(),a.label=3;case 3:return n.updateMessage(),t(),[2]}})})},n.prototype.handleActionSensor=function(e){var t=this.props.store,n=t.busying;t.markBusying(!0),t.updateMessage(),e.then(function(){t.markBusying(n)}).catch(function(e){t.updateMessage(e.message,!0),t.markBusying(n)})},n.prototype.handleAction=function(e,t,n){var r=this.props,i=r.onClose,a=r.onAction;t.actionType===`close`||t.actionType===`cancel`?i():a&&a(e,t,n)},n.prototype.handleDrawerConfirm=function(e,t){var n=[...arguments].slice(2),r=this.props.store;t.mergeData&&e.length===1&&e[0]&&r.updateData(e[0]);var i=r.action.drawer;i.onConfirm&&i.onConfirm.apply(i,g([e,t],l(n),!1))===!1||r.closeDrawer(!0,e)},n.prototype.handleDrawerClose=function(){var e=[...arguments],t=this.props.store,n=t.action.drawer;n.onClose&&n.onClose.apply(n,g([],l(e),!1))===!1||t.closeDrawer.apply(t,g([],l(e),!1))},n.prototype.handleDialogConfirm=function(e,t){var n=[...arguments].slice(2),r=this.props.store;t.mergeData&&e.length===1&&e[0]&&r.updateData(e[0]);var i=r.action.dialog;i.onConfirm&&i.onConfirm.apply(i,g([e,t],l(n),!1))===!1||r.closeDialog(!0,e)},n.prototype.handleDialogClose=function(){var e=[...arguments],t=this.props.store,n=t.action.dialog;n.onClose&&n.onClose.apply(n,g([],l(e),!1))===!1||t.closeDialog(e[1])},n.prototype.handleChildFinished=function(e,t){},n.prototype.handleFormInit=function(e){this.props.store.setFormData(e)},n.prototype.handleFormChange=function(e,t){var n=this.props.store;if(typeof t==`string`){n.changeValue(t,e);return}n.setFormData(e)},n.prototype.handleFormSaved=function(e,n){this.props.store.setFormData(t(t({},e),n))},n.prototype.handleEntered=function(){var e=this.props,t=e.lazySchema,n=e.store;n.setEntered(!0),n.markBusying(!1),typeof t==`function`&&n.setSchema(t(this.props))},n.prototype.handleExited=function(){var e=this.props,t=e.lazySchema,n=e.store,r=e.statusStore;r&&S(r)&&r.resetAll(),S(n)&&(n.reset(),n.clearMessage(),n.markBusying(!1),n.setEntered(!1),typeof t==`function`&&n.setSchema(``))},n.prototype.getPopOverContainer=function(){return(0,k.findDOMNode)(this).querySelector(`.${this.props.classPrefix}Drawer-content`)},n.prototype.renderBody=function(e,n){var r=this,i=this.props,a=i.render,o=i.store;if(Array.isArray(e))return e.map(function(e,t){return r.renderBody(e,t)});var s=e,c={key:n,disabled:o.loading,onAction:this.handleAction,onFinished:this.handleChildFinished,popOverContainer:this.getPopOverContainer,onChange:this.handleFormChange,onInit:this.handleFormInit,onSaved:this.handleFormSaved,onActionSensor:this.handleActionSensor,btnDisabled:o.loading,inDragging:o.inDragging,syncLocation:!1};return s.type===`form`&&(s=t({mode:`horizontal`,wrapWithPanel:!1,submitText:null},s)),a(`body${n?`/${n}`:``}`,s,c)},n.prototype.renderFooter=function(){var e=this,n=this.buildActions(),r=this.props.hideActions;if(!n||!n.length||r)return null;var i=this.props,a=i.store,o=i.render,s=i.env,l=i.classnames,u=i.showErrorMsg,d=i.footerClassName,f=i.id,p=i.themeCss;return O.createElement(`div`,{className:l(`Drawer-footer`,d,T(t(t({},this.props),{name:`drawerFooterClassName`,id:f,themeCss:p})))},a.loading||a.error?O.createElement(`div`,{className:l(`Drawer-info`)},O.createElement(c,{size:`sm`,key:`info`,show:a.loading}),!s.forceSilenceInsideError&&u&&a.error?O.createElement(`span`,{className:l(`Drawer-error`)},a.msg):null):null,n.map(function(t,n){return o(`action/${n}`,t,{onAction:e.handleAction,onActionSensor:void 0,btnDisabled:a.loading,data:a.formData,key:n,disabled:t.disabled||a.loading})}))},n.prototype.openFeedback=function(e,t){var n=this;return new Promise(function(r){var i=n.props.store;i.setCurrentAction({type:`button`,actionType:`dialog`,dialog:e},n.props.resolveDefinitions),i.openDialog(t,void 0,function(e){r(e)},n.context)})},n.prototype.render=function(){var e=this.props.store,n=t(t({},this.props),e.schema),r=n.className,a=n.style,o=n.size,s=n.closeOnEsc,l=n.position,u=n.title,f=n.render,p=n.header,m=n.body,h=n.bodyClassName,g=n.headerClassName,_=n.show,v=n.showCloseButton,y=n.width,b=n.height,x=n.wrapperComponent,S=n.env,w=n.resizable,E=n.overlay,D=n.closeOnOutside,k=n.classPrefix,A=n.classnames,j=n.drawerContainer,M=n.loadingConfig;n.popOverContainer;var N=n.themeCss,P=n.id,F=d(n,`className.style.size.closeOnEsc.position.title.render.header.body.bodyClassName.headerClassName.show.showCloseButton.width.height.wrapperComponent.env.resizable.overlay.closeOnOutside.classPrefix.classnames.drawerContainer.loadingConfig.popOverContainer.themeCss.id`.split(`.`)),I=x||i;return O.createElement(I,t({},F,{resizable:w,classPrefix:k,className:r,style:a,drawerClassName:T(t(t({},this.props),{name:`drawerClassName`,id:P,themeCss:N})),drawerMaskClassName:T(t(t({},this.props),{name:`drawerMaskClassName`,id:P,themeCss:N})),size:o,onHide:this.handleSelfClose,disabled:e.loading,show:_,showCloseButton:v,width:y,height:b,position:l,overlay:E,onEntered:this.handleEntered,onExited:this.handleExited,onDragging:e.setDragging,closeOnEsc:s,closeOnOutside:!e.drawerOpen&&!e.dialogOpen&&D,container:j||S?.getModalContainer}),u||p?O.createElement(`div`,{className:A(`Drawer-header`,g,T(t(t({},this.props),{name:`drawerHeaderClassName`,id:P,themeCss:N})))},u?O.createElement(`div`,{className:A(`Drawer-title`,T(t(t({},this.props),{name:`drawerTitleClassName`,id:P,themeCss:N})))},f(`title`,u,{data:e.formData,onConfirm:this.handleDrawerConfirm,onClose:this.handleDrawerClose,onAction:this.handleAction,onActionSensor:void 0,btnDisabled:e.loading})):null,p?f(`header`,p,{data:e.formData,onConfirm:this.handleDrawerConfirm,onClose:this.handleDrawerClose,onAction:this.handleAction,onActionSensor:void 0,btnDisabled:e.loading}):null):null,e.entered?m?O.createElement(`div`,{className:A(`Drawer-body`,h,T(t(t({},this.props),{name:`drawerBodyClassName`,id:P,themeCss:N}))),role:`dialog-body`},this.renderBody(m,`body`),O.createElement(C,t({},this.props,{config:{themeCss:N,classNames:[{key:`drawerClassName`},{key:`drawerMaskClassName`},{key:`drawerHeaderClassName`},{key:`drawerTitleClassName`},{key:`drawerBodyClassName`},{key:`drawerFooterClassName`}],id:P},env:S}))):null:O.createElement(`div`,{className:A(`Drawer-body`,h,T(t(t({},this.props),{name:`drawerBodyClassName`,id:P,themeCss:N})))},O.createElement(c,{overlay:!0,show:!0,size:`lg`,loadingConfig:M})),this.renderFooter(),m?f(`dialog`,t(t({},e.dialogSchema),{type:`dialog`}),{key:`dialog`,data:e.dialogData,onConfirm:this.handleDialogConfirm,onClose:this.handleDialogClose,onAction:this.handleAction,show:e.dialogOpen}):null,m?f(`drawer`,t(t({},e.drawerSchema),{type:`drawer`}),{key:`drawer`,data:e.drawerData,onConfirm:this.handleDrawerConfirm,onClose:this.handleDrawerClose,onAction:this.handleAction,show:e.drawerOpen}):null)},n.propsList=[`title`,`size`,`closeOnEsc`,`closeOnOutside`,`children`,`className`,`bodyClassName`,`headerClassName`,`footerClassName`,`confirm`,`position`,`onClose`,`onConfirm`,`show`,`showCloseButton`,`width`,`height`,`resizable`,`overlay`,`body`,`popOverContainer`,`showErrorMsg`],n.defaultProps={title:``,className:``,bodyClassName:``,headerClassName:``,footerClassName:``,confirm:!0,position:`right`,resizable:!1,showCloseButton:!0,overlay:!0,closeOnEsc:!1,closeOnOutside:!1,showErrorMsg:!0},f([r,a(`design:type`,Function),a(`design:paramtypes`,[]),a(`design:returntype`,void 0)],n.prototype,`getPopOverContainer`,null),n}(O.Component),j=function(e){p(r,e);function r(t,n){var r=e.call(this,t)||this;return n.registerComponent(r),r}return r.prototype.componentWillUnmount=function(){this.context.unRegisterComponent(this),e.prototype.componentWillUnmount.call(this)},r.prototype.tryChildrenToHandle=function(e,n,r){var i=this,a=this.context,o=[],s=this.props,c=s.onConfirm,u=s.store;if(e.target&&o.push.apply(o,g([],l(e.target.split(`,`).map(function(e){return a.getComponentByName(e)}).filter(function(e){return e&&e.doAction})),!1)),e?.isolateScope!==!0&&!o.length)for(var d=a.getComponents().filter(function(e){return!~[`drawer`,`dialog`].indexOf(e.props.type)}).concat();d.length;){var f=d.pop();if(~[`crud`,`form`,`wizard`].indexOf(f.props.type)){o.push(f);break}else if(~[`drawer`,`dialog`].indexOf(f.props.type))continue;else ~[`page`,`service`].indexOf(f.props.type)&&d.unshift.apply(d,f.context.getComponents())}return o.length?(u.markBusying(!0),u.updateMessage(),Promise.all(o.map(function(r){return r.doAction(t(t({},e),{from:i.$$id}),n,!0)})).then(function(t){(e.type===`submit`||e.actionType===`submit`||e.actionType===`confirm`)&&e.close!==!1?c&&c(t,r||e,n,o):e.close&&(e.close===!0?i.handleSelfClose():i.closeTarget(e.close)),u.markBusying(!1)}).catch(function(e){u.updateMessage(e.message,!0),u.markBusying(!1),clearTimeout(i.clearErrorTimer),i.clearErrorTimer=setTimeout(function(){u.updateMessage(``)},3e3)}),!0):!1},r.prototype.doAction=function(e,t,n){this.handleAction(void 0,e,t)},r.prototype.handleAction=function(e,t,r,i,a,o){return i===void 0&&(i=!1),y(this,void 0,void 0,function(){var s,c,l,u,d,f,p,g,_,b,x=this;return h(this,function(S){switch(S.label){case 0:return s=this.props,c=s.onClose,l=s.onAction,u=s.store,d=s.env,f=s.dispatchEvent,p=s.show,t.from===this.$$id||!p?[2,l?l(e,t,r,i,a||this.context):!1]:o?.pendingPromise.length?[4,o.allDone()]:[3,2];case 1:S.sent(),S.label=2;case 2:return g=this.context,t.actionType===`close`||t.actionType===`cancel`?[4,f(`cancel`,m(this.props.data,r))]:[3,6];case 3:return _=S.sent(),_?.prevented?[2]:_?.pendingPromise.length?[4,_.allDone()]:[3,5];case 4:S.sent(),S.label=5;case 5:return u.setCurrentAction(t,this.props.resolveDefinitions),c(),t.close&&(t.close===!0?this.handleSelfClose():this.closeTarget(t.close)),[3,17];case 6:return t.actionType===`confirm`?[4,f(`confirm`,m(this.props.data,r))]:[3,10];case 7:return b=S.sent(),b?.prevented?[2]:b?.pendingPromise.length?[4,b.allDone()]:[3,9];case 8:S.sent(),S.label=9;case 9:return u.setCurrentAction(t,this.props.resolveDefinitions),this.tryChildrenToHandle(t,r)||c(),[3,17];case 10:return t.actionType===`drawer`?(u.setCurrentAction(t,this.props.resolveDefinitions),[2,new Promise(function(e){u.openDrawer(r,void 0,function(n,r){var i;(i=t.callback)==null||i.call(t,n,r),e({confirmed:n,value:r})})})]):[3,11];case 11:return t.actionType===`dialog`?(u.setCurrentAction(t,this.props.resolveDefinitions),[2,new Promise(function(e){u.openDialog(r,void 0,function(n,r){var i;(i=t.callback)==null||i.call(t,n,r),e({confirmed:n,value:r})},a||x.context)})]):[3,12];case 12:return t.actionType===`reload`?(u.setCurrentAction(t,this.props.resolveDefinitions),t.target&&g.reload(t.target,r),t.close&&(t.close===!0?this.handleSelfClose():this.closeTarget(t.close)),[3,17]):[3,13];case 13:return!t.from&&this.tryChildrenToHandle(t,r)?[3,17]:[3,14];case 14:return t.actionType===`ajax`?(u.setCurrentAction(t,this.props.resolveDefinitions),u.saveRemote(t.api,r,{successMessage:t.messages&&t.messages.success,errorMessage:t.messages&&t.messages.failed}).then(function(){return y(x,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return t.feedback&&v(t.feedback,u.data)?[4,this.openFeedback(t.feedback,u.data)]:[3,2];case 1:r.sent(),r.label=2;case 2:return e=t.redirect&&E(t.redirect,u.data),e&&d.jumpTo(e,t,u.data),t.reload&&this.reloadTarget(n(t.reload,u.data),u.data),t.close&&(t.close===!0?this.handleSelfClose():this.closeTarget(t.close)),[2]}})})}).catch(function(e){if(i||t.countDown)throw e}),[3,17]):[3,15];case 15:return l?[4,l(e,t,r,i,a||this.context)]:[3,17];case 16:S.sent(),t.close&&(t.close===!0?this.handleSelfClose():this.closeTarget(t.close)),S.label=17;case 17:return[2]}})})},r.prototype.handleChildFinished=function(e,t){if(!(t&&t.from===this.$$id||t.close===!1)){var n=this.context.getComponents().filter(function(e){return!~[`drawer`,`dialog`,`action`,`button`,`submit`,`reset`].indexOf(e.props.type)}),r=this.props.onConfirm;n.length===1&&(n[0].props.type===`form`||n[0].props.type===`wizard`)&&r([e],t,{},n)}},r.prototype.handleDialogConfirm=function(t,n){var r=[...arguments].slice(2);e.prototype.handleDialogConfirm.apply(this,g([t,n],l(r),!1));var i=this.props.store,a=i.getDialogScoped()||this.context,o=i.action,s=n.reload??o.reload;s?a.reload(s,i.data):a.component!==this&&a.component?.reload?a.component.reload():this.context.getComponents().filter(function(e){return e.props.type===`crud`}).forEach(function(e){return e.reload&&e.reload()})},r.prototype.handleDrawerConfirm=function(t,n){for(var r=this,i=[],a=2;a<arguments.length;a++)i[a-2]=arguments[a];e.prototype.handleDrawerConfirm.call(this,t,n);var o=this.props.store,s=o.getDialogScoped()||this.context,c=o.action,l=n.reload??c.reload;setTimeout(function(){l?s.reload(l,o.data):s.component!==r&&s.component?.reload?s.component.reload():r.context.getComponents().filter(function(e){return e.props.type===`crud`}).forEach(function(e){return e.reload&&e.reload()})},300)},r.prototype.reloadTarget=function(e,t){this.context.reload(e,t)},r.prototype.closeTarget=function(e){this.context.close(e)},r.prototype.setData=function(e,t){return this.props.store.updateData(e,void 0,t)},r.prototype.getData=function(){return this.props.store.data},r.contextType=b,r=f([w({type:`drawer`,storeType:D.name,storeExtendsData:!1,isolateScope:!0,shouldSyncSuperStore:function(e,t,n){return!!((e.drawerOpen||t.show)&&(t.show!==n.show||_(n.data,t.data)))}}),a(`design:paramtypes`,[Object,Object])],r),r}(A);export{j as DrawerRenderer,A as default};