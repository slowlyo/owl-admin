import{$o as e,Ao as t,Ar as n,Ci as r,Fo as i,Gr as a,Hn as o,Io as s,Jt as c,Ko as l,Mo as u,No as d,Oa as f,Po as p,Ro as m,Yi as h,Zi as g,cn as _,ga as v,jo as y,kr as b,ni as x,or as S,so as C,ti as w,vr as T,wi as E,wr as D,xr as O,ya as k}from"./index-C4Pf1uQ-.js";var A=e(l()),j=function(e){d(a,e);function a(t){var n=e.call(this,t)||this;return E(n,[`handleAction`,`handleChange`,`handleBulkChange`,`handleQuery`,`handleDialogConfirm`,`handleDialogClose`,`handleDrawerConfirm`,`handleDrawerClose`,`handleClick`,`reload`,`silentReload`,`initInterval`]),n.style=document.createElement(`style`),n.style.setAttribute(`data-page`,``),document.getElementsByTagName(`head`)[0].appendChild(n.style),n.updateStyle(),n.varStyle=document.createElement(`style`),n.varStyle.setAttribute(`data-vars`,``),document.getElementsByTagName(`head`)[0].appendChild(n.varStyle),n.updateVarStyle(),n}return a.prototype.updateStyle=function(){this.props.css||this.props.mobileCSS?this.style.innerHTML=`
      ${this.buildCSS(this.props.css)}

      @media (max-width: 768px) {
        ${this.buildCSS(this.props.mobileCSS)}
      }
      `:this.style.innerHTML=``},a.prototype.buildCSS=function(e){if(!e)return``;var t=``;for(var n in e){var r=e[n],i=``;for(var a in r){var o=``,s=r[a];if(typeof s==`string`)i+=`  ${a}: ${s};
`;else{for(var c in s)o+=` ${c}:${s[c]};`;i+=`  ${a} {${o}}
`}}t+=`
      ${n} {
        ${i}
      }
      `}return t},a.prototype.updateVarStyle=function(){var e=this.props.cssVars,t=``;if(e){for(var n in e)if(n.startsWith(`--`)){if(n.indexOf(`:`)!==-1)continue;var r=e[n];if(typeof r==`string`&&(r.indexOf(`expression(`)!==-1||r.indexOf(`;`)!==-1))continue;t+=`${n}: ${r}; 
`}this.varStyle.innerHTML=`
      :root {
        ${t}
      }
      `}},a.prototype.componentDidMount=function(){return y(this,void 0,void 0,function(){var e,t,n,r,i,a,o,s,c,l;return p(this,function(u){switch(u.label){case 0:return e=this.props,t=e.initApi,n=e.initFetch,r=e.initFetchOn,i=e.store,a=e.messages,o=e.data,s=e.dispatchEvent,c=e.env,this.mounted=!0,[4,s(`init`,o,this)];case 1:return l=u.sent(),c?.tracker&&c.tracker({eventType:`pageLoaded`},this.props),l?.prevented||!C(i)||x(t,i.data,n,r)&&i.fetchInitData(t,i.data,{successMessage:a&&a.fetchSuccess,errorMessage:a&&a.fetchFailed}).then(this.initInterval),[2]}})})},a.prototype.componentDidUpdate=function(e){var t=this.props,n=t.store,r=t.initApi;if(t.initFetchOn&&t.initFetch&&!e.initFetch||t.initFetch!==!1&&w(e.initApi,r,e.data,t.data)){var i=t.messages;x(r,n.data)&&n.fetchData(r,n.data,{successMessage:i&&i.fetchSuccess,errorMessage:i&&i.fetchFailed}).then(this.initInterval)}(JSON.stringify(t.css)!==JSON.stringify(e.css)||JSON.stringify(t.mobileCSS)!==JSON.stringify(e.mobileCSS))&&this.updateStyle(),JSON.stringify(t.cssVars)!==JSON.stringify(e.cssVars)&&this.updateVarStyle(),h(e.defaultData,t.defaultData)&&n.reInitData(t.defaultData)},a.prototype.componentWillUnmount=function(){var e,t;this.mounted=!1,clearTimeout(this.timer),this.style&&((e=this.style.parentNode)==null||e.removeChild(this.style)),this.varStyle&&((t=this.varStyle.parentNode)==null||t.removeChild(this.varStyle))},a.prototype.reloadTarget=function(e,t){},a.prototype.handleAction=function(e,t,r,i,a){var o=this;i===void 0&&(i=!1);var s=this.props,c=s.env,l=s.store,u=s.messages,d=s.onAction;return t.actionType===`dialog`?(l.setCurrentAction(t,this.props.resolveDefinitions),new Promise(function(e){l.openDialog(r,void 0,function(n,r){var i;(i=t.callback)==null||i.call(t,n,r),e({confirmed:n,value:r})},a||o.context)})):t.actionType===`drawer`?(l.setCurrentAction(t,this.props.resolveDefinitions),new Promise(function(e){l.openDrawer(r,void 0,function(n,r){var i;(i=t.callback)==null||i.call(t,n,r),e({confirmed:n,value:r})},a)})):t.actionType===`ajax`?(l.setCurrentAction(t,this.props.resolveDefinitions),x(t.api,r)?l.saveRemote(t.api,r,{successMessage:t.messages&&t.messages.success||u&&u.saveSuccess,errorMessage:t.messages&&t.messages.failed||u&&u.saveSuccess}).then(function(){return y(o,void 0,void 0,function(){var e;return p(this,function(r){switch(r.label){case 0:return t.feedback&&g(t.feedback,l.data)?[4,this.openFeedback(t.feedback,l.data)]:[3,2];case 1:r.sent(),r.label=2;case 2:return e=t.redirect&&k(t.redirect,l.data),e&&c.jumpTo(e,t,l.data),t.reload&&this.reloadTarget(n(t.reload,l.data),l.data),[2]}})})}).catch(function(e){if(i||t.countDown)throw e}):void 0):d(e,t,r,i,a||this.context)},a.prototype.handleQuery=function(e){if(this.props.initApi){if(e?.hasOwnProperty(`orderBy`)&&!w(this.props.initApi,this.props.initApi,this.props.store.data,f(this.props.store.data,e)))return!1;this.receive(e);return}return this.props.onQuery?this.props.onQuery(e):!1},a.prototype.handleDialogConfirm=function(e,t){var n=[...arguments].slice(2),r=this.props.store;t.mergeData&&e.length===1&&e[0]&&r.updateData(e[0]);var i=r.action.dialog;i&&i.onConfirm&&i.onConfirm.apply(i,m([e,t],s(n),!1))===!1||r.closeDialog(!0,e)},a.prototype.handleDialogClose=function(e){e===void 0&&(e=!1),this.props.store.closeDialog(e)},a.prototype.handleDrawerConfirm=function(e,t){var n=[...arguments].slice(2),r=this.props.store;t.mergeData&&e.length===1&&e[0]&&r.updateData(e[0]);var i=r.action.dialog;i&&i.onConfirm&&i.onConfirm.apply(i,m([e,t],s(n),!1))===!1||r.closeDrawer(!0,e)},a.prototype.handleDrawerClose=function(){this.props.store.closeDrawer(!1)},a.prototype.handleClick=function(e){var t=e.target,n=this.props.env,r=t.tagName===`A`&&t.hasAttribute(`data-link`)?t.getAttribute(`data-link`):t.closest(`a[data-link]`)?.getAttribute(`data-link`);n&&r&&(n.jumpTo(r,void 0,this.props.data),e.preventDefault())},a.prototype.handleResizeMouseDown=function(e){e.nativeEvent.which!=3&&(this.codeWrap=e.currentTarget.parentElement,document.addEventListener(`mousemove`,this.handleResizeMouseMove),document.addEventListener(`mouseup`,this.handleResizeMouseUp),this.startX=e.clientX,this.startWidth=this.codeWrap.offsetWidth)},a.prototype.handleResizeMouseMove=function(e){var t=this.props,n=t.asideMinWidth,r=n===void 0?160:n,i=t.asideMaxWidth,a=i===void 0?350:i,o=t.asidePosition,s=e.clientX-this.startX,c=o===`right`?this.startWidth-s:this.startWidth+s,l=Math.min(Math.max(c,r),a);this.codeWrap.style.cssText+=`width: ${l}px`},a.prototype.handleResizeMouseUp=function(){document.removeEventListener(`mousemove`,this.handleResizeMouseMove),document.removeEventListener(`mouseup`,this.handleResizeMouseUp)},a.prototype.openFeedback=function(e,t){var n=this;return new Promise(function(r){var i=n.props.store;i.setCurrentAction({type:`button`,actionType:`dialog`,dialog:e},n.props.resolveDefinitions),i.openDialog(t,void 0,function(e){r(e)},n.context)})},a.prototype.reload=function(e,t,n,r,i){return y(this,void 0,void 0,function(){var e,n,a,o;return p(this,function(s){switch(s.label){case 0:return t?[2,this.receive(t,void 0,i)]:(e=this.props,n=e.store,a=e.initApi,clearTimeout(this.timer),x(a,n.data)?[4,n.fetchData(a,n.data,{silent:r})]:[3,2]);case 1:o=s.sent(),this.initInterval(o),s.label=2;case 2:return[2,n.data]}})})},a.prototype.receive=function(e,t,n){this.props.store.updateData(e,void 0,n),this.reload()},a.prototype.silentReload=function(e,t){this.reload(t,void 0,void 0,!0)},a.prototype.initInterval=function(e){var n=this.props,r=n.interval,i=n.silentPolling,a=n.stopAutoRefreshWhen,o=n.data,s=n.dispatchEvent,c=n.store;return s(`inited`,f(o,t(t({},e?.data),{responseData:e?.ok?e?.data??{}:e,responseStatus:e?.status===void 0?c?.error?1:0:e?.status,responseMsg:e?.msg||c?.msg}))),e!=null&&e.ok&&r&&this.mounted&&(!a||!v(a,o))&&(this.timer=setTimeout(i?this.silentReload:this.reload,Math.max(r,1e3))),e},a.prototype.handleRefresh=function(){return y(this,void 0,void 0,function(){var e,t,n,r;return p(this,function(i){switch(i.label){case 0:return e=this.props,t=e.dispatchEvent,n=e.data,[4,t(`pullRefresh`,n)];case 1:return r=i.sent(),r?.prevented||this.reload(),[2]}})})},a.prototype.handleChange=function(e,t,n,r){var i=this.props,a=i.store,o=i.onChange;typeof t==`string`&&t&&a.changeValue(t,e,r),o?.apply(null,arguments)},a.prototype.handleBulkChange=function(e){var t,n;(n=(t=this.props.store)?.updateData)==null||n.call(t,e)},a.prototype.renderHeader=function(){var e=this.props,n=e.title,r=e.subTitle,i=e.remark,a=e.remarkPlacement,o=e.headerClassName,s=e.toolbarClassName,c=e.toolbar,l=e.render,u=e.store,d=e.initApi,f=e.popOverContainer,p=e.env,m=e.classnames,h=e.regions;e.translate;var g=e.id,_=e.themeCss,v={onAction:this.handleAction,onQuery:d?this.handleQuery:void 0,onChange:this.handleChange,onBulkChange:this.handleBulkChange,pageLoading:u.loading},y,b;return(Array.isArray(h)?~h.indexOf(`header`):n||r)&&(y=A.createElement(`div`,{className:m(`Page-header`,o,O(t(t({},this.props),{name:`headerControlClassName`,id:g,themeCss:_})))},n?A.createElement(`h2`,{className:m(`Page-title`,O(t(t({},this.props),{name:`titleControlClassName`,id:g,themeCss:_})))},l(`title`,n,v),i?l(`remark`,{type:`remark`,tooltip:i,placement:a||`bottom`,container:f||p.getModalContainer}):null):null,r&&A.createElement(`small`,{className:m(`Page-subTitle`)},l(`subTitle`,r,v)))),(Array.isArray(h)?~h.indexOf(`toolbar`):c)&&(b=A.createElement(`div`,{className:m(`Page-toolbar`,s,O(t(t({},this.props),{name:`toolbarControlClassName`,id:g,themeCss:_})))},l(`toolbar`,c||``,v))),y&&b?A.createElement(`div`,{className:m(`Page-headerRow`)},y,b):y||b},a.prototype.renderContent=function(e){var n=this.props,r=n.store,i=n.body,a=n.bodyClassName,s=n.render,c=n.classnames,l=n.showErrorMsg,u=n.regions;n.translate;var d=n.loadingConfig;n.initApi;var f=n.id,p=n.env,m=n.themeCss;return A.createElement(`div`,{className:c(`Page-content`)},A.createElement(`div`,{className:c(`Page-main`)},this.renderHeader(),A.createElement(`div`,{className:c(`Page-body`,a,O(t(t({},this.props),{name:`bodyControlClassName`,id:f,themeCss:m}))),role:`page-body`},A.createElement(o,{size:`lg`,overlay:!0,key:`info`,show:r.loading,loadingConfig:d}),!p.forceSilenceInsideError&&r.error&&l!==!1?A.createElement(_,{level:`danger`,showCloseButton:!0,onClose:r.clearMessage},r.msg):null,(Array.isArray(u)?~u.indexOf(`body`):i)?s(`body`,i||``,e):null)))},a.prototype.render=function(){var e=this.props,n=e.className,r=e.store;e.body,e.bodyClassName;var i=e.render,a=e.aside,o=e.asideClassName,s=e.classnames;e.showErrorMsg;var l=e.initApi,u=e.regions,d=e.style,f=e.data,p=e.asideResizor,m=e.asideSticky,h=e.pullRefresh,g=e.mobileUI,_=e.translate;e.loadingConfig;var v=e.id,y=e.wrapperCustomStyle,b=e.env,x=e.themeCss,C=e.asidePosition,w={onAction:this.handleAction,onQuery:l?this.handleQuery:void 0,onChange:this.handleChange,onBulkChange:this.handleBulkChange,pageLoading:r.loading},E=Array.isArray(u)?~u.indexOf(`aside`):a&&(!Array.isArray(a)||a.length),D=S(d,f),k=this.renderContent(w);return A.createElement(`div`,{className:s(`Page`,E?`Page--withSidebar`:``,E&&m?`Page--asideSticky`:``,E&&C?`Page--${C}Aside`:``,n,O(t({name:`baseControlClassName`,id:v,themeCss:x},this.props)),O(t({name:`wrapperCustomStyle`,id:v,themeCss:y},this.props))),onClick:this.handleClick,style:D},E?A.createElement(`div`,{className:s(`Page-aside`,p?`relative`:`Page-aside--withWidth`,o,O(t(t({},this.props),{name:`asideControlClassName`,id:v,themeCss:x})))},i(`aside`,a||``,t(t({},w),typeof a==`string`?{inline:!1,className:`Page-asideTplWrapper`}:null)),p?A.createElement(`div`,{onMouseDown:this.handleResizeMouseDown,className:s(`Page-asideResizor`)}):null):null,g&&h&&!h.disabled?A.createElement(c,t({},h,{translate:_,onRefresh:this.handleRefresh}),k):k,i(`dialog`,t(t({},r.dialogSchema),{type:`dialog`}),{key:`dialog`,data:r.dialogData,onConfirm:this.handleDialogConfirm,onClose:this.handleDialogClose,show:r.dialogOpen,onAction:this.handleAction,onQuery:l?this.handleQuery:void 0}),i(`drawer`,t(t({},r.drawerSchema),{type:`drawer`}),{key:`drawer`,data:r.drawerData,onConfirm:this.handleDrawerConfirm,onClose:this.handleDrawerClose,show:r.drawerOpen,onAction:this.handleAction,onQuery:l?this.handleQuery:void 0}),A.createElement(T,t({},this.props,{config:{wrapperCustomStyle:y,id:v,themeCss:x,classNames:[{key:`baseControlClassName`,weights:{default:{important:!0},hover:{important:!0},active:{important:!0}}},{key:`bodyControlClassName`},{key:`headerControlClassName`},{key:`titleControlClassName`},{key:`toolbarControlClassName`},{key:`asideControlClassName`}]},env:b})))},a.defaultProps={asideClassName:``,bodyClassName:``,headerClassName:``,initFetch:!0,toolbarClassName:``,messages:{},asideSticky:!0,asidePosition:`left`,pullRefresh:{disabled:!0}},a.propsList=[`title`,`subTitle`,`initApi`,`initFetchOn`,`initFetch`,`headerClassName`,`bodyClassName`,`asideClassName`,`toolbarClassName`,`toolbar`,`body`,`aside`,`messages`,`style`,`showErrorMsg`],u([r,i(`design:type`,Function),i(`design:paramtypes`,[Object]),i(`design:returntype`,void 0)],a.prototype,`handleResizeMouseDown`,null),u([r,i(`design:type`,Function),i(`design:paramtypes`,[MouseEvent]),i(`design:returntype`,void 0)],a.prototype,`handleResizeMouseMove`,null),u([r,i(`design:type`,Function),i(`design:paramtypes`,[]),i(`design:returntype`,void 0)],a.prototype,`handleResizeMouseUp`,null),u([r,i(`design:type`,Function),i(`design:paramtypes`,[]),i(`design:returntype`,Promise)],a.prototype,`handleRefresh`,null),a}(A.Component),M=function(e){d(n,e);function n(t,n){var r=e.call(this,t)||this;return n.registerComponent(r),r}return n.prototype.componentWillUnmount=function(){this.context.unRegisterComponent(this),e.prototype.componentWillUnmount.call(this)},n.prototype.reloadTarget=function(e,t){this.context.reload(e,t)},n.prototype.handleAction=function(n,r,i,a,o){return a===void 0&&(a=!1),y(this,void 0,void 0,function(){var s,c;return p(this,function(l){switch(l.label){case 0:return s=o||this.context,r.actionType===`reload`?(r.target&&s.reload(r.target,i),[3,4]):[3,1];case 1:return r.target?(r.target.split(`,`).forEach(function(e){var n=s.getComponentByName(e);n&&n.doAction&&n.doAction(t(t({},r),{target:void 0}),i)}),[3,4]):[3,2];case 2:return[4,e.prototype.handleAction.call(this,n,r,i,a,o)];case 3:return c=l.sent(),r.reload&&~[`url`,`link`,`jump`].indexOf(r.actionType)&&s.reload(r.reload,i),[2,c];case 4:return[2]}})})},n.prototype.handleDialogConfirm=function(t,n){var r=[...arguments].slice(2),i=this.props.store,a=i.action,o=n.reload??a.reload,c=i.getDialogScoped()||this.context;e.prototype.handleDialogConfirm.apply(this,m([t,n],s(r),!1)),o?c.reload(o,i.data):c?.component!==this&&c.component?.reload?c.component.reload():this.context.getComponents().filter(function(e){return e.props.type===`crud`}).forEach(function(e){return e.reload&&e.reload()})},n.prototype.handleDrawerConfirm=function(t,n){for(var r=this,i=[],a=2;a<arguments.length;a++)i[a-2]=arguments[a];var o=this.props.store,s=o.action,c=n.reload??s.reload,l=o.getDrawerScoped()||this.context;e.prototype.handleDrawerConfirm.call(this,t,n),setTimeout(function(){c?l.reload(c,o.data):l.component!==r&&l?.component?.reload?l.component.reload():r.context.getComponents().filter(function(e){return e.props.type===`crud`}).forEach(function(e){return e.reload&&e.reload()})},300)},n.prototype.setData=function(e,t){return this.props.store.updateData(e,void 0,t)},n.prototype.getData=function(){return this.props.store.data},n.contextType=b,n}(j),N=function(e){d(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t=u([D({type:`page`,storeType:a.name,isolateScope:!0})],t),t}(M);export{N as PageRenderer,M as PageRendererBase,j as default};