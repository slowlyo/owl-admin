import{t as R,am as T,Y as z,z as C,G as w,H as O,a$ as H,aK as $,aM as G,l as A,v as K,ag as E,aP as U,ad as V,P as L,ae as Y,D,ap as q,T as P,br as J,b1 as Q,ah as B}from"./index-CoSlI2Ok.js";var W=function(I){R(c,I);function c(a){var e=I.call(this,a)||this;return e.state={stack:[]},e.handleChange=e.handleChange.bind(e),e.loadMore=e.loadMore.bind(e),e}return c.prototype.componentDidMount=function(){var a,e,t=this.props.formInited;t||!this.props.addHook?this.loadMore():(e=(a=this.props).addHook)===null||e===void 0||e.call(a,this.loadMore,"init")},c.prototype.componentDidUpdate=function(a){var e=this.props;a.options!==e.options?this.setState({stack:[]}):e.formInited&&e.value!==a.value&&this.loadMore()},c.prototype.doAction=function(a,e,t){var o,h,u=this.props,f=u.resetValue,d=u.onChange,v=u.formStore,l=u.store,r=u.name,p=a==null?void 0:a.actionType;if(p==="clear")d("");else if(p==="reset"){var i=(h=T((o=v==null?void 0:v.pristine)!==null&&o!==void 0?o:l==null?void 0:l.pristine,r))!==null&&h!==void 0?h:f;d(i??"")}},c.prototype.array2value=function(a,e){e===void 0&&(e=!1);var t=this.props,o=t.delimiter,h=t.joinValues,u=t.extractValue,f=t.valueField;return e?h?a.join(o||","):a:h?a.join(o||","):u?a.map(function(d){return d[f||"value"]||d}):a},c.prototype.loadMore=function(){for(var a=this,e=this.props,t=e.value,o=e.delimiter,h=e.onChange,u=e.joinValues,f=e.extractValue,d=e.valueField,v=e.source,l=e.data,r=e.env,p=e.dispatchEvent,i=Array.isArray(t)?t.concat():t&&typeof t=="string"?t.split(o||","):[],n=0,_=this.state.stack.length;n<_&&i[n]&&this.state.stack[n].parentId==(u||f?i[n]:i[n][d||"value"]);)n++;if(!(!i[n]||!r||!z(v,l))){var y=u||f?i[n]:i[n][d||"value"],b=this.state.stack.concat();b.splice(n,b.length-n),b.push({parentId:y,loading:!0,options:[]}),this.setState({stack:b},function(){r.fetcher(v,C(C({},l),{value:i,level:n+1,parentId:y,parent:i[n]})).then(function(s){return w(a,void 0,void 0,function(){var m,N,g,S,k,x,M,j;return O(this,function(F){switch(F.label){case 0:return m=this.state.stack.concat(),N=s.data?s.data[d||"value"]:void 0,g=((x=s==null?void 0:s.data)===null||x===void 0?void 0:x.options)||((M=s==null?void 0:s.data)===null||M===void 0?void 0:M.items)||((j=s==null?void 0:s.data)===null||j===void 0?void 0:j.rows)||s.data||[],m.splice(n,m.length-n),typeof N<"u"?(i.splice(n+1,t.length-n-1),i.push(N),S=this.array2value(i,!0),[4,p("change",B(this.props,{value:S}))]):[3,2];case 1:if(k=F.sent(),k!=null&&k.prevented)return[2];h(S),F.label=2;case 2:return m.push({options:g,parentId:y,loading:!1,visible:Array.isArray(g)&&!Q(g)}),this.setState({stack:m},this.loadMore),[2]}})})}).catch(function(s){!(v!=null&&v.silent)&&r.notify("error",s.message)})})}},c.prototype.handleChange=function(a,e){return w(this,void 0,void 0,function(){var t,o,h,u,f,d,v,l,r,p,i;return O(this,function(n){switch(n.label){case 0:return t=this.props,o=t.value,h=t.delimiter,u=t.onChange,f=t.joinValues,t.extractValue,d=t.dispatchEvent,v=t.valueField,t.data,l=Array.isArray(o)?o.concat():o&&typeof o=="string"?o.split(h||","):[],l.splice(a,l.length-a),r=f?e[v||"value"]:e,r!==void 0&&l.push(r),p=this.array2value(l),[4,d("change",B(this.props,{value:p}))];case 1:return i=n.sent(),i!=null&&i.prevented?[2]:(u(p),[2])}})})},c.prototype.reload=function(a,e){var t=this.props.reloadOptions;t&&t(a,e)},c.prototype.renderStatic=function(a){a===void 0&&(a="-");var e=this.props,t=e.options,o=t===void 0?[]:t,h=e.labelField,u=e.valueField,f=e.classPrefix,d=e.classnames,v=e.className,l=e.value,r=e.delimiter,p=H([{options:o,visible:!0}],$(this.state.stack||[]),!1),i=Array.isArray(l)?l.concat():l&&typeof l=="string"?l.split(r||","):[];return(i==null?void 0:i.length)>0&&(a=i.map(function(n,_){var y,b=p[_]||{},s=b.options,m=b.visible;if(m===!1)return null;if(!s||!s.length)return n;var N=G(s,function(g){return n===g[u||"value"]})||{};return(y=N[h||"label"])!==null&&y!==void 0?y:n}).filter(function(n){return n!=null}).join(" > ")),A.createElement("div",{className:d("".concat(f,"SelectStaticControl"),v)},a)},c.prototype.render=function(){var a=this,e=this.props,t=e.options,o=e.classPrefix,h=e.className,u=e.style;e.inline;var f=e.loading,d=e.value,v=e.delimiter;e.joinValues,e.extractValue,e.multiple;var l=e.mobileUI,r=e.env,p=e.testIdBuilder,i=e.popoverClassName,n=e.placeholder,_=K(e,["options","classPrefix","className","style","inline","loading","value","delimiter","joinValues","extractValue","multiple","mobileUI","env","testIdBuilder","popoverClassName","placeholder"]),y=Array.isArray(d)?d.concat():d&&typeof d=="string"?d.split(v||","):[],b=this.props,s=b.themeCss,m=b.id,N=this.state.stack.find(function(g){return g.loading});return A.createElement("div",{className:E("".concat(o,"ChainedSelectControl"),h)},A.createElement(U,C({},_,{placeholder:n,mobileUI:l,popOverContainer:l?r==null?void 0:r.getModalContainer:_.popOverContainer||(r==null?void 0:r.getModalContainer),className:E(V(C(C({},this.props),{name:"chainedSelectControlClassName",id:m,themeCss:s}))),popoverClassName:E(i,V(C(C({},this.props),{name:"chainedSelectPopoverClassName",id:m,themeCss:s}))),controlStyle:u,classPrefix:o,key:"base",testIdBuilder:p==null?void 0:p.getChild("base"),options:Array.isArray(t)?t:[],value:y[0],onChange:this.handleChange.bind(this,0),loading:f,inline:!0})),this.state.stack.map(function(g,S){var k=g.options,x=g.loading,M=g.visible;return M===!1||x?null:A.createElement(U,C({},_,{mobileUI:l,popOverContainer:l?r.getModalContainer:_.popOverContainer||(r==null?void 0:r.getModalContainer),classPrefix:o,key:"x-".concat(S+1),testIdBuilder:p==null?void 0:p.getChild("x-".concat(S+1)),options:Array.isArray(k)?k:[],value:y[S+1],onChange:a.handleChange.bind(a,S+1),inline:!0,controlStyle:u,className:E(V(C(C({},a.props),{name:"chainedSelectControlClassName",id:m,themeCss:s}))),popoverClassName:E(i,V(C(C({},a.props),{name:"chainedSelectPopoverClassName",id:m,themeCss:s})))}))}),N&&A.createElement(L,{size:"sm",className:E("".concat(o,"ChainedSelectControl-spinner"))}),A.createElement(Y,C({},this.props,{config:{themeCss:s,classNames:[{key:"chainedSelectControlClassName",weights:{focused:{suf:".is-opened:not(.is-mobile)"},disabled:{suf:".is-disabled"}}},{key:"chainedSelectPopoverClassName",weights:{default:{suf:" .".concat(o,"Select-option")},hover:{suf:" .".concat(o,"Select-option.is-highlight")},focused:{inner:".".concat(o,"Select-option.is-active")}}}],id:m},env:r})))},c.defaultProps={clearable:!1,searchable:!1,multiple:!0},D([q(),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],c.prototype,"render",null),c}(A.Component),Z=function(I){R(c,I);function c(){return I!==null&&I.apply(this,arguments)||this}return c=D([J({type:"chained-select",sizeMutable:!1})],c),c}(W);export{Z as ChainedSelectControlRenderer,W as default};
